/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-5-11 14:45:25"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uapbd/elementsystem/elementsystem/main/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uapbd/elementsystem/elementsystem/main/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,a){return function(e){var t={};function a(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(s,n,function(t){return e[t]}.bind(null,n));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=1)}([function(t,a){t.exports=e},function(e,t,a){"use strict";var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),n=a(2),o=i(n),r=i(a(3)),l=a(0),c=i(a(4));function i(e){return e&&e.__esModule?e:{default:e}}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u=l.base.NCDiv,p={elesysLoadTree:"/nccloud/uapbd/elementsystem/elesysLoadTree.do",elesysQueryCard:"/nccloud/uapbd/elementsystem/elesysQueryCard.do",elesysAdd:"/nccloud/uapbd/elementsystem/elesysAdd.do",elesysSave:"/nccloud/uapbd/elementsystem/elesysSave.do",elesysDel:"/nccloud/uapbd/elementsystem/elesysDel.do"},f=function(){},b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.initState=function(e){e.context,e.template,e.lang;a.state={treeId:"elesysTree",formId:"elementsys",tableId:"eletypes",root:{isleaf:!1,key:"~",title:a.lang["10140ES-000001"],id:"~",innercode:"~",pid:"",refname:a.lang["10140ES-000001"],refpk:"~"},tableStatus:"browse",selectedpk:""}},a.loadTreeData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;(0,l.ajax)({url:p.elesysLoadTree,data:{},success:function(t){if(t.success){var s=[Object.assign(a.state.root,{children:t.data})];a.props.syncTree.setSyncTreeData(a.state.treeId,a.dealTreeData(s)),a.props.syncTree.setNodeDisable(a.state.treeId,!1),a.props.syncTree.openNodeByPk(a.state.treeId,a.state.root.refpk),a.state.tableStatus="browse",a.setState(a.state,e),a.state.selectedpk&&a.state.selectedpk.length>0&&a.onSelectTree(a.state.selectedpk)}}})},a.onButtonClick=function(e,t){switch(t){case"refresh":a.onRefresh((function(){(0,l.toast)({color:"success",title:a.lang["10140ES-000004"]})}));break;case"cancel":a.onCancel();break;case"saveAdd":a.onSaveAdd();break;case"save":a.onSave();break;case"addLine":a.addLine();break;case"delLine":a.delLine();break;case"moveUp":a.moveUpOrDown();break;case"moveDown":a.moveUpOrDown(!1)}},a.moveUpOrDown=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=a.props.cardTable.getVisibleRows(a.state.tableId),s=t.length,n=a.props.cardTable.getCurrentIndex(a.state.tableId);if("number"==typeof n?n=n:n&&n.length&&(n=n.length>0?n[n.length-1]:null),s&&(n||0==n)){var o=n,r=e?o-1:o+1;if(r<0||r>s-1)return;e?(t[o].values.eletypecode.value=parseInt(t[o].values.eletypecode.value)-1,t[r].values.eletypecode.value=parseInt(t[r].values.eletypecode.value)+1):(t[o].values.eletypecode.value=parseInt(t[o].values.eletypecode.value)+1,t[r].values.eletypecode.value=parseInt(t[r].values.eletypecode.value)-1),t[o].status=1,t[r].status=1,a.props.cardTable.moveRow(a.state.tableId,o,r),a.props.cardTable.focusRowByIndex(a.state.tableId,r)}else(0,l.toast)({color:"warning",content:a.lang["10140ES-000014"]})},a.addLine=function(){var e=a.props.cardTable.getNumberOfRows(a.state.tableId);a.props.cardTable.addRow(a.state.tableId,e,{eletypecode:{value:e+1+""},balanorient:{value:"0",display:a.lang["10140ES-000010"]},balanposition:{value:"0",display:a.lang["10140ES-000011"]},elementtype:{value:"0",display:a.lang["10140ES-000012"]},dr:{value:0}},!1),a.props.cardTable.focusRowByIndex(a.state.tableId,e)},a.delLine=function(){var e=a.props.cardTable.getCheckedRows(a.state.tableId);if(e&&e.length>0){var t=e.map((function(e){return e.index}));a.props.cardTable.delRowsByIndex(a.state.tableId,t)}else(0,l.toast)({color:"warning",content:a.lang["10140ES-000013"]})},a.onSave=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;if(a.props.form.isCheckNow(a.state.formId)&&a.props.cardTable.checkTableRequired(a.state.tableId)){var s=a.props.createMasterChildData("10140ES_elementsys",a.state.formId,a.state.tableId);s.head[a.state.formId].rows[0].values.elementtypes=null,a.props.validateToSave(s,(function(){(0,l.ajax)({url:p.elesysSave,data:s,success:function(e){e.success&&a.onRefresh((function(){(0,l.toast)({title:a.lang["10140ES-000005"],color:"success"}),a.onSelectTree(e.data.pk_elementsystem),setTimeout(t,0)}))}})}),(d(e={},a.state.formId,"form"),d(e,a.state.tableId,"cardTable"),e),"card")}},a.onRefresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;a.props.form.EmptyAllFormValue(a.state.formId),a.props.cardTable.setTableData(a.state.tableId,{rows:[]}),a.buttonStatus(),a.props.syncTree.cancelSelectedNode(a.state.treeId),a.loadTreeData(e)},a.onSaveAdd=function(){a.onSave((function(){a.onAddIconEve()}))},a.onCancel=function(){(0,l.promptBox)({color:"warning",title:a.lang["10140ES-000002"],content:a.lang["10140ES-000003"],beSureBtnClick:function(){a.state.tableStatus="browse",a.setState(a.state,(function(){a.buttonStatus("cancel"),a.onSelectTree()}))}})},a.getTableHead=function(){var e=a.props.button.createButtonApp,t=a.state,s=t.tableStatus,n=t.tableId;return!s||"add"!==s&&"edit"!==s?"":o.default.createElement("div",{className:"shoulder-definition-area"},o.default.createElement("div",{className:"definition-icons"},e({area:"pageCard",onButtonClick:a.onButtonClick.bind(a)}),a.props.cardTable.createBrowseIcons(n,{iconArr:["close","open","max","setCol"],maxDestAreaId:"nc-bill-card"})))},(0,c.default)({props:e,pagecode:"10140ES_elementsys",moduleId:"10140ES",domainName:"uapbd",callback:function(t){t.context;var s=t.template,n=t.lang,o=t.button;a.lang=n,a.initState(t),a.setState(a.state,(function(){e.button.setButtons(o,(function(){a.buttonStatus(),e.meta.setMeta(s,(function(){a.loadTreeData()}))}))}))}}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"dealTreeData",value:function(e){return e.forEach((function(e){!function e(t){t.children&&0!=t.children.length?(t.isLeaf=!1,t.children.forEach((function(t){e(t)}))):delete t.children}(e)})),e}},{key:"onSelectTree",value:function(e){var t=this,a=void 0;e?(a=this.props.syncTree.getSyncTreeValue(this.state.treeId,e),this.props.syncTree.setNodeSelected(this.state.treeId,e),this.state.selectedpk=e):a=this.props.syncTree.getSelectNode(this.state.treeId),a&&a.refpk&&a.refpk!==this.state.root.refpk?(0,l.ajax)({url:p.elesysQueryCard,data:{pk_elementsystem:a.refpk},success:function(e){var a=e.success,s=e.data;if(a&&s&&s.elesystem){var n=s.elesystem;t.props.form.setAllFormValue(d({},t.state.formId,n.head[t.state.formId])),t.props.form.setAllFormValue(d({},"audit",n.head[t.state.formId])),n&&n.body&&n.body[t.state.tableId]?t.props.cardTable.setTableData(t.state.tableId,n.body[t.state.tableId]):t.props.cardTable.setTableData(t.state.tableId,{rows:[]})}},error:function(e){(0,l.toast)({color:"danger",content:e.message})}}):(this.props.form.EmptyAllFormValue(this.state.formId),this.props.cardTable.setTableData(this.state.tableId,{rows:[]}))}},{key:"onMouseEnterEve",value:function(e){var t={};t=e===this.state.root.refpk?{delIcon:!1,editIcon:!1,addIcon:!0}:{delIcon:!0,editIcon:!0,addIcon:!1},this.props.syncTree.hideIcon(this.state.treeId,e,t)}},{key:"buttonStatus",value:function(e){var t=this.props.meta.getMeta();switch("add"===e||"edit"===e?(this.props.form.setFormStatus(this.state.formId,e),this.props.cardTable.setStatus(this.state.tableId,"edit"),t.elementsys&&(t.elementsys.items.forEach((function(e){e.attrcode&&"elesyscoderule"==e.attrcode&&(e.visible=!0)})),this.props.meta.setMeta(t))):(this.props.form.setFormStatus(this.state.formId,"browse"),this.props.cardTable.setStatus(this.state.tableId,"browse"),t.elementsys&&(t.elementsys.items.forEach((function(e){e.attrcode&&"elesyscoderule"==e.attrcode&&(e.visible=!1)})),this.props.meta.setMeta(t))),e){case"add":this.props.button.setButtonVisible(["refresh"],!1),this.props.button.setButtonVisible(["save","saveAdd","cancel"],!0),this.props.syncTree.setNodeDisable(this.state.treeId,!0);break;case"cancel":case"save":this.props.button.setButtonVisible(["refresh"],!0),this.props.button.setButtonVisible(["save","saveAdd","cancel"],!1),this.props.syncTree.setNodeDisable(this.state.treeId,!1);break;case"edit":this.props.button.setButtonVisible(["refresh"],!1),this.props.button.setButtonVisible(["save","saveAdd","cancel"],!0),this.props.syncTree.setNodeDisable(this.state.treeId,!0);break;default:this.props.button.setButtonVisible(["refresh"],!0),this.props.button.setButtonVisible(["save","saveAdd","cancel"],!1)}}},{key:"onAddIconEve",value:function(){var e=this;(0,l.ajax)({url:p.elesysAdd,data:{},success:function(t){t.success&&t.data.billcard.head&&(e.props.form.EmptyAllFormValue(e.state.formId),e.props.cardTable.setTableData(e.state.tableId,{rows:[]}),t.data.billcard.body&&e.props.cardTable.setTableData(e.state.tableId,t.data.billcard.body[e.state.tableId]),e.props.form.setAllFormValue(d({},"audit",t.data.billcard.head[e.state.formId])),e.state.tableStatus="add",e.setState(e.state,(function(){e.buttonStatus("add")})))}})}},{key:"onEditIconEve",value:function(e){var t=this;this.onSelectTree(e.refpk),this.state.tableStatus="edit",this.setState(this.state,(function(){t.buttonStatus("edit")}))}},{key:"onDelIconEve",value:function(e){var t=this;e&&e.refpk?(0,l.promptBox)({color:"info",title:this.lang["10140ES-000007"],content:this.lang["10140ES-000008"],beSureBtnClick:function(){var a={pk_elementsystem:e.nodeData.pk_elementsystem,ts:e.nodeData.ts};(0,l.ajax)({url:p.elesysDel,data:a,success:function(a){var s=t.props.syncTree.getSelectNode(t.state.treeId);t.onRefresh((function(){(0,l.toast)({title:t.lang["10140ES-000009"],color:"success"}),s&&s.refpk&&s.refpk!==e.refpk?t.onSelectTree(s.refpk):t.onSelectTree()}))}})}}):(0,l.toast)({color:"danger",content:this.lang["10140ES-000006"]})}},{key:"render",value:function(){if(!this.lang)return"";var e=this.state,t=e.treeId,a=e.formId,s=e.tableId,n=this.props,r=n.form,l=n.button,c=n.modal,i=n.DragWidthCom,d=n.syncTree,p=n.cardTable,f=n.BillHeadInfo,b=r.createForm,m=d.createSyncTree,h=p.createCardTable,v=(c.createModal,l.createButtonApp),y=f.createBillHeadInfo,I=o.default.createElement("div",{className:"tree-area"},m({treeId:t,needSearch:!0,searchType:"filtration",needEdit:!0,onSelectEve:this.onSelectTree.bind(this),onMouseEnterEve:this.onMouseEnterEve.bind(this),clickAddIconEve:this.onAddIconEve.bind(this),clickEditIconEve:this.onEditIconEve.bind(this),clickDelIconEve:this.onDelIconEve.bind(this),showModal:!1})),g=o.default.createElement("div",null,o.default.createElement("div",{className:"card-area"},b(a,{})),o.default.createElement("div",{className:"nc-bill-table-area"},h(s,{tableHead:this.getTableHead.bind(this),isAddRow:!1,showCheck:!0,showIndex:!0,hideAdd:!0,hideModelSave:!0})));return o.default.createElement("div",{className:"nc-bill-tree-card"},o.default.createElement(u,{areaCode:u.config.HEADER,className:"header"},o.default.createElement("div",{className:"header-title-search-area"},y({title:this.lang["10140ES-000001"],initShowBackBtn:!1})),o.default.createElement("div",{className:" btn-group"},v({area:"btn-group",buttonLimit:3,onButtonClick:this.onButtonClick.bind(this),popContainer:document.querySelector(" btn-group")}))),o.default.createElement("div",{className:"tree-card"},o.default.createElement(i,{leftDom:I,rightDom:g,defLeftWid:"20%"})))}}]),t}(n.Component);b=(0,l.createPage)({billinfo:{billtype:"card",pagecode:"10140ES_elementsys",headcode:"elementsys",bodycode:"eletypes"}})(b),r.default.render(o.default.createElement(b,null),document.querySelector("#app"))},function(e,a){e.exports=t},function(e,t){e.exports=a},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},n=a(0);t.default=function(e){var t=e.callback,a=!1,o=!1,r={},l=function(){a&&o&&t&&t(r)};!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.props.createUIDom(e,(function(t){e.callback&&e.callback(t)}))}(s({},e,{callback:function(e){r=s({},r,e),o=!0,l()}})),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=function(t,a,s){a||(0,n.toast)({content:"加载语言包失败",color:"warning"}),e.callback&&e.callback(t)};e.props.MultiInit.getMultiLang(s({},e,{callback:t}))}(s({},e,{callback:function(e){r=s({},r,{lang:e}),a=!0,l()}}))}}])}));
//# sourceMappingURL=index.f9938eaa.js.map