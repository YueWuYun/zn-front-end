/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-5-15 20:29:54"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("nc-lightapp-front")):"function"==typeof define&&define.amd?define(["react","nc-lightapp-front"],t):"object"==typeof exports?exports["uapbd/orgview/orgview/main/OrgChart.js/index"]=t(require("react"),require("nc-lightapp-front")):e["uapbd/orgview/orgview/main/OrgChart.js/index"]=t(e.React,e["nc-lightapp-front"])}(window,(function(e,t){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="../../../../",n(n.s=453)}({1:function(t,n){t.exports=e},257:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.component=void 0;var i=h(n(262)),r=h(n(263)),o=h(n(264)),a=h(n(265)),l=h(n(266)),s=h(n(267)),c=h(n(268)),u=h(n(269));function h(e){return e&&e.__esModule?e:{default:e}}var d={NCTable:i.default,NCTree:r.default,NCButton:o.default,Refer:a.default,NCSelect:l.default,NCIcon:s.default,NCFormControl:c.default,ReferWapper:u.default};t.component=d},262:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7),l=n(1),s=(i=l)&&i.__esModule?i:{default:i};var c=a.base.NCTable,u=a.base.NCDiv,h=a.base.NCTooltip,d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.initColumns=function(){var e=this,t=this.state.newcols,n=this.props,i=n.columns,o=(n.title,[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i)));if(!(t&&t.length>0)){var a=o[0].dataIndex||o[0].attrcode;["index","numberindex","id"].includes(a)&&Object.assign(o[0],{fixed:"left"});var l=o.map((function(t){var n=t.render;return t.render=function(e,i,o){return s.default.createElement(h,r({},this.tooltipcfg,{overlay:e}),s.default.createElement("span",{fieldid:t.dataIndex,title:""},n?n(e,i,o):e))}.bind(e),t.title=t.title&&"span"===t.title.type?t.title:s.default.createElement("span",{fieldid:t.dataIndex},t.label||t.title),t}));return this.setState({newcols:l}),l}},n.tooltipcfg={className:"tooltip-word-color",placement:"top",delay:1},n.state={newcols:[]},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({newcols:[]})}},{key:"render",value:function(){var e=this.props.columns,t=e&&e.length>0&&this.initColumns(),n=this.state.newcols,i=t||n,o=r({},this.props,{columns:i});return s.default.createElement(u,{fieldid:this.props.fieldid||this.props.tableId||"basetable_comp",areaCode:u.config.TableCom},i&&i.length>0&&s.default.createElement(c,o))}}]),t}(l.Component);t.default=d},263:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7),l=n(1),s=(i=l)&&i.__esModule?i:{default:i};var c=a.base.NCTree,u=a.base.NCDiv,h=c.NCTreeNode,d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.getParentDomFieldId=function(e){var t=ReactDOM.findDOMNode(e);if(!t)return null;return function e(t){for(;t.parentElement;)return t.parentElement.hasAttribute("fieldid")?t.parentElement.getAttribute("fieldid"):e(t.parentElement)}(t)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this.getParentDomFieldId(this),t=e&&e.substr(0,e.indexOf("_")),n=this.props.fieldid||t||this.props.treeId||"basetree_comp",i=r({},this.props,{fieldid:n,openIcon:s.default.createElement("i",{fieldid:"opentree-switcher",class:"icon iconfont icon-shu_zk tree-swich"}),closeIcon:s.default.createElement("i",{fieldid:"closetree-switcher",class:"icon iconfont icon-shushouqi tree-swich"})});return s.default.createElement(u,{fieldid:n,areaCode:u.config.TreeCom},s.default.createElement(c,i))}}]),t}(l.Component);d.NCTreeNode=h,t.default=d},264:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7),l=n(1),s=(i=l)&&i.__esModule?i:{default:i};var c=a.base.NCButton,u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=r({},this.props,{fieldid:this.props.fieldid||this.props.id||this.props.key||"selfopr"});return s.default.createElement(c,e)}}]),t}(l.Component);t.default=u},265:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(1),l=(i=a)&&i.__esModule?i:{default:i};var s=n(7).high.Refer,c=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this.props,t=e.attrcode,n=e.fieldid,i=e.refCode,o=e.refName,a=e.refType,c=e.queryTreeUrl,u=e.queryGridUrl,h=("tree"==a||"gridTree"==a?c:u).split("/"),d=null;h[h.length-1]&&h[h.length-1].split(".").length>1&&(d=h[h.length-1].split(".")[0].toLowerCase());var f=null;if(i&&i.indexOf(".")>-1){var p=i.split(".");f=p[p.length-1].toLowerCase()}var y=r({},this.props,{fieldid:t||(n||d||f||o)});return l.default.createElement(s,y)}}]),t}(a.Component);t.default=c},266:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7),l=n(1),s=(i=l)&&i.__esModule?i:{default:i};var c=a.base.NCSelect,u=c.NCOption,h=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this.props.fieldid||this.props.defaultValue||"common",t=r({},this.props,{fieldid:e});return s.default.createElement(c,t)}}]),t}(l.Component);h.NCOption=u,t.default=h},267:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7),l=n(1),s=(i=l)&&i.__esModule?i:{default:i};var c=a.base.NCIcon,u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=r({},this.props,{fieldid:this.props.fieldid||this.props.type});return s.default.createElement(c,e)}}]),t}(l.Component);t.default=u},268:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(7),l=n(1),s=(i=l)&&i.__esModule?i:{default:i};var c=a.base.NCFormControl,u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this.props,t=e.fieldid,n=e.type,i=e.key,o=e.placeholder,a=r({},this.props,{fieldid:t||n||i||o||"ncformcontrol"});return s.default.createElement(c,a)}}]),t}(l.Component);t.default=u},269:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(1),l=(i=a)&&i.__esModule?i:{default:i};var s=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this.props,t=e.ReferComp,n=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["ReferComp"]),i=t&&t();if(!i)return null;var o=i.props,a=o.attrcode,s=o.fieldid,c=o.refCode,u=o.refName,h=o.refType,d=o.queryTreeUrl,f=o.queryGridUrl,p=("tree"==h||"gridTree"==h?d:f).split("/"),y=p[p.length-1].split(".")[0].toLowerCase(),v=null;if(c&&c.indexOf(".")>-1){var b=c.split(".");v=b[b.length-1].toLowerCase()}var m=r({},n,{fieldid:a||(s||y||v||u)});return l.default.createElement(t,m)}}]),t}(a.Component);t.default=s},453:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=n(1),s=(i=l)&&i.__esModule?i:{default:i},c=n(7),u=n(257);var h=u.component.NCButton,d=u.component.NCSelect,f=c.base.NCModal,p=(c.base.NCFormControl,c.base.NCInputNumber),y=0,v=0,b=[],m=0,g=0;function x(e){var t=e.treedata,n=e.parentNode,i=e.nodeStyle,r=e.direction,o=e.maxTier,l=[];if(t){if(this.nodeStyle=function(e){var t={};for(var n in e)t[n]="object"===a(e[n])?this.deepObj(e[n]):e[n];return t}(i),this.width=i.width,this.height=i.height,this.parentNode=n,this.text=t.name,this.code=t.code,this.data=t,t.tier=n?n.tier+1:0,t.children&&t.children.length>0){switch(l=t.children.map((function(e){return new x({treedata:e,parentNode:t,nodeStyle:i,direction:r,maxTier:o})})),r){case"top":this.y=t.tier*(this.height+i.spanceY)+50,this.x=(l[l.length-1].x+l[0].x)/2;break;case"left":this.y=(l[l.length-1].y+l[0].y)/2,this.x=t.tier*(this.width+i.spanceX)+50}this.btnBoole=t.tier<o}else switch(r){case"top":this.y=t.tier*(this.height+i.spanceY)+50,y=y>this.y?y:this.y,this.x=v+50,v=v+i.width+i.spanceX;break;case"left":this.x=t.tier*(this.width+i.spanceX)+50,y=y>this.x?y:this.x,this.y=v+50,v=v+i.height+i.spanceY}this.childsNode=l,b.push(this)}}var w=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={direction:"top",nodeStyle:{width:116,height:54,lineWidth:2,linecolor:"#B2B2B2",borderColor:"white",borderWidth:.1,bgcolor:"#CCEAFF",font:"600 13px MicrosoftYaHei",fontName:"12px MicrosoftYaHei",fontSize:"12",fontFormat:"MicrosoftYaHei",fontColor:"#0063D4",textAlign:"center",textBaseline:"middle",btnR:8,spanceX:35,spanceY:53},setStyle:{width:116,height:54,spanceX:35,spanceY:53,tier:10,zoom:100,direction:"top"},tier:10,zoom:100,maxlen:0,maxDeep:0,moveNode:!1,setModalShow:!1},n.datas=e.data||{},n.handleSelectClick=n.handleSelectClick.bind(n),n.handleMaxTier=n.handleMaxTier.bind(n),n.handleZoom=n.handleZoom.bind(n),n.handleSetWidth=n.handleSetWidth.bind(n),n.handleSetHeight=n.handleSetHeight.bind(n),n.handleSpacY=n.handleSpacY.bind(n),n.handleSpacX=n.handleSpacX.bind(n),n.hanldShowSetModal=n.hanldShowSetModal.bind(n),n.handleCanvasClick=n.handleCanvasClick.bind(n),n.handleCanvasMouseDown=n.handleCanvasMouseDown.bind(n),n.handleCanvasMouseMove=n.handleCanvasMouseMove.bind(n),n.handleCanvasMouseUp=n.handleCanvasMouseUp.bind(n),n.handleFont=n.handleFont.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"componentDidMount",value:function(){var e=this.refs.view;this.ctx=e.getContext("2d")}},{key:"componentWillReceiveProps",value:function(e){if(this.lang=e.data.lang,0!=Object.keys(e.data).length&&(e.data.name!==this.datas.name||e.data.children.length!==this.datas.children.length))if(this.datas=e.data,this.datas.children&&0!==this.datas.children.length){if(this.initTreeNode(),31e3===this.state.canvaWidth||31e3===this.state.canvaHeight){if(document.getElementsByClassName("toast-mask-modal demo--demo").length>0)return!1;(0,c.toast)({title:this.lang&&this.lang["ORGVIEW-003001"],content:this.lang&&this.lang["ORGVIEW-003002"],color:"warning",duration:.2})}}else this.ctx.clearRect(0,0,this.state.canvaWidth,this.state.canvaHeight)}},{key:"calculate",value:function(e){var t=this,n=e.treenode,i=e.parentNode,r=e.clickXY,o=n.nodeStyle;m=m>n.x+o.width?m:n.x+o.width,g=g>n.y+o.height?g:n.y+o.height,(n.x<3100||n.y<3100)&&(this.drawLine({treenode:n,parentNode:i}),this.drawRectangle({treenode:n,nodeStyle:o}),this.drawText({treenode:n,nodeStyle:o})),r&&this.pointInsideCircle(r,n.btnXY,o.btnR)&&(n.btnBoole=!n.btnBoole,r=null),n.btnBoole&&n.childsNode.map((function(e){return t.calculate({treenode:e,parentNode:n,clickXY:r})})),n.childsNode&&0!==n.childsNode.length&&this.drawBtn(n,o)}},{key:"handleCanvasClick",value:function(e){var t=this,n=(this.state.nodeStyle,e.pageX-(e.target.getBoundingClientRect().x||16)),i=e.pageY-(e.target.getBoundingClientRect().y||206);this.ctx.clearRect(0,0,this.state.canvaWidth,this.state.canvaHeight),this.drawBg(),this.nodes.map((function(e){t.calculate({treenode:e,clickXY:{x:n,y:i}})}))}},{key:"handleSelectClick",value:function(e){var t=this.state.setStyle;t.direction=e,this.setState(t)}},{key:"handleMaxTier",value:function(e){var t=this.state.setStyle;t.tier=Number(e),this.setState(t)}},{key:"handleZoom",value:function(e){var t=this.state.setStyle;t.zoom=e,this.setState(t)}},{key:"handleCanvasMouseDown",value:function(e){var t={x:100*(e.pageX-(e.target.getBoundingClientRect().x||16))/this.state.zoom,y:100*(e.pageY-(e.target.getBoundingClientRect().y||206))/this.state.zoom};this.prev&&(this.prev.nodeStyle.fontColor=this.state.nodeStyle.fontColor,this.prev.nodeStyle.borderColor=this.state.nodeStyle.borderColor,this.prev.nodeStyle.borderWidth=this.state.nodeStyle.borderWidth);var n=!0,i=!1,r=void 0;try{for(var o,a=b[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value,s=!1;if(this.pointInsideRectangle(t,l,{x:l.x+l.width,y:l.y+l.height})){s=!0,l.nodeStyle.fontColor="black",l.nodeStyle.borderColor="#0096FF",l.nodeStyle.borderWidth=2,this.setState({moveNode:{downXY:t,node:l,initXY:{x:l.x,y:l.y}}}),this.prev=l,this.props.setSelectNode(l);break}s||this.props.setSelectNode(null)}}catch(e){i=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}}},{key:"handleCanvasMouseMove",value:function(e){var t=this;if(!this.state.moveNode)return!1;var n=100*(e.pageX-(e.target.getBoundingClientRect().x||16))/this.state.zoom,i=100*(e.pageY-(e.target.getBoundingClientRect().y||206))/this.state.zoom,r=this.state.moveNode;r.node.x=r.initXY.x+n-r.downXY.x,r.node.y=r.initXY.y+i-r.downXY.y,this.ctx.clearRect(0,0,this.state.canvaWidth,this.state.canvaHeight),this.drawBg(),m=0,g=0,this.nodes.map((function(e){t.calculate({treenode:e})}))}},{key:"handleCanvasMouseUp",value:function(){this.props.getCanvasWH(m+50,g+50),this.setState({moveNode:!1})}},{key:"handleSetWidth",value:function(e){var t=this.state.setStyle;t.width=Number(e),this.setState(t)}},{key:"handleSetHeight",value:function(e){var t=this.state.setStyle;t.height=Number(e),this.setState(t)}},{key:"handleFont",value:function(e){var t=this.state.nodeStyle;t.fontSize=e,t.font=Number(t.fontSize)+1+"px "+t.fontFormat,t.font="600 "+String(t.font),t.fontName=t.fontSize+"px "+t.fontFormat,this.setState(t,this.drawNode)}},{key:"handleSpacY",value:function(e){var t=this.state.setStyle;t.spanceY=Number(e),this.setState(t)}},{key:"handleSpacX",value:function(e){var t=this.state.setStyle;t.spanceX=Number(e),this.setState(t)}},{key:"hanldShowSetModal",value:function(){this.setState({setModalShow:!0})}},{key:"hanldHideSetModal",value:function(){var e=this,t=this.state.setStyle,n=this.state.nodeStyle;n=r({},n,t),this.setState({nodeStyle:n},(function(){e.initTreeNode()})),this.props.hanldHideSetModal()}},{key:"drawBtn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.nodeStyle;switch(e.btnXY={x:0,y:0},this.state.direction){case"top":e.btnXY.x=e.x+t.width/2,e.btnXY.y=e.y+t.height+t.btnR;break;case"left":e.btnXY.x=e.x+t.width+t.btnR,e.btnXY.y=e.y+t.height/2}this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=t.lineWidth,this.ctx.fillStyle="#1CA1FD",this.ctx.arc(e.btnXY.x,e.btnXY.y,t.btnR,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.strokeStyle="white",this.ctx.moveTo(e.btnXY.x-t.btnR+4,e.btnXY.y),this.ctx.lineTo(e.btnXY.x+t.btnR-4,e.btnXY.y),e.btnBoole||(this.ctx.moveTo(e.btnXY.x,e.btnXY.y-t.btnR+4),this.ctx.lineTo(e.btnXY.x,e.btnXY.y+t.btnR-4)),this.ctx.stroke(),this.ctx.restore()}},{key:"drawText",value:function(e){var t=e.treenode,n=e.nodeStyle,i=void 0===n?this.state.nodeStyle:n;this.ctx.save(),this.ctx.beginPath(),this.ctx.font=this.state.nodeStyle.font,this.ctx.textAlign=i.textAlign,this.ctx.textBaseline="middle",this.ctx.fillStyle=i.fontColor,this.ctx.fillText(this.textIntercept(t.code),t.x+i.width/2,t.y+i.height/2-i.fontSize/2-2),this.ctx.font=this.state.nodeStyle.fontName,this.ctx.textBaseline="middle",this.ctx.fillText(this.textIntercept(t.text),t.x+i.width/2,t.y+i.height/2+i.fontSize/2+2),this.ctx.stroke(),this.ctx.restore()}},{key:"drawBg",value:function(){this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,this.state.canvaWidth,this.state.canvaHeight),this.ctx.restore()}},{key:"textIntercept",value:function(e){if(Number(this.ctx.measureText(e).width)>this.state.nodeStyle.width)for(var t=1;t<e.length;t++)if(Number(this.ctx.measureText(e.substring(0,e.length-t)+"...").width)<this.state.nodeStyle.width){e=e.substring(0,e.length-t)+"...";break}return e}},{key:"drawRectangle",value:function(e){var t=e.treenode,n=e.nodeStyle,i=void 0===n?this.state.nodeStyle:n;this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=i.bgcolor,this.ctx.fillRect(t.x,t.y,this.state.nodeStyle.width,this.state.nodeStyle.height),this.ctx.lineWidth=i.borderWidth,this.ctx.strokeStyle=i.borderColor,this.ctx.strokeRect(t.x,t.y,i.width,i.height),this.ctx.stroke(),this.ctx.restore()}},{key:"drawLine",value:function(e){var t=e.treenode,n=e.parentNode,i=e.nodeStyle,r=void 0===i?this.state.nodeStyle:i;if(n){var o=this.lineCount({treenode:t,parentNode:n}),a=o.linXY1,l=o.linXY2,s=o.linXY3,c=o.linXY4;this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle=r.linecolor,this.ctx.moveTo(a.x,a.y),this.ctx.lineTo(l.x,l.y),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(l.x,l.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(c.x,c.y),this.ctx.stroke(),this.ctx.restore()}}},{key:"canvaWH",value:function(e){var t=0,n=0,i="Chrome"===this.myBrowser()?31e3:8300;parseInt(this.getCurrentStyle(this.refs.orgchart).width),parseInt(this.getCurrentStyle(this.refs.orgchart).height);switch(e){case"top":t=v-this.state.nodeStyle.spanceX+100,n=y+this.state.nodeStyle.height+50;break;case"left":t=y+this.state.nodeStyle.width+50,n=v-this.state.nodeStyle.spanceY+100}return t=t>i?i:t,n=n>i?i:n,this.props.getCanvasWH(t,n),this.picWidth=t,this.picHeight=n,t<1500&&(t=1500),n<480&&(n=480),v=0,y=0,{canvaWidth:t,canvaHeight:n}}},{key:"lineCount",value:function(e){var t,n,i,r,o,a,l,s=e.treenode,c=e.parentNode,u=e.nodeStyle,h=void 0===u?this.state.nodeStyle:u;switch(this.state.direction){case"top":a=[c.x+h.width/2,c.y+h.height+2*h.btnR],s.y>a[1]?(l=[s.x+h.width/2,s.y],n={x:a[0],y:a[1]+(l[1]-a[1])/2},i={x:l[0],y:n.y}):s.y-a[1]<5&&a[1]-s.y<s.height/2?(l=[s.x+s.width,s.y+s.height/2],n={x:a[0],y:l[1]},i={x:l[0],y:l[1]}):a[1]-s.y>=s.height/2&&(l=[s.x+s.width/2,s.y+s.height],n={x:a[0],y:a[1]},i={x:l[0],y:n.y}),t={x:a[0],y:a[1]},r={x:l[0],y:l[1]};break;case"left":a=[c.x+h.width+2*h.btnR+h.lineWidth,c.y+h.height/2],o=(s.x-h.width-c.x)/2,s.x>a[0]?(l=[s.x,s.y+h.height/2],i={x:(n={x:a[0]+(l[0]-a[0])/2,y:a[1]}).x,y:l[1]}):s.x-a[0]<5&&a[0]-s.x<s.width/2?(n={x:(l=[s.x+s.width/2,s.y+s.height])[0],y:a[1]},i={x:l[0],y:l[1]}):a[0]-s.x>=s.width/2?(l=[s.x+s.width,s.y+s.height/2],i={x:(n={x:a[0],y:a[1]}).x,y:l[1]}):i={x:(n={x:t.x+o,y:t.y}).x,y:s.y+h.height/2},t={x:a[0],y:a[1]},r={x:l[0],y:l[1]}}return{linXY1:t,linXY2:n,linXY3:i,linXY4:r}}},{key:"pointInsideCircle",value:function(e,t,n){if(0===n||!e||!t)return!1;var i=t.x-100*e.x/this.state.zoom,r=t.y-100*e.y/this.state.zoom;return i*i+r*r<=n*n}},{key:"pointInsideRectangle",value:function(e,t,n){var i=e.x>t.x&&e.x<n.x,r=e.y>t.y&&e.y<n.y;return i&&r}},{key:"initTreeNode",value:function(){var e=this;v=0,y=0,b=[],this.nodes=[],this.datas.children.map((function(t){e.nodes.push(new x({treedata:t,nodeStyle:e.state.nodeStyle,direction:e.state.direction,maxTier:e.state.tier}))})),this.setState(this.canvaWH(this.state.direction),(function(){e.ctx.clearRect(0,0,e.state.canvaWidth,e.state.canvaHeight),e.drawBg(),e.nodes.map((function(t){e.calculate({treenode:t})}))}))}},{key:"drawNode",value:function(){var e=this;this.ctx.clearRect(0,0,this.state.canvaWidth,this.state.canvaHeight),this.drawBg(),this.nodes.map((function(t){e.calculate({treenode:t})}))}},{key:"getCurrentStyle",value:function(e){return window.getComputedStyle?window.getComputedStyle(e,null):e.currentStyle}},{key:"cancleNodeStyle",value:function(){var e=this;this.setState(this.saveCanvasStyle,(function(){e.drawNode()})),this.props.hanldHideSetModal()}},{key:"saveStyle",value:function(){var e=this.deepObj(this.state);this.saveCanvasStyle=e}},{key:"deepObj",value:function(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"===a(e[n])?this.deepObj(e[n]):e[n];return t}},{key:"myBrowser",value:function(){var e=navigator.userAgent,t=e.indexOf("Opera")>-1,n=e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!t,i=e.indexOf("Firefox")>-1,r=(e.indexOf("Safari"),e.indexOf("Chrome")>-1);if(n){IE55=IE6=IE7=IE8=!1;new RegExp("MSIE (\\d+\\.\\d+);").test(e);var o=parseFloat(RegExp.$1);if(IE55=5.5==o,IE6=6==o,IE7=7==o,IE8=8==o,IE55)return"IE55";if(IE6)return"IE6";if(IE7)return"IE7";if(IE8)return"IE8"}return i?"FF":t?"Opera":r?"Chrome":void 0}},{key:"render",value:function(){return s.default.createElement("div",{style:{width:"100%",height:"100%"},ref:"orgchart"},s.default.createElement("canvas",{ref:"view",id:"view",width:this.state.canvaWidth,height:this.state.canvaHeight,style:{width:this.state.canvaWidth*this.state.zoom/100,height:this.state.canvaHeight*this.state.zoom/100},onClick:this.handleCanvasClick,onMouseDown:this.handleCanvasMouseDown,onMouseMove:this.handleCanvasMouseMove,onMouseUp:this.handleCanvasMouseUp}),s.default.createElement(f,{fieldid:"orgchart",className:"setModal",onEntered:this.saveStyle.bind(this),show:this.props.setModalShow,onHide:this.props.hanldHideSetModal,size:"lg"},s.default.createElement(f.Header,{closeButton:!0},s.default.createElement(f.Title,null,this.lang&&this.lang["ORGVIEW-003003"])),s.default.createElement(f.Body,{className:"nc-theme-common-font-c"},s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003004"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(d,{fieldid:"orgchartselect",onChange:this.handleSelectClick,defaultValue:this.state.setStyle.direction},s.default.createElement(d.NCOption,{value:"top"},this.lang&&this.lang["ORGVIEW-003005"]),s.default.createElement(d.NCOption,{value:"left"},this.lang&&this.lang["ORGVIEW-003006"])))),s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003007"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(p,{fieldid:"inputnum",value:this.state.setStyle.tier,onChange:this.handleMaxTier}))),s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003008"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(p,{fieldid:"inputnumview",value:this.state.setStyle.height,onChange:this.handleSetHeight}))),s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003009"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(p,{fieldid:"inputnumkao",value:this.state.setStyle.width,onChange:this.handleSetWidth}))),s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003010"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(p,{fieldid:"inputnumspany",value:this.state.setStyle.spanceY,onChange:this.handleSpacY}))),s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003011"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(p,{fieldid:"inputnumspanx",value:this.state.setStyle.spanceX,onChange:this.handleSpacX}))),s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003012"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(p,{fieldid:"inputnumzoom",value:this.state.setStyle.zoom,onChange:this.handleZoom}))),s.default.createElement("div",{className:"setModalTd"},s.default.createElement("span",{className:"setName"},this.lang&&this.lang["ORGVIEW-003013"]),s.default.createElement("div",{className:"setContent"},s.default.createElement(p,{fieldid:"inputnumtext",max:this.state.nodeStyle.height/2-10,value:this.state.nodeStyle.fontSize,onChange:this.handleFont})))),s.default.createElement(f.Footer,{style:{height:"auto"}},s.default.createElement("span",{className:"toastTest"},this.lang&&this.lang["ORGVIEW-003014"]),s.default.createElement(h,{fieldia:"orgchartbut1",className:"button-primary",onClick:this.hanldHideSetModal.bind(this)},this.lang&&this.lang["ORGVIEW-003015"]),s.default.createElement(h,{fieldia:"orgchartbut1",onClick:this.cancleNodeStyle.bind(this)},this.lang&&this.lang["ORGVIEW-003016"]))))}}]),t}(l.Component);t.default=w},7:function(e,n){e.exports=t}})}));
//# sourceMappingURL=index.da6e0931.js.map