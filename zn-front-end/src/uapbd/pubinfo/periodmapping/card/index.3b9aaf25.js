/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-5-11 15:03:01"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uapbd/pubinfo/periodmapping/card/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uapbd/pubinfo/periodmapping/card/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,a){return function(e){var t={};function a(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(r,o,function(t){return e[t]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=173)}({1:function(t,a){t.exports=e},173:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),n=a(2),d=c(n),l=(c(a(3)),a(1));function c(e){return e&&e.__esModule?e:{default:e}}function u(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f=l.base.NCAffix,m=(l.base.NCPopconfirm,l.base.NCFormControl,l.base.NCBackBtn,l.high.PrintOutput),h=l.cardCache.addCache,b=l.cardCache.getCacheById,g=l.cardCache.updateCache,v=l.cardCache.getCurrentLastId,y=l.cardCache.getNextId,C=l.cardCache.deleteCacheById,A="upabd.pubinfo.periodmapping.data",I="periodmappingh",P="periodmappingb",w="10140ACMAP_card",k="/nccloud/uapbd/periodmapping/extraInfo.do",M="/nccloud/uapbd/periodmapping/insert.do",S="/nccloud/uapbd/periodmapping/update.do",j="pk_peiodmapping",E=(r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.call(a),a.formId=I,a.tableId=P,a.state={pk_org:"",title_code:"",totalcount:0,applycount:0,backVisible:!0,json:{}},a.yearData={},a.preCode={value:"",display:""},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"modifierMeta",value:function(e,t){var a=this,r=e.getUrlParam("status");t[I].status=r,t[P].status=r,t[I].items.find((function(e){return"targetperiod"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodMappingFilterEmpScheEBuilder"}},t[I].items.find((function(e){return"sourceperiod"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodMappingFilterEmpScheEBuilder"}},t[P].items.forEach((function(t){"sourcebeginperiodmth"!=t.attrcode&&"sourceendperiodmth"!=t.attrcode||(t.queryCondition=function(){return{pk_accperiodscheme:e.form.getFormItemsValue(a.formId,"sourceperiod").value}})})),t.detail_b.items.forEach((function(t){"sourcebeginperiodmth"!=t.attrcode&&"sourceendperiodmth"!=t.attrcode||(t.queryCondition=function(){return{pk_accperiodscheme:e.form.getFormItemsValue(a.formId,"sourceperiod").value}})})),t.detail_e.items.forEach((function(t){"sourcebeginperiodmth"!=t.attrcode&&"sourceendperiodmth"!=t.attrcode||(t.queryCondition=function(){return{pk_accperiodscheme:e.form.getFormItemsValue(a.formId,"sourceperiod").value}})}));var o={itemtype:"customer",attrcode:"opr",label:this.state.json?this.state.json["10140ACMAP-000000"]:"10140ACMAP-000000",visible:!0,className:"table-opr",width:200,fixed:"right",render:function(t,r,o){var i=[],s=a.props.getUrlParam("status");return i.push("add"==s||"edit"==s?"More":"Expand"),"add"==s||"edit"==s?e.button.createOprationButton(i,{area:"row-action",buttonLimit:3,onButtonClick:function(e,i){return a.tableButtonClick(e,i,t,r,o)}}):""}};return t[P].items.push(o),t}},{key:"tableButtonClick",value:function(e,t,a,r,o){switch(t){case"More":e.cardTable.openModel(P,"edit",r,o);break;case"Expand":e.cardTable.toggleRowView(P,r);break;case"RowDel":e.cardTable.delRowsByIndex(P,o);break;case"RowInsert":e.cardTable.addRow(P,o)}}},{key:"componentDidMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"10140ACMAP",domainName:"uapbd",callback:function(t){e.setState({json:t},(function(){e.initTemplate(e.props,(function(){e.toggleShow(),e.updateCardTableBtnStatus();var t=e.props.getUrlParam("status");if("add"!=t){var a=e.props.getUrlParam("id");a&&"undefined"!=a&&e.getdata(a)}else e.processBillCode(!0),e.setDefaultValue();"add"!=t&&"edit"!=t||e.setState({backVisible:!1})}))}))}})}},{key:"toggleShow",value:function(){var e=this.props.getUrlParam("status"),t=this.props.getUrlParam("id"),a=[],r=[];"browse"==e&&"null"==t?(a=["Add"],r=["SaveAdd","Edit","back","Delete","Refresh","Enable","Disable","Print","Output","Save","Cancel","AddLine","DelLine"]):"edit"==e||"add"==e?(r=["Edit","Add","back","Delete","Refresh","Enable","Disable","Print","Output"],a=["Save","Cancel","AddLine","DelLine"],"add"==e?a.push("SaveAdd"):r.push("SaveAdd"),this.props.cardPagination.setCardPaginationVisible("cardPaginationBtn",!1)):(r=["Save","Cancel","AddLine","DelLine","SaveAdd"],a=["Add","Edit","Delete","back","Refresh","Print","Output"],this.props.cardPagination.setCardPaginationVisible("cardPaginationBtn",!0)),this.props.form.setFormStatus(I,"edit"),this.props.form.setFormItemsDisabled(I,{code:"add"!=e,targetperiod:"add"!=e,sourceperiod:"add"!=e,targetyear:!1}),this.props.cardTable.setStatus(P,"edit"==e||"add"==e?"edit":"browse"),this.props.button.setButtonVisible(r,!1),this.props.button.setButtonVisible(a,!0),this.updateCardTableBtnStatus(),window.onbeforeunload="add"!=e&&"edit"!=e?null:function(){return""}}},{key:"processBillCode",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a={operation:t?"getCode":"cancelCode"};!t&&this.isPreCode&&(a.billCode=this.preCode),(0,l.ajax)({url:k,data:a,success:function(a){t&&a.data.hasCode&&(e.props.form.setFormItemsValue(e.formId,{code:{display:a.data.code,value:a.data.code}}),e.props.form.setFormItemsDisabled(e.formId,{code:"pre"!=a.data.codeType||!a.data.editable}),e.preCode=a.data.code,e.isPreCode="pre"==a.data.codeType,e.isCodeEditable="pre"!=a.data.codeType||!a.data.editable)}})}},{key:"cancelSureEvent",value:function(){var e=this;if("add"===this.props.getUrlParam("status")){var t=v(A);this.getDataForCache(t,(function(){e.props.pushTo("/card",{status:"browse",pagecode:"10140ACMAP_card",id:e.props.getUrlParam("id")}),e.props.form.setFormStatus(e.formId,"browse"),e.props.cardTable.setStatus(e.tableId,"browse")}))}"edit"===this.props.getUrlParam("status")&&(this.props.form.cancel(this.formId),this.getdata(this.props.getUrlParam("id")),this.props.pushTo("/card",{status:"browse",pagecode:"10140ACMAP_card",id:this.props.getUrlParam("id")}),this.toggleShow()),this.setState({backVisible:!0}),this.processBillCode(),this.yearData=[]}},{key:"afterEvent",value:function(e,t,a,r,o){var i=this;if("targetyear"==a&&r.value!=o.value){var s=this.props.getUrlParam("status");if(this.yearData[r.display])return this._recordYearData(o.display),void this.props.cardTable.setTableData(this.tableId,this.yearData[r.display]);var n=r.refpk;null!=r.values&&null!=r.values.periodyear&&(r.values.periodyear.display=r.values.periodyear.value,this.props.form.setFormItemsValue(this.formId,{targetyear:r.values.periodyear}));var d={operation:"targetYearChanged",pk_periodmapping:e.getUrlParam("id"),pk_sourcePeriod:e.form.getFormItemsValue(this.formId,"sourceperiod").value,pk_targetPeriod:e.form.getFormItemsValue(this.formId,"targetperiod").value,targetperiodyear:n,year:e.form.getFormItemsValue(this.formId,"targetyear").display,status:s};(0,l.ajax)({url:k,data:d,success:function(e){i._recordYearData(o.display),i._displayDataFromRes(e),i.props.form.setFormItemsValue(i.formId,{code:i.preCode})}})}else if("targetperiod"==a&&r.value!=o.value){var c=this.props.form.getFormItemsValue(this.formId,"sourceperiod"),u=this.props.meta.getMeta();if(u[this.formId].items.find((function(e){return"sourceperiod"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodSchemeExceptSqlBuilder",pk_accperiodscheme:r.value}},u[I].items.find((function(e){return"targetyear"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodMappingExtSqlBuilder",pk_accperiodscheme:r.value}},this.props.meta.setMeta(u),this.props.form.setFormItemsDisabled(this.formId,{sourceperiod:!1,targetyear:!1}),this.yearData=[],c&&c.value){var p={operation:"targetYearChanged",pk_periodmapping:e.getUrlParam("id"),pk_sourcePeriod:e.form.getFormItemsValue(this.formId,"sourceperiod").value,pk_targetPeriod:r.value,targetperiodyear:null,year:null};(0,l.ajax)({url:k,data:p,success:function(e){i._recordYearData(o.display),i._displayDataFromRes(e),i.props.form.setFormItemsValue(i.formId,{code:i.preCode})}})}else{var f={operation:"targetPeriodSelected",pk_targetPeriod:r.value};(0,l.ajax)({url:k,data:f,success:function(e){e.data&&i.props.form.setFormItemsValue(i.formId,{targetyear:{value:e.data[0],display:e.data[1]}})}})}}else if("sourceperiod"==a&&r.value!=o.value){this.yearData=[];var m=this.props.meta.getMeta();m[P].items.find((function(e){return"sourcebeginperiodmth"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodMappingExtSqlBuilder",pk_accperiodscheme:r.value}},m[P].items.find((function(e){return"sourceendperiodmth"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodMappingExtSqlBuilder",pk_accperiodscheme:r.value}},this.props.meta.setMeta(m,(function(){var t=i.props.form.getFormItemsValue(i.formId,"targetperiod"),a=i.props.form.getFormItemsValue(i.formId,"targetyear");if(t&&t.value){var r={operation:"targetYearChanged",pk_periodmapping:e.getUrlParam("id"),pk_sourcePeriod:e.form.getFormItemsValue(i.formId,"sourceperiod").value,pk_targetPeriod:t.value,targetperiodyear:a&&a.value?a.value:null,year:a&&a.value?a.display:null};(0,l.ajax)({url:k,data:r,success:function(e){i._recordYearData(o.display),i._displayDataFromRes(e),i.props.form.setFormItemsValue(i.formId,{code:i.preCode})}})}}))}}},{key:"beforeEvent",value:function(e,t,a,r,o){switch(a){case"sourceperiod":return!!e.form.getFormItemsValue(t,"targetperiod").value}return!0}},{key:"_recordYearData",value:function(e){var t=this.props.getUrlParam("status");if("edit"==t||"add"==t){var a=this.props.cardTable.getAllData(this.tableId);this.yearData[e]=a}this.preCode=this.props.form.getFormItemsValue(this.formId,"code")}},{key:"_fixRef",value:function(){}},{key:"_displayDataFromRes",value:function(e){if(e.data.head){this.props.form.setAllFormValue(p({},this.formId,e.data.head[this.formId]));var t=e.data.head[this.formId].rows[0].values.code.value;this.setState({title_code:t}),this.toggleShow(),g(j,e.data.head[I].rows[0].values[j].value,e.data,I,A);var a=this.props.meta.getMeta();a[I].items.find((function(e){return"targetyear"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodMappingExtSqlBuilder",pk_accperiodscheme:e.data.head[I].rows[0].values.targetperiod.value}},a[P].items.find((function(e){return"sourcebeginperiodmth"==e.attrcode})).queryCondition=function(){return{pk_accperiodscheme:e.data.head[I].rows[0].values.sourceperiod.value}},a[P].items.find((function(e){return"sourceendperiodmth"==e.attrcode})).queryCondition=function(){return{pk_accperiodscheme:e.data.head[I].rows[0].values.sourceperiod.value}},this.props.meta.setMeta(a)}if(e.data.body){this.props.cardTable.setTableData(this.tableId,e.data.body[this.tableId]);var r=this.props.cardTable.getNumberOfRows(this.tableId);this.props.cardTable.getAllRows(this.tableId);this.setState({applycount:0}),this.setState({totalcount:r})}else this.props.cardTable.setTableData(this.tableId,{rows:[]}),this.setState({totalcount:0});var o;e.formulamsg&&e.formulamsg instanceof Array&&e.formulamsg.length>0&&this.props.dealFormulamsg(e.formulamsg,(p(o={},I,"form"),p(o,P,"cardTable"),o))}},{key:"onCardTableAfterEvent",value:function(e,t,a,r,o,i,s){var n=this;if(o[0].newvalue.value!=o[0].oldvalue.value&&"sourcebeginperiodmth"==a){var d=this.props.createMasterChildData(w,this.formId,this.tableId);d.operation="beginPeriodMonth",d.index=i,d.yearmth=e.cardTable.getValByKeyAndIndex(this.tableId,i,a).display,(0,l.ajax)({url:k,data:d,success:function(e){if(e.data.head){n.props.form.setAllFormValue(p({},n.formId,e.data.head[n.formId]));var t=e.data.head[n.formId].rows[0].values.code.value;n.setState({title_code:t}),n.toggleShow(),n.props.form.setFormItemsValue(I,{targetyear:{value:e.data.head[I].rows[0].values.targetperiodyear.value,display:e.data.head[I].rows[0].values.targetperiodyear.display}});var a=n.props.meta.getMeta();a[I].items.find((function(e){return"targetyear"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.uapbd.periodmapping.action.PeriodMappingExtSqlBuilder",pk_accperiodscheme:e.data.head[I].rows[0].values.targetperiod.value}},a[P].items.find((function(e){return"sourcebeginperiodmth"==e.attrcode})).queryCondition=function(){return{pk_accperiodscheme:e.data.head[I].rows[0].values.sourceperiod.value}},a[P].items.find((function(e){return"sourceendperiodmth"==e.attrcode})).queryCondition=function(){return{pk_accperiodscheme:e.data.head[I].rows[0].values.sourceperiod.value}},n.props.meta.setMeta(a)}if(e.data.body){n.props.cardTable.setTableData(n.tableId,e.data.body[n.tableId]);var r=n.props.cardTable.getNumberOfRows(n.tableId);n.props.cardTable.getAllRows(n.tableId);n.setState({applycount:0}),n.setState({totalcount:r})}else n.props.cardTable.setTableData(n.tableId,{rows:[]})}})}}},{key:"getDataForCache",value:function(e,t){if(!e)return this.setState({title_code:"",totalcount:0}),this.props.setUrlParam({id:"null",status:"browse"}),this.props.form.EmptyAllFormValue(this.formId),this.props.cardTable.setTableData(this.tableId,{rows:[]}),void this.toggleShow();var a=b(e,A);if(a){this.props.form.setAllFormValue(p({},I,a.head[I]));var r=a.head[this.formId].rows[0].values.code.value;if(a.body&&a.body[P]){this.props.cardTable.setTableData(P,a.body[P]);var o=a.body[P].rows.length;this.setState({title_code:r,totalcount:o})}else this.props.cardTable.setTableData(P,{rows:[]}),this.setState({title_code:"",totalcount:0});this.props.setUrlParam(e)}else this.getdata(e),this.props.setUrlParam(e);t&&"function"==typeof t&&t.call(this),a&&this.toggleShow()}},{key:"updateCardTableBtnStatus",value:function(){var e=this.props.cardTable.getCheckedRows(this.tableId),t=this.props.getUrlParam("status");t="add"==t||"edit"==t?"edit":"browse",e.length>0&&"edit"==t?this.props.button.setButtonDisabled(["DelLine"],!1):this.props.button.setButtonDisabled(["DelLine"],!0)}},{key:"changeEnableClick",value:function(){var e=this;(0,l.ajax)({url:"/nccloud/uapbd/taxregion/changeEnableTaxregion.do",data:{id:this.props.getUrlParam("id")},success:function(t){e.getdata(e.props.getUrlParam("id"),(function(){e.enableClick?(0,l.toast)({color:"success",title:e.state.json["10140ACMAP-000020"]}):(0,l.toast)({color:"success",title:e.state.json["10140ACMAP-000021"]})}))}})}},{key:"render",value:function(){var e=this.props,t=e.cardTable,a=e.form,r=e.button,o=e.modal,i=e.cardPagination,s=e.BillHeadInfo,n=i.createCardPagination,c=s.createBillHeadInfo,u=l.base.NCDiv,p=a.createForm,h=t.createCardTable,b=r.createButtonApp,g=o.createModal,v=this.props.getUrlParam("status");return d.default.createElement("div",{className:"nc-bill-card"},d.default.createElement("div",{className:"nc-bill-top-area"},d.default.createElement(f,null,d.default.createElement(u,{areaCode:u.config.HEADER,className:"nc-bill-header-area"},d.default.createElement("div",{className:"header-title-search-area"},c({title:this.state.json?this.state.json["10140ACMAP-000029"]:"10140ACMAP-000029",backBtnClick:this.buttonClick.bind(this,this.props,"Back"),initShowBackBtn:"browse"==v}),d.default.createElement("span",{className:"bill-info-code",style:{fontSize:"16px",marginLeft:"8px",lineHeight:"32px",verticalAlign:"baseline"}},"browse"==v?"："+this.state.title_code:"")),d.default.createElement("div",{className:"header-button-area"},b({area:"header-action",onButtonClick:this.buttonClick.bind(this)}),n({handlePageInfoChange:this.pageInfoClick.bind(this),dataSource:A})))),d.default.createElement("div",{className:"nc-bill-form-area"},p(this.formId,{onAfterEvent:this.afterEvent.bind(this),onBeforeEvent:this.beforeEvent.bind(this)}))),d.default.createElement("div",{className:"nc-bill-bottom-area"},d.default.createElement("div",{className:"nc-bill-table-area"},h(this.tableId,{tableHead:this.getTableHead.bind(this),modelSave:this.modelSave.bind(this),onAfterEvent:this.onCardTableAfterEvent.bind(this),showIndex:!0,onSelected:this.updateCardTableBtnStatus.bind(this),onSelectedAll:this.updateCardTableBtnStatus.bind(this),hideAdd:!0,hideDel:!0,adaptionHeight:!0}))),g("delete",{title:this.state.json?this.state.json["10140ACMAP-000004"]:"10140ACMAP-000004",content:this.state.json?this.state.json["10140ACMAP-000005"]:"10140ACMAP-000005",beSureBtnClick:this.delConfirm.bind(this)}),g("cancel",{title:this.state.json?this.state.json["10140ACMAP-000008"]:"10140ACMAP-000008",content:this.state.json?this.state.json["10140ACMAP-000009"]:"10140ACMAP-000009",beSureBtnClick:this.cancelSureEvent.bind(this)}),g("enable",{title:this.state.json?this.state.json["10140ACMAP-000014"]:"10140ACMAP-000014",content:this.state.json?this.state.json["10140ACMAP-000015"]:"10140ACMAP-000015",beSureBtnClick:this.changeEnableClick.bind(this)}),g("disable",{title:this.state.json?this.state.json["10140ACMAP-000016"]:"10140ACMAP-000016",content:this.state.json?this.state.json["10140ACMAP-000017"]:"10140ACMAP-000017",beSureBtnClick:this.changeEnableClick.bind(this)}),d.default.createElement(m,{ref:"printOutput",url:"/nccloud/uapbd/taxregion/printTaxregion.do",data:{funcode:"10140ACMAP",nodekey:"card",oids:this.state.pks,outputType:"output"}}))}}]),t}(n.Component),o=function(){var e=this;this.initTemplate=function(t,a){t.createUIDom({pagecode:w},(function(r){if(r){if(r.template){var o=r.template;e.modifierMeta(t,o),t.meta.setMeta(o,(function(){a&&"function"==typeof a&&a()}))}if(r.button){var i=r.button;t.button.setButtons(i),e.toggleShow()}}}))},this.setDefaultValue=function(){e.props.form.setFormItemsValue(e.formId,{bill_status:{value:"0",display:e.state.json["10140ACMAP-000001"]}}),e.props.form.setFormItemsValue(e.formId,{dataoriginflag:{value:"0",display:e.state.json["10140ACMAP-000003"]}})},this.buttonClick=function(t,a){switch(a){case"Add":t.form.EmptyAllFormValue(e.formId),t.cardTable.setTableData(e.tableId,{rows:[]}),t.pushTo("/card",{pagecode:"10140ACMAP_card",status:"add"}),e.setDefaultValue(),e.toggleShow(),e.setState({backVisible:!1}),e.processBillCode(!0);break;case"Edit":e.props.cardTable.resetTableData(e.tableId),e.props.form.cancel(e.formId),e.getdata(e.props.getUrlParam("id"),(function(){e.props.setUrlParam({status:"edit"}),e.toggleShow()})),e.setState({backVisible:!1});break;case"Delete":(0,l.promptBox)({color:"warning",title:e.state.json["10140ACMAP-000004"],content:e.state.json["10140ACMAP-000005"],noFooter:!1,noCancelBtn:!1,beSureBtnName:e.state.json["10140ACMAP-000006"],cancelBtnName:e.state.json["10140ACMAP-000007"],beSureBtnClick:e.delConfirm.bind(e)});break;case"Back":t.pushTo("/list",{pagecode:"10140ACMAP_list"});break;case"Save":e.saveClick();break;case"Cancel":(0,l.promptBox)({color:"warning",title:e.state.json["10140ACMAP-000008"],content:e.state.json["10140ACMAP-000009"],noFooter:!1,noCancelBtn:!1,beSureBtnName:e.state.json["10140ACMAP-000006"],cancelBtnName:e.state.json["10140ACMAP-000007"],beSureBtnClick:e.cancelSureEvent.bind(e)});break;case"Refresh":e.getdata(e.props.getUrlParam("id"),(function(){(0,l.toast)({title:e.state.json["10140ACMAP-000013"],color:"success"})}));break;case"SaveAdd":e.saveClick(!0);break;case"AddLine":t.cardTable.addRow(e.tableId)}},this.pageInfoClick=function(t,a){e.getDataForCache(a)},this.getdata=function(t,a){var r={pk:t};(0,l.ajax)({url:"/nccloud/uapbd/periodmapping/queryPeriodMappingCard.do",data:r,success:function(t){e._displayDataFromRes(t),a&&"function"==typeof a&&a.call(e)}})},this.saveClick=function(){var t,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e.props.form.isCheckNow(e.formId)){var r=e.props.cardTable.getAllRows(e.tableId),o=null==r||0==r.length,s=e.props.createMasterChildData(w,e.formId,e.tableId),n=i({},s,{body:p({},P,{rows:[]})});(t=n.body[P].rows).push.apply(t,u(s.body[P].rows));var d=e.props.form.getFormItemsValue(e.formId,"targetyear").display;if(e.yearData)for(var c in e.yearData){var f;if(c!=d)(f=n.body[P].rows).push.apply(f,u(e.yearData[c].rows))}if(n.body[P]&&n.body[P].rows){var m=0;if(n.body[P].rows.forEach((function(e){0!=e.status&&m++})),0==m&&o)return void(0,l.toast)({color:"warning",content:e.state.json["10140ACMAP-000044"]})}delete n.head[I].rows[0].values.periodmappingdetail;var b=M;"edit"===e.props.getUrlParam("status")&&(b=S,n.targetperiodyear=e.props.form.getFormItemsValue(e.formId,"targetyear").value),e.props.validateToSave(n,(function(){(0,l.ajax)({url:b,data:n,success:function(t){var r=null;t.success&&(e.yearData=[],t.data&&!a?(t.data.head&&t.data.head[e.formId]&&(e.props.form.setAllFormValue(p({},e.formId,t.data.head[e.formId])),r=t.data.head[e.formId].rows[0].values[j].value),t.data.body&&t.data.body[e.tableId]&&e.props.cardTable.setTableData(e.tableId,t.data.body[e.tableId])):r=t.data.head[e.formId].rows[0].values[j].value,a?(e.props.form.EmptyAllFormValue(e.formId),e.setDefaultValue()):(e.props.pushTo("/card",{status:"browse",pagecode:"10140ACMAP_card",id:r}),e.toggleShow(),e.setState({backVisible:!0,title_code:t.data.head[e.formId].rows[0].values.code.value}),e.props.form.setFormItemsDisabled(e.formId,{targetperiod:!0,sourceperiod:!0,targetyear:!1})),b==M?h(r,t.data,e.formId,A):g(j,t.data.head[I].rows[0].values[j].value,t.data,I,A),(0,l.toast)({content:e.state.json["10140ACMAP-000018"],color:"success"}))}})}),p({head:I},P,"cardTable"))}},this.delConfirm=function(){e.props.createMasterChildData(w,e.formId,e.tableId);var t={deleteInfo:[{id:e.props.getUrlParam("id"),ts:e.props.form.getFormItemsValue(e.formId,"ts").value}]};(0,l.ajax)({url:"/nccloud/uapbd/periodmapping/delete.do",data:t,success:function(t){if(t){var a=e.props.getUrlParam("id"),r=y(a,A);C(j,a,A),e.getDataForCache(r,(function(){(0,l.toast)({color:"success",title:e.state.json["10140ACMAP-000019"]})}))}}})},this.modelSave=function(t){t.cardTable.closeModel(e.tableId),e.saveClick()},this.getButtonNames=function(e){return"edit"===e||"add"===e||"save"===e?"main-button":"secondary - button"},this.getTableHead=function(){var t=e.props.button.createButtonApp,a=(e.props.button.getButtons(),e.props.getUrlParam("status"));return d.default.createElement("div",{className:"shoulder-definition-area"},d.default.createElement("div",{className:"definition-search"},"browse"==a?d.default.createElement("div",{className:"nc-theme-common-font-c"},d.default.createElement("span",{className:"definition-search-title"},e.state.json?e.state.json["10140ACMAP-000026"]:"10140ACMAP-000026"," | ",e.state.json?e.state.json["10140ACMAP-000027"]:"10140ACMAP-000027","："),d.default.createElement("span",{className:"count"},e.state.totalcount),d.default.createElement("span",null,e.state.json?e.state.json["10140ACMAP-000028"]:"10140ACMAP-000028")):d.default.createElement("span",{className:"definition-search-title"})),d.default.createElement("div",{className:"definition-icons",style:{padding:"0px"}},t({area:"body-action",onButtonClick:e.buttonClick.bind(e)}),e.props.cardTable.createBrowseIcons(e.tableId,{iconArr:["close","open","max","setCol"],maxDestAreaId:"nc-bill-card"})))}},r);E=(0,l.createPage)({billinfo:{billtype:"card",pagecode:w,headcode:I,bodycode:P},initTemplate:[]})(E),t.default=E},2:function(e,a){e.exports=t},3:function(e,t){e.exports=a}})}));
//# sourceMappingURL=index.3b9aaf25.js.map