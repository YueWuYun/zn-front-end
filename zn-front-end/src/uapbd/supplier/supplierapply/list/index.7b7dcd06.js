/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-5-11 15:07:37"} */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("nc-lightapp-front"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","nc-lightapp-front","react-dom"],e):"object"==typeof exports?exports["uapbd/supplier/supplierapply/list/index"]=e(require("react"),require("nc-lightapp-front"),require("react-dom")):t["uapbd/supplier/supplierapply/list/index"]=e(t.React,t["nc-lightapp-front"],t.ReactDOM)}(window,(function(t,e,a){return function(t){var e={};function a(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=e,a.d=function(t,e,o){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(o,s,function(e){return t[e]}.bind(null,s));return o},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="../../../../",a(a.s=680)}({1:function(e,a){e.exports=t},3:function(t,a){t.exports=e},4:function(t,e){t.exports=a},680:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,s,n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o])}return t},r=function(){function t(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,a,o){return a&&t(e.prototype,a),o&&t(e,o),e}}(),l=a(1),i=u(l),c=(u(a(4)),a(3));function u(t){return t&&t.__esModule?t:{default:t}}var p=c.high.PrintOutput,d=c.high.ApproveDetail,h=c.high.ApprovalTrans,f=(c.base.NCPopconfirm,c.base.NCIcon,c.base.NCTabs.NCTabPane,c.base.NCDiv),b="10140SPF_list",v="search",m="supplierPf",g="pk_supplier_pf",y="/nccloud/uapbd/supplierapply/querySupplierApplyList.do",k="/nccloud/uapbd/supplierapply/deleteSupplierApply.do",S="/nccloud/uapbd/supplierapply/printSupplierApply.do",P="/nccloud/uapbd/supplierapply/commitSupplierApply.do",w=(o=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return s.call(a),a.searchId=v,a.tableId=m,a.selectedRowRecord=null,a.enableNumber=0,a.disableNumber=0,a.state={pks:[],billId:"",showApprInfo:!1,compositedisplay:!1,compositedata:null},a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"initTemplate",value:function(t){var e=this;t.createUIDom({pagecode:b},(function(a){if(a){if(a.template){var o=a.template;o=e.modifierMeta(t,o),t.meta.setMeta(o,(function(){a.context&&a.context.pk_org&&a.context.org_Name&&t.search.setSearchValByField(v,"pk_org",{value:a.context.pk_org?a.context.pk_org:null,display:a.context.org_Name?a.context.org_Name:null})}));var s=c.cacheTools.get("searchParams");if(s&&0!=s){t.search.setSearchValue("search",s);var r=t.search.getQueryInfo("search"),l=r.oid,i=n({},r,{pageInfo:{pageIndex:0,pageSize:10,total:0,totalPage:0},pagecode:b,queryAreaCode:v,oid:l,queryType:"tree"});(0,c.ajax)({url:y,data:i,success:function(a){if(a.data)t.button.setButtonDisabled({Print:!0,Output:!0}),e.totalPks=a.data[m].allpks,t.table.setAllTableData(m,a.data[m]);else{t.button.setButtonDisabled({Print:!0,Output:!0}),e.totalPks=[],t.table.setAllTableData(m,{allpks:[],rows:[]}),(0,c.toast)({content:e.state.json["10140SPF-000044"],color:"warning"})}},error:function(t){console.log(t.message)}})}}if(a.button){var u=a.button;t.button.setButtons(u,(function(){console.log("123123"),e.updateButtonStatus()})),t.button.setPopContent("RowDel",e.state.json["10140SPF-000064"])}}}))}},{key:"modifierMeta",value:function(t,e){var a=this;e[v].items=e[v].items.map((function(t,e){return t.col="3",t}));var o=e[v].items.find((function(t){return"apply_type"==t.attrcode})),s=o.options,n=[s[0],s[1],s[2]];o.options=n;var r=["pk_org","pk_org_sup","pk_supclass"];return e[v].items.forEach((function(t){r.indexOf(t.attrcode)>=0&&(t.isMultiSelectedEnabled=!0,t.isShowDisabledData=!0),"pk_supclass"==t.attrcode&&(t.isShowUnit=!0),"pk_supclass"!=t.attrcode&&(t.queryCondition=function(){return{nodeType:"supplier",TreeRefActionExt:"nccloud.web.refer.sqlbuilder.PrimaryOrgSQLBuilder"}})})),e[m].pagination=!0,e[m].items=e[m].items.map((function(e,a){return"vbillno"==e.attrcode&&(e.render=function(e,a,o){return i.default.createElement("span",{style:{color:"#007ace",cursor:"pointer"},onClick:function(){var e=t.search.getAllSearchData(v);c.cacheTools.set("searchParams",e),c.cacheTools.set("preid",a[g].value),t.pushTo("/card",{status:"browse",id:a[g].value,errParam:JSON.stringify(a)})}},a&&a.vbillno&&a.vbillno.value)}),e})),e[m].items.push({itemtype:"customer",attrcode:"opr",label:this.state.json["10140SPF-000019"],width:200,fixed:"right",className:"table-opr",visible:!0,render:function(e,o,s){var n=[],r=o&&o.vbillstatus?o.vbillstatus.value:-1;return n=-1==r?["RowEdit","RowDel"]:["RowApprInfo"],t.button.createErrorButton({record:o,sucessCallBack:function(){return t.button.createOprationButton(n,{area:"row-action",buttonLimit:3,onButtonClick:function(t,n){return a.tableButtonClick(t,n,e,o,s)}})}})}}),e}},{key:"tableButtonClick",value:function(t,e,a,o,s){var n=this;switch(e){case"RowEdit":var r=o[g].value,l=t.search.getAllSearchData(v);c.cacheTools.set("searchParams",l),(0,c.ajax)({url:"/nccloud/uapbd/supplierapply/checkDataPerm.do",data:{pks:[r]},success:function(e){l=t.search.getAllSearchData(v),c.cacheTools.set("searchParams",l),t.pushTo("/card",{status:"edit",codeedit:!e||!e.data||e.data.codeedit,vbillnumedit:!e||!e.data||e.data.vbillnumedit,id:r,errParam:JSON.stringify(o)})}});break;case"RowDel":var i=[];i.push(o[g].value),(0,c.ajax)({url:k,data:{primaryKeys:i},success:function(e){e.success&&((0,c.toast)({color:"success",content:n.state.json["10140SPF-000046"]}),t.table.deleteTableRowsByIndex(m,s))}});break;case"RowApprInfo":this.setState({billId:o[g].value,showApprInfo:!0})}}},{key:"componentDidMount",value:function(){var t=this;(0,c.getMultiLang)({moduleId:"10140SPF",domainName:"uapbd",callback:function(e){t.setState({json:e},(function(){t.initTemplate(t.props)}))}});this.props.table.getAllTableData(this.tableId);this.props.button.setButtonVisible(["Edit"],!1),this.updateButtonStatus()}},{key:"buttonClick",value:function(t,e){var a=this,o=null;switch(e){case"Add":var s=t.search.getAllSearchData(v);c.cacheTools.set("searchParams",s),t.pushTo("/card",{status:"add"});break;case"Edit":var n=t.table.getCheckedRows(this.tableId);n.length<=0&&(0,c.toast)({color:"warning",content:this.state.json["10140SPF-000047"]}),o=n[0].data.values[g].value,(0,c.ajax)({url:"/nccloud/uapbd/supplierapply/checkDataPerm.do",data:{pks:[o]},success:function(){s=t.search.getAllSearchData(v),c.cacheTools.set("searchParams",s),t.pushTo("/card",{status:"edit",id:o})}});break;case"Delete":if((n=t.table.getCheckedRows(this.tableId)).length<=0)return void(0,c.toast)({color:"warning",content:this.state.json["10140SPF-000048"]});(0,c.promptBox)({color:"warning",title:this.state.json["10140SPF-000023"],content:this.state.json["10140SPF-000017"],noFooter:!1,noCancelBtn:!1,beSureBtnName:this.state.json["10140SPF-000010"],cancelBtnName:this.state.json["10140SPF-000011"],beSureBtnClick:function(){var e=[];n.forEach((function(t){e.push(t.data.values[g].value)})),(0,c.ajax)({url:k,data:{primaryKeys:e},success:function(e){(0,c.toast)({color:"success",title:a.state.json["10140SPF-000033"]}),a.refreshAction(t)}})}});break;case"Commit":var r=[],l={};if((n=t.table.getCheckedRows(this.tableId)).forEach((function(t){-1==t.data.values.vbillstatus.value&&(r.push(t.data.values[g].value),l[t.data.values[g].value]=t.data.values.ts.value)})),this.pks=r,0==r.length)return void(0,c.toast)({color:"success",content:this.state.json["10140SPF-000026"]});(0,c.ajax)({url:P,data:{content:null,pks:r,tss:l},success:function(e){e.data&&e.data.workflow&&("approveflow"==e.data.workflow||"workflow"==e.data.workflow)?a.setState({compositedata:e.data,compositedisplay:!0}):e.data?((0,c.toast)({color:"warning",content:a.state.json["10140SPF-000056"]+": "+e.data}),a.refreshAction(t)):((0,c.toast)({color:"success",content:a.state.json["10140SPF-000026"]}),a.refreshAction(t))}});break;case"Callback":if(r=[],(n=t.table.getCheckedRows(this.tableId)).forEach((function(t){var e=t.data.values.vbillstatus.value;1!=e&&3!=e||r.push(t.data.values[g].value)})),0==r.length)return void(0,c.toast)({color:"success",content:this.state.json["10140SPF-000049"]});(0,c.ajax)({url:"/nccloud/uapbd/supplierapply/callbackSupplierApply.do",data:r,success:function(e){e&&e.data?(0,c.toast)({color:"danger",content:e.data}):(a.refreshAction(t),(0,c.toast)({color:"success",content:a.state.json["10140SPF-000049"]}))}});break;case"Refresh":this.refreshAction(t,!0);break;case"Print":this.output("print");break;case"Output":var i=this.props.table.getAllTableData(m);r=[],i.rows.forEach((function(t){r.push(t.values[g].value)})),this.setState({pks:r},(function(){a.refs.printOutput.open()}))}}},{key:"updateButtonStatus",value:function(){var t=this.props.table.getCheckedRows(this.tableId),e={Print:!1,Output:!1};if(null==t||0==t.length)e.Delete=!0,e.Commit=!0,e.Callback=!0,e.Print=!0,e.Output=!0;else{var a=t[0];-1==a.data.values.vbillstatus.value?(e.Delete=!1,e.Commit=!1,e.Callback=!0):3==a.data.values.vbillstatus.value?(e.Delete=!1,e.Commit=!0,e.Callback=!1):1==a.data.values.vbillstatus.value?(e.Delete=!0,e.Commit=!0,e.Callback=!1):(e.Delete=!0,e.Commit=!0,e.Callback=!0)}this.props.button.setButtonDisabled(e)}},{key:"output",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.props.table.getAllTableData(m),a=[];e.rows.forEach((function(t){a.push(t.values[g].value)})),""!=t&&(0,c.print)("pdf",S,{funcode:"10140SPF",nodekey:"suppflist",oids:a,outputType:t})}},{key:"onRowClick",value:function(t,e,a,o){console.log(a),this.selectedRowRecord=a}},{key:"onSelectedChange",value:function(){this.updateButtonStatus()}},{key:"getData",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments[2],s=this.props.search.getQueryInfo("search"),r=n({},s);r.querycondition.conditions=t.conditions;var l=s.oid,i=n({},r,{pageInfo:this.props.table.getTablePageInfo(this.tableId)?this.props.table.getTablePageInfo(this.tableId):{pageIndex:0,pageSize:10,total:0,totalPage:0},pagecode:b,queryAreaCode:v,oid:l,queryType:"tree"});(0,c.ajax)({url:y,data:i,success:function(t){if(console.log(t),t.data){e.props.button.setButtonDisabled({Print:!1,Output:!1}),e.totalPks=t.data[m].allpks,e.props.table.setAllTableData(m,t.data[m]),e.updateButtonStatus();var s=e.totalPks.length;a&&(0,c.toast)({content:e.props.MutiInit.getIntl("10140SPF").get("10140SPF-000057",{count:s}),color:"success"})}else{e.props.button.setButtonDisabled({Print:!0,Output:!0}),e.totalPks=[],e.props.table.setAllTableData(m,{allpks:[],rows:[]}),a&&(0,c.toast)({content:e.state.json["10140SPF-000054"],color:"warning",title:e.state.json["10140SPF-000055"]})}o&&"function"==typeof o&&o()},error:function(t){console.log(t.message)}})}},{key:"onApprTransClose",value:function(){this.setState({compositedata:null,compositedisplay:!1})}},{key:"render",value:function(){var t=this.props,e=t.table,a=t.button,o=t.search,s=t.BillHeadInfo,n=t.socket,r=s.createBillHeadInfo,l=this.props.button.getButtons();l=l.sort((function(t,e){return e.btnorder-t.btnorder}));var c=e.createSimpleTable,u=o.NCCreateSearch,b=a.createButtonApp;a.getButtons;return i.default.createElement("div",{className:"nc-bill-list"},i.default.createElement(f,{areaCode:f.config.HEADER,className:"nc-bill-header-area"},n.connectMesg({tableAreaCode:this.tableId,billpkname:g,billtypeFromList:"billtypecode",isShowView:!0,serverLocation:"http://10.11.115.10:80"}),i.default.createElement("div",{className:"header-title-search-area"},r({title:this.state.json?this.state.json["10140SPF-000043"]:"10140SPF-000043",initShowBackBtn:!1})),i.default.createElement("div",{className:"header-button-area"},b({area:"header-action",buttonLimit:3,onButtonClick:this.buttonClick.bind(this),popContainer:document.querySelector(".header-button-area")}))),i.default.createElement("div",{className:"nc-bill-search-area"},u(this.searchId,{clickSearchBtn:this.clickSearchBtn.bind(this)})),i.default.createElement("div",{className:"nc-bill-table-area"},c(this.tableId,{dataSource:"uapbd.supplier.supplierapply.data",pkname:g,handlePageInfoChange:this.pageInfoClick,tableModelConfirm:this.tableModelConfirm,showIndex:!0,onRowClick:this.onRowClick.bind(this),onSelected:this.onSelectedChange.bind(this),onSelectedAll:this.onSelectedChange.bind(this),showCheck:!0,onRowDoubleClick:this.doubleClick.bind(this)})),i.default.createElement(p,{ref:"printOutput",url:S,data:{funcode:"10140SPF",oids:this.state.pks,nodekey:"suppflist",outputType:"output"}}),this.state.compositedisplay?i.default.createElement(h,{title:this.state.json?this.state.json["10140SPF-000037"]:"10140SPF-000037",data:this.state.compositedata,display:this.state.compositedisplay,getResult:this.getAssginUsedr.bind(this),cancel:this.onApprTransClose.bind(this)}):"",i.default.createElement(d,{show:this.state.showApprInfo,close:this.closeApprove,billtype:"10GY",billid:this.state.billId}))}}]),e}(l.Component),s=function(){var t=this;this.getButtonNames=function(t){return"edit"===t||"add"===t||"save"===t?"main-button":"secondary - button"},this.doubleClick=function(e,a,o,s){var n=t.props.search.getAllSearchData(v);c.cacheTools.set("searchParams",n);var r={status:"browse",errParam:JSON.stringify(e)};r.id=e[g].value,t.props.pushTo("/card",r)},this.refreshAction=function(e,a){var o=e.search.getAllSearchData(v);a?t.getData(o,!1,(function(){(0,c.toast)({color:"success",title:t.state.json["10140SPF-000050"]})})):t.getData(o)},this.pageInfoClick=function(e,a,o){var s=e.table.getTablePageInfo(t.tableId),r=(e.search.getAllSearchData(v),n({allpks:o,pageid:b},s,{totalPage:t.totalPks.length}));(0,c.ajax)({url:"/nccloud/uapbd/supplierapply/pageInfoClick.do",data:r,success:function(a){var o=a.success,s=a.data;o&&(s?(s[m].allpks=t.totalPks,e.table.setAllTableData(m,s[m])):e.table.setAllTableData(m,{rows:[]}))}})},this.clickSearchBtn=function(e,a){c.cacheTools.set("searchParams",a),t.getData(a,!0)},this.getAssginUsedr=function(e){(0,c.ajax)({url:P,data:{content:e,pks:t.primaryKeys},success:function(e){e.data&&e.data.workflow&&("approveflow"==e.data.workflow||"workflow"==e.data.workflow)?t.setState({compositedata:e.data,compositedisplay:!0}):(t.setState({compositedata:null,compositedisplay:!1}),(0,c.toast)({color:"success",content:t.state.json["10140SPF-000026"]}),t.refreshAction(t.props))}})},this.closeApprove=function(){t.setState({showApprInfo:!1})}},o);w=(0,c.createPage)({initTemplate:[],mutiLangCode:"10140SPF"})(w),e.default=w}})}));
//# sourceMappingURL=index.7b7dcd06.js.map