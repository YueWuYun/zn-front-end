/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-4-30 13:24:12"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uapbd/mmbase/planstrategy/main/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uapbd/mmbase/planstrategy/main/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,a){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=3)}([function(t,a){t.exports=e},function(e,a){e.exports=t},function(e,t){e.exports=a},function(e,t,a){"use strict";var n,o,r,s=a(0),i=a(4),l=(n=i)&&n.__esModule?n:{default:n};o=l.default,r="app",(0,s.RenderRouter)(o,r)},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=a(0),r=a(5),s=(n=r)&&n.__esModule?n:{default:n};var i=(0,o.asyncComponent)((function(){return Promise.resolve().then(a.t.bind(null,9,7))})),l=[{path:"/",component:s.default,exact:!0},{path:"/list",component:s.default},{path:"/card",component:i}];t.default=l},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a(1),l=p(i),u=(p(a(2)),a(0)),c=p(a(6)),d=a(8);function p(e){return e&&e.__esModule?e:{default:e}}u.base.NCPopconfirm,u.base.NCCheckbox,u.base.NCIcon,u.base.NCTabs.NCTabPane,u.high.PrintOutput;var f="10140PST_list",m="pstlist",h=(n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.call(a),a.tableId=m,a.selectedRowRecord=null,a.state={isShowOff:!1,pk_org:null},a.searchVal=null,a.changeEnableInfo={title:"",content:""},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"modifierMeta",value:function(e,t){var a=this;return t[m].items=t[m].items.map((function(t,n){return"code"==t.attrcode&&(t.render=function(t,n,o){return l.default.createElement("span",{style:{textDecoration:"underline",cursor:"pointer"},onClick:function(){e.pushTo("/card",{status:"browse",id:n.pk_pst.value,pk_org:a.state.pk_org})}},n&&n.code&&n.code.value)}),t})),t[m].items.push({itemtype:"customer",attrcode:"opr",label:this.state.json?this.state.json["10140PST-000000"]:"10140TPST-000000",width:200,fixed:"right",className:"table-opr",visible:!0,render:function(t,n,o){return e.button.createOprationButton(["Edit","Del"],{area:"list-inner",buttonLimit:2,onButtonClick:function(e,r){a.onTableButtonClick.bind(a)(e,r,t,n,o)}})}}),t}},{key:"componentDidMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"10140PST",domainName:"uapbd",callback:function(t,a,n){a&&e.setState({json:t,inlt:n},(function(){e.initTemplate(e.props)}))}}),this.props.MultiInit.getMultiLang({moduleId:"10140MMPUBMSG",domainName:"uapbd",callback:function(t,a,n){a&&e.setState({pubjson:r({},t)})}});var t=this.props.getUrlParam("pk_org");if(t&&t.refpk){this.props.table.setAllTableData(m,{allpks:[],rows:[]}),this.setState({pk_org:t}),this.getData(t.refpk)}this.props.button.setButtonDisabled({Delete:!0})}},{key:"onRowClick",value:function(e,t,a,n){this.selectedRowRecord=a}},{key:"getData",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments[3],r={pageInfo:{pageIndex:0,pageSize:10,total:0,totalPage:0},pagecode:f,showDisable:t,pk_org:e};(0,u.ajax)({url:"/nccloud/mmbd/pst/query.do",data:r,success:function(e){if(console.log(e),e.data){var t=[];e.data[m].rows.forEach((function(e){t.push(e.values.pk_pst.value)})),a.props.button.setButtonDisabled({Print:!1,Output:!1}),e.data[m].allpks=t,a.props.table.setAllTableData(a.tableId,e.data[m]);var r=t.length,s=a.state.inlt;n&&(0,u.toast)({title:a.state.json["10140PST-000035"],content:s.get("10140PST-000042",{count:r}),color:"success"})}else{a.props.button.setButtonDisabled({Print:!0,Output:!0}),a.props.table.setAllTableData(m,{allpks:[],rows:[]}),n&&(0,u.toast)({content:a.state.json["10140PST-000036"],color:"warning",title:a.state.json["10140PST-000037"]})}o&&"function"==typeof o&&o()}})}},{key:"buttonClick",value:function(e,t){switch(t){case"Add":if(!this.state.pk_org||!this.state.pk_org.refpk)return void(0,u.toast)({content:this.state.json["10140PST-000010"],color:"warning"});e.pushTo("/card",{status:"add",pk_org:this.state.pk_org});break;case"Edit":if(null==this.selectedRowRecord)return void(0,u.toast)({content:this.state.json["10140PST-000033"],color:"warning"});e.pushTo("/card",{status:"edit",id:this.selectedRowRecord.pk_pst.value,pk_org:this.state.pk_org});break;case"Refresh":this.refreshAction(e,!0);break;case"Delete":(0,u.promptBox)({color:"warning",title:this.state.json["10140PST-000004"],content:this.state.json["10140PST-000005"],noFooter:!1,noCancelBtn:!1,beSureBtnName:this.state.json["10140PST-000006"],cancelBtnName:this.state.json["10140PST-000007"],beSureBtnClick:this.deleteAction.bind(this)})}}},{key:"render",value:function(){var e=this.props,t=e.table,a=e.button,n=e.search,o=(e.base,e.modal),r=this.props.button.getButtons();r=r.sort((function(e,t){return t.btnorder-e.btnorder}));var s=t.createSimpleTable,i=(n.NCCreateSearch,o.createModal,a.createButtonApp);a.getButtons;return l.default.createElement("div",{className:"nc-bill-list"},l.default.createElement("div",{className:"nc-bill-header-area"},l.default.createElement("div",{className:"header-title-search-area"},(0,u.createPageIcon)(),l.default.createElement("h2",{className:"title-search-detail"},this.state.json?this.state.json["10140PST-000029"]:"10140PST-000029")),l.default.createElement("div",{className:"search-box",style:{position:"relative"}},(0,c.default)({onChange:this.onUnitChange.bind(this),foolValue:this.state.pk_org,value:[this.state.pk_org],isDataPowerEnable:!1,queryCondition:{GridRefActionExt:"nccloud.web.mmbd.refer.pub.AppPermissionOrgRefFilter"}})),l.default.createElement("div",{className:"header-button-area"},i({area:"header-action",buttonLimit:3,onButtonClick:this.buttonClick.bind(this),popContainer:document.querySelector(".header-button-area")}))),l.default.createElement("div",{className:"nc-bill-table-area"},s(this.tableId,{dataSource:"mmbd.psinfo.planstrategy.data",pkname:"pk_pst",tableModelConfirm:this.tableModelConfirm,showIndex:!1,onRowClick:this.onRowClick.bind(this),showCheck:!0,onRowDoubleClick:this.doubleClick.bind(this),onSelected:this.onSelected.bind(this),onSelectedAll:this.onSelected.bind(this),height:700})))}}]),t}(i.Component),o=function(){var e=this;this.initTemplate=function(t){t.createUIDom({pagecode:f},(function(a){if(a){if(a.template){var n=a.template;n=e.modifierMeta(t,n),t.meta.setMeta(n)}if(a.button){var o=a.button;t.button.setButtons(o)}a.context.pk_org&&e.setState({pk_org:{value:a.context.pk_org,display:a.context.org_Name,refpk:a.context.pk_org,refname:a.context.org_Name}},(function(){e.getData(a.context.pk_org,e.state.isShowOff,!1,(function(){}))}))}}))},this.onTableButtonClick=function(t,a,n,o,r){if("Edit"===a&&t.pushTo("/card",{status:"edit",id:o.pk_pst.value,pk_org:e.state.pk_org}),"Del"===a){o.pk_pst.value;(0,u.ajax)({url:"/nccloud/mmbd/pst/delete.do",data:{param:[{id:o.pk_pst.value,ts:o.ts.value}]},success:function(a){a.success&&((0,d.showBatchOprMessage)(null,a.data,e.state.pubjson["10140PUBMESSAGE-000028"]),e.refreshAction(t))}})}},this.doubleClick=function(t,a,n,o){e.props.pushTo("/card",{status:"browse",id:t.pk_pst.value,pk_org:e.state.pk_org})},this.onSelected=function(t,a,n,o,r){e.props.table.getCheckedRows(m).length>0?e.props.button.setButtonDisabled({Delete:!1}):e.props.button.setButtonDisabled({Delete:!0})},this.deleteAction=function(t){var a=e.props.table.getCheckedRows(m),n=[];a.length>0?a.forEach((function(e){n.push({id:e.data.values.pk_pst.value,ts:e.data.values.ts.value})})):e.selectedRowRecord&&n.push({id:e.selectedRowRecord.pk_pst.value,ts:e.selectedRowRecord.ts.value}),(0,u.ajax)({url:"/nccloud/mmbd/pst/delete.do",data:{param:n},success:function(a){(0,d.showBatchOprMessage)(null,a.data,e.state.pubjson["10140PUBMESSAGE-000028"]),e.refreshAction(t)}})},this.refreshAction=function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.getData(e.state.pk_org?e.state.pk_org.refpk:"",e.state.isShowOff,!1,(function(){a&&(0,u.toast)({title:e.state.json["10140PST-000013"],color:"success"})}))},this.onUnitChange=function(t){e.setState({pk_org:{value:t.refpk,display:t.refname,refpk:t.refpk,refname:t.refname}}),t.refpk?e.getData(t.refpk,e.state.isShowOff,!1,(function(){})):e.props.table.setAllTableData(m,{rows:[]})}},n);h=(0,u.createPage)({initTemplate:[],mutiLangCode:"10140PST"})(h),t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={multiLang:{domainName:"uapbd",currentLocale:"zh-CN",moduleId:"refer_uapbd"},unitProps:r.conf,refType:"grid",refName:"refer-000535",placeholder:"refer-000535",refCode:"uapbd.refer.org.ProducePlanGridRef",queryGridUrl:"/nccloud/uapbd/org/ProducePlanGridRef.do",isMultiSelectedEnabled:!1,columnConfig:[{name:["refer-000002","refer-000003"],code:["refcode","refname"]}]};return React.createElement(s,n({},t,e))};var o=a(0),r=a(7),s=o.high.Refer},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.conf=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return React.createElement(o,n({},r,e))};var o=a(0).high.Refer,r=t.conf={multiLang:{domainName:"uap",currentLocale:"zh-CN",moduleId:"uapRefer"},queryTreeUrl:"/nccloud/riart/ref/groupRefTreeAction.do",refType:"tree",placeholder:"1880000025-000061",refName:"1880000025-000061",rootNode:{refname:"1880000025-000061",refpk:"root"}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showWarningDialog=t.showBatchOprMessage=void 0;var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(0);var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lang=null,this.inlt=null,console.log("LangContainer初始化"),(0,o.getMultiLang)({moduleId:"10140MMPUBMSG",domainName:"uapbd",callback:this.init.bind(this),needInlt:!0})}return n(e,[{key:"init",value:function(e,t,a){t&&(this.lang=e,this.inlt=a)}},{key:"getLangByResId",value:function(e,t){return t?this.inlt.get(e,t)||e:this.lang&&this.lang[e]||e}}]),e}());function s(e,t,a,n,r,s,i,l,u){(0,o.toast)({duration:a,color:n,title:e,content:t,groupOperation:r,TextArr:s,groupOperationMsg:i,onExpand:l,onClose:u})}function i(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];(0,o.promptBox)({color:n,title:e,content:t,noFooter:a.noFooter,noCancelBtn:a.noCancelBtn,beSureBtnName:a.beSureBtnName,cancelBtnName:a.cancelBtnName,beSureBtnClick:a.beSureBtnClick,cancelBtnClick:a.cancelBtnClick,closeBtnClick:a.closeBtnClick,closeByClickBackDrop:a.closeByClickBackDrop})}t.showBatchOprMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.getLangByResId("10140PUBMESSAGE-000003"),t=arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=t.failedNum?t.failedNum:0,l=t.sucessNum;if(0==i)!function(e,t,a){s(e,t,a)}(r.getLangByResId("10140PUBMESSAGE-000018",{0:n}),r.getLangByResId("10140PUBMESSAGE-000022",{0:t.sucessNum}));else if(0==l){e=r.getLangByResId("10140PUBMESSAGE-000019",{0:n});var u=r.getLangByResId("10140PUBMESSAGE-000020",{0:t.failedNum,1:t.failedNum});(0,o.toast)({duration:"infinity",color:"danger",title:e,content:u,groupOperation:!0,TextArr:[r.getLangByResId("10140PUBMESSAGE-000000"),r.getLangByResId("10140PUBMESSAGE-000001"),r.getLangByResId("10140PUBMESSAGE-000002")],groupOperationMsg:t.errorMessages,onExpand:a.onExpand,onClose:a.onClose})}else{e=r.getLangByResId("10140PUBMESSAGE-000019",{0:n});var c=r.getLangByResId("10140PUBMESSAGE-000021",{0:Number(t.sucessNum)+Number(t.failedNum),1:t.sucessNum,2:t.failedNum});(0,o.toast)({duration:"infinity",color:"danger",title:e,content:c,groupOperation:!0,TextArr:[r.getLangByResId("10140PUBMESSAGE-000000"),r.getLangByResId("10140PUBMESSAGE-000001"),r.getLangByResId("10140PUBMESSAGE-000002")],groupOperationMsg:t.errorMessages,onExpand:a.onExpand,onClose:a.onClose})}},t.showWarningDialog=function(e,t){i(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},"warning")}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o,r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=a(1),i=u(s),l=(u(a(2)),a(0));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var d=l.base.NCAffix,p=(l.base.NCPopconfirm,l.base.NCFormControl,l.base.NCBackBtn,l.high.PrintOutput),f=l.cardCache.addCache,m=l.cardCache.getCacheById,h=l.cardCache.updateCache,g=l.cardCache.getCurrentLastId,b=l.cardCache.getNextId,v=l.cardCache.deleteCacheById,k="mmbd.psinfo.planstrategy.data",y="bd_planstrategy",S="10140PST_card",P="/nccloud/mmbd/pst/save.do",C="/nccloud/mmbd/pst/pstPrint.do",_=(n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.call(a),a.formId=y,a.state={pk_org:null,totalcount:0,applycount:0,backVisible:!0,json:{}},a}var a,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"modifierMeta",value:function(e,t){var a=e.getUrlParam("status");return t[y].status=a,t}},{key:"componentDidMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"10140PST",domainName:"uapbd",callback:function(t){e.setState({json:t},(function(){e.initTemplate(e.props)}))}});var t=this.props.getUrlParam("status"),a=this.props.getUrlParam("pk_org");if(this.setState({pk_org:a}),"add"!=t){var n=this.props.getUrlParam("id");n&&"undefined"!=n&&this.getdata(n)}else this.props.form.setFormItemsValue(this.formId,{pk_org:{value:a.refpk,display:a.refname}}),this.setDefaultValue();"add"!=t&&"edit"!=t||this.setState({backVisible:!1})}},{key:"componentWillUnmount",value:function(){null}},{key:"toggleShow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=this.props.getUrlParam("status"),a=this.props.getUrlParam("id"),n=[],o=[];"browse"==t&&"null"==a?(n=["Add"],o=["Edit","back","Delete","Refresh","Print","Output","Save","Cancel"]):"edit"==t||"add"==t?(o=["Edit","Add","Delete","Refresh"],n=["Save","Cancel"],this.props.cardPagination.setCardPaginationVisible("cardPaginationBtn",!1)):(o=["Save","Cancel","AddLine","DelLine"],n=["Add","Edit","Delete","back","Refresh","Print","Output"],2==e?(n.push("Disable"),o.push("Enable")):(n.push("Enable"),o.push("Disable")),this.props.cardPagination.setCardPaginationVisible("cardPaginationBtn",!0)),this.props.form.setFormStatus(y,t),this.props.button.setButtonVisible(o,!1),this.props.button.setButtonVisible(n,!0),window.onbeforeunload="add"!=t&&"edit"!=t?null:function(){return""}}},{key:"output",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];t.push(this.props.getUrlParam("id")),""!=e&&(0,l.print)("pdf",C,{funcode:"10140PST",nodekey:"pstprint",oids:t,outputType:e})}},{key:"cancelSureEvent",value:function(){var e=this;if("add"===this.props.getUrlParam("status")){var t=g(k);this.getDataForCache(t,(function(){e.props.pushTo("/card",{status:"browse",id:e.props.getUrlParam("id")}),e.props.form.setFormStatus(e.formId,"browse")}))}"edit"===this.props.getUrlParam("status")&&(this.props.form.cancel(this.formId),this.props.pushTo("/card",{status:"browse",id:this.props.getUrlParam("id")}),this.toggleShow()),this.setState({backVisible:!0})}},{key:"afterEvent",value:function(e,t,a,n,o){if("pk_country"==a&&n.value!=o.value)e.meta.getMeta()}},{key:"onCardTableAfterEvent",value:function(e,t,a,n,o,r,s){if(o[0].newvalue.value!=o[0].oldvalue.value){var i={};i.value=s.values.pk_region.value,i.display=n.refname,s.values.pk_region.display=n.refcode}}},{key:"beSure",value:function(){this.confirmSave()}},{key:"beCancel",value:(a=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.form.setFormItemsValue(this.formId,{bisdefault:{display:null,value:!1}});case 2:this.confirmSave();case 3:case"end":return e.stop()}}),e,this)})),n=function(){var e=a.apply(this,arguments);return new Promise((function(t,a){return function n(o,r){try{var s=e[o](r),i=s.value}catch(e){return void a(e)}if(!s.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(){return n.apply(this,arguments)})},{key:"confirmSave",value:function(){var e=this;if(this.props.form.isCheckNow(y,"warning")){var t=this.props.getUrlParam("status"),a=this.props.createMasterChildData(S,this.formId),n=P;"edit"===t&&(n="/nccloud/mmbd/pst/updatesave.do"),this.props.validateToSave(a,(function(){(0,l.ajax)({url:n,data:a,success:function(t){var a=null;t.success&&(t.data?t.data.head&&t.data.head[e.formId]&&(e.props.form.setAllFormValue(c({},e.formId,t.data.head[e.formId])),a=t.data.head[e.formId].rows[0].values.pk_pst.value):a=t.data.head[e.formId].rows[0].values.pk_pst.value,e.props.pushTo("/card",{status:"browse",id:a}),e.getdata(a),e.setState({backVisible:!0}),n==P?f(a,t.data,e.formId,k):h("pk_pst",t.data.head[y].rows[0].values.pk_pst.value,t.data,y,k),(0,l.toast)({content:e.state.json["10140PST-000018"],color:"success"}))}})}),{head:y})}}},{key:"getDataForCache",value:function(e,t){if(!e)return this.props.setUrlParam({id:"null",status:"browse"}),void this.toggleShow();var a=m(e,k);a?(this.props.form.setAllFormValue(c({},y,a.head[y])),this.props.setUrlParam(e)):(this.getdata(e),this.props.setUrlParam(e)),t&&"function"==typeof t&&t.call(this),a&&this.toggleShow()}},{key:"render",value:function(){var e=this,t=this.props,a=t.cardTable,n=t.form,o=t.button,r=t.modal,s=t.cardPagination.createCardPagination,l=this.props.BillHeadInfo.createBillHeadInfo,u=n.createForm,c=(a.createCardTable,o.createButtonApp);r.createModal,this.props.getUrlParam("status");return i.default.createElement("div",{className:"nc-bill-card"},i.default.createElement("div",{className:"nc-bill-top-area"},i.default.createElement(d,null,i.default.createElement("div",{className:"nc-bill-header-area"},i.default.createElement("div",{className:"header-title-search-area"},i.default.createElement("span",null,l({title:this.state.json["10140PST-000029"],backBtnClick:function(){e.buttonClick.call(e,e.props,"Back")}}))),i.default.createElement("div",{className:"header-button-area"},c({area:"header-action",onButtonClick:this.buttonClick.bind(this)}),s({handlePageInfoChange:this.pageInfoClick.bind(this),dataSource:k})))),i.default.createElement("div",{className:"nc-bill-form-area"},u(this.formId,{onAfterEvent:this.afterEvent.bind(this),expandArr:["auditinfo","demanSrc","supplySrc"]}))),i.default.createElement(p,{ref:"printOutput",url:C,data:{funcode:"10140PST",nodekey:"pstprint",oids:this.state.pks,outputType:"output"}}))}}]),t}(s.Component),o=function(){var e=this;this.initTemplate=function(t){t.createUIDom({pagecode:S},(function(a){if(a){if(a.template){var n=a.template;e.modifierMeta(t,n),t.meta.setMeta(n)}if(a.button){var o=a.button;t.button.setButtons(o),e.toggleShow()}}}))},this.setDefaultValue=function(){var t=window.parent.GETBUSINESSINFO();e.props.form.setFormItemsValue(e.formId,{pk_group:{value:t.groupId,display:t.groupName}})},this.buttonClick=function(t,a){switch(a){case"Add":t.form.EmptyAllFormValue(e.formId),t.pushTo("/card",{status:"add",id:t.getUrlParam("id")}),e.setDefaultValue(),e.props.form.setFormItemsValue(e.formId,{pk_org:{value:e.state.pk_org.refpk,display:e.state.pk_org.refname}}),e.toggleShow(),e.setState({backVisible:!1});break;case"Edit":t.pushTo("/card",{status:"edit",id:t.getUrlParam("id")}),e.toggleShow();e.props.form.getFormItemsValue(e.formId,"pk_country"),t.meta.getMeta();e.setState({backVisible:!1});break;case"Delete":(0,l.promptBox)({color:"warning",title:e.state.json["10140PST-000004"],content:e.state.json["10140PST-000005"],noFooter:!1,noCancelBtn:!1,beSureBtnName:e.state.json["10140PST-000006"],cancelBtnName:e.state.json["10140PST-000007"],beSureBtnClick:e.delConfirm.bind(e)});break;case"Back":t.pushTo("/list",{pk_org:e.state.pk_org});break;case"Save":e.saveClick();break;case"Cancel":(0,l.promptBox)({color:"warning",title:e.state.json["10140PST-000008"],content:e.state.json["10140PST-000009"],noFooter:!1,noCancelBtn:!1,beSureBtnName:e.state.json["10140PST-000006"],cancelBtnName:e.state.json["10140PST-000007"],beSureBtnClick:e.cancelSureEvent.bind(e)});break;case"Refresh":e.getdata(e.props.getUrlParam("id"),(function(){(0,l.toast)({title:e.state.json["10140PST-000013"],color:"success"})}));break;case"Print":e.output("print");break;case"Output":var n=[];n.push(e.props.getUrlParam("id")),e.setState({pks:n},(function(){e.refs.printOutput.open()}))}},this.pageInfoClick=function(t,a){e.getDataForCache(a)},this.getdata=function(t,a){var n={pk:t};(0,l.ajax)({url:"/nccloud/mmbd/pst/cardquery.do",data:n,success:function(t){if(t.data.head){e.props.form.setAllFormValue(c({},e.formId,t.data.head[e.formId])),e.toggleShow();t.data.head[e.formId].rows[0].values.pk_country,e.props.meta.getMeta();h("pk_pst",t.data.head[y].rows[0].values.pk_pst.value,t.data,y,k)}t.formulamsg&&t.formulamsg instanceof Array&&t.formulamsg.length>0&&e.props.dealFormulamsg(t.formulamsg,c({},y,"form")),a&&"function"==typeof a&&a.call(e)}})},this.saveClick=function(){var t=e.props.getUrlParam("status"),a=e.props.form.getFormItemsValue(e.formId,"bisdefault").value,n=e.props.form.getFormItemsValue(e.formId,"fplanpurpose"),o=e.props.form.getFormItemsValue(e.formId,"pk_org"),r=e.props.form.getFormItemsValue(e.formId,"pk_pst"),s=!1;if(a)if("add"===t)s=!0;else if("edit"===t){var i={fplanpurpose:n.value,id:r.value};(0,l.ajax)({url:"/nccloud/mmbd/pst/isReferenced.do",data:i,async:!1,success:function(e){s=e.data.isneed}})}if(s){var u=!1;(0,l.ajax)({url:"/nccloud/mmbd/pst/queryDefault.do",data:{pk_org:o.value,id:r.value,fplanpurpose:n.value},async:!1,success:function(e){u=e.data.isneed2}}),u?(0,l.promptBox)({color:"warning",content:e.state.json["10140PST-000001"]+":"+o.display+","+e.state.json["10140PST-000002"]+":"+n.display+","+e.state.json["10140PST-000003"],noFooter:!1,noCancelBtn:!1,beSureBtnName:e.state.json["10140PST-000006"],cancelBtnName:e.state.json["10140PST-000007"],beSureBtnClick:e.beSure.bind(e),cancelBtnClick:e.beCancel.bind(e)}):e.confirmSave()}else e.confirmSave()},this.delConfirm=function(){(0,l.ajax)({url:"/nccloud/mmbd/pst/delete.do",data:{param:[{id:e.props.getUrlParam("id"),ts:e.props.form.getFormItemsValue(e.formId,"ts").value}]},success:function(t){if(1==t.data.sucessNum){var a=e.props.getUrlParam("id"),n=b(a,k);v("pk_pst",a,k),e.getDataForCache(n,(function(){(0,l.toast)({color:"success",title:e.state.json["10140PST-000019"]})}))}}})},this.modelSave=function(t){e.saveClick()},this.getButtonNames=function(e){return"edit"===e||"add"===e||"save"===e?"main-button":"secondary - button"}},n);_=(0,l.createPage)({billinfo:{billtype:"card",pagecode:S,headcode:y},initTemplate:[]})(_),t.default=_}])}));
//# sourceMappingURL=index.836221bd.js.map