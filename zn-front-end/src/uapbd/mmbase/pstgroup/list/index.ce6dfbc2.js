/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-5-11 14:50:39"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uapbd/mmbase/pstgroup/list/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uapbd/mmbase/pstgroup/list/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,a){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=183)}({1:function(t,a){t.exports=e},183:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a(2),l=p(i),c=(p(a(3)),a(1)),u=a(7);function p(e){return e&&e.__esModule?e:{default:e}}c.base.NCPopconfirm,c.base.NCCheckbox,c.base.NCIcon,c.base.NCTabs.NCTabPane,c.high.PrintOutput;var d=c.cardCache.getDefData,f=(c.cardCache.setDefData,"mmbd.psinfo.psg.data"),h="10140PSG_list",g="psgquery",b="psghead",m="pk_planstrategygroup",y=(n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));o.call(a),a.searchId=g,a.tableId=b,a.selectedRowRecord=null,a.searchVal=null;var n=d("selpk_org",f);return a.state={json:{},pk_org:n||{},pks:[]},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"modifierMeta",value:function(e,t){var a=this;return t[b].pagination=!0,t[b].items.push({attrcode:"opr",label:this.state.json?this.state.json["110140PST0030"]:"110140PST0030",width:200,fixed:"right",className:"table-opr",visible:!0,render:function(t,n,o){return e.button.createOprationButton(["EditLine","Del"],{area:"list-inner",buttonLimit:2,onButtonClick:function(e,r){a.onTableButtonClick.bind(a)(e,r,t,n,o)}})}}),t[g].items.forEach((function(e){"pk_planstrategygroup_b.pk_planstrategy"==e.attrcode?e.queryCondition=function(){if(a.props.search.getSearchValByField(g,"pk_org").value)return{pk_org:a.props.search.getSearchValByField(g,"pk_org").value.firstvalue}}:"pk_org"==e.attrcode&&(e.queryCondition=function(){return{GridRefActionExt:"nccloud.web.mmbd.refer.pub.AppPermissionOrgRefFilter"}})})),t}},{key:"componentDidMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"10140PSG",domainName:"uapbd",callback:function(t,a,n){a&&e.setState({json:r({},e.state.json,t),inlt:n},(function(){e.initTemplate(e.props)}))}});this.props.MultiInit.getMultiLang({moduleId:"10140MMPUBMSG",domainName:"uapbd",callback:function(t,a,n){a&&e.setState({pubjson:r({},t)})}}),!d("searchParam",f)||this.props.search.setSearchValue(g,d("searchParam",f))}},{key:"buttonClick",value:function(e,t){switch(t){case"Add":var a=e.search.getAllSearchData(g);c.cacheTools.set("searchParams",a),this.props.table.selectAllRows(b,!1),e.pushTo("/card",{status:"add"});break;case"Refresh":if(!this.props.search.getSearchValByField(g,"pk_org").value.firstvalue){(0,c.toast)({content:this.state.json["110140PST0029"],color:"warning"});break}this.refreshAction(e,!0);break;case"Delete":(0,c.promptBox)({color:"warning",title:this.state.pubjson["10140PUBMESSAGE-000009"],content:this.state.pubjson["10140PUBMESSAGE-000010"],noFooter:!1,noCancelBtn:!1,beSureBtnName:this.state.pubjson["10140PUBMESSAGE-000029"],cancelBtnName:this.state.pubjson["10140PUBMESSAGE-000007"],beSureBtnClick:this.deleteAction.bind(this)})}}},{key:"onRowClick",value:function(e,t,a,n){this.selectedRowRecord=a}},{key:"getData",value:function(e,t){var a=this,n=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments[3]),o=this.props.search.getQueryInfo("psgquery");console.log(o);var s=o.oid,i=r({},o,{pageInfo:{pageIndex:0,pageSize:10,total:0,totalPage:0},pagecode:h,queryAreaCode:g,oid:s,queryType:"simple",pk_org:this.state.pk_org.refpk});(0,c.ajax)({url:"/nccloud/mmbd/psg/query.do",data:i,success:function(e){if(e.data){var t=[];e.data[b].allpks.forEach((function(e){t.push(e)})),e.data[b].allpks=t,c.cacheTools.set("allpks",t),a.props.table.setAllTableData(b,e.data[b]),n&&n()}else{a.props.button.setButtonDisabled({Delete:!0}),a.props.table.setAllTableData(b,{allpks:[],rows:[]}),(0,c.toast)({content:a.state.json?a.state.pubjson["10140PUBMESSAGE-000030"]:"10140PUBMESSAGE-000030",color:"warning"})}}})}},{key:"render",value:function(){var e=this.props,t=e.table,a=e.button,n=e.search,o=(e.base,e.modal),r=this.props.button.getButtons();r=r.sort((function(e,t){return t.btnorder-e.btnorder}));var s=t.createSimpleTable,i=n.NCCreateSearch,c=(o.createModal,a.createButtonApp);a.getButtons;return l.default.createElement("div",{className:"nc-bill-list"},l.default.createElement("div",{className:"nc-bill-header-area"},l.default.createElement("div",{className:"header-title-search-area"},l.default.createElement("h2",{className:"title-search-detail"},this.state.json?this.state.json["110140PST0022"]:"110140PST0022")),l.default.createElement("div",{className:"header-button-area"},c({area:"list-area",buttonLimit:3,onButtonClick:this.buttonClick.bind(this),popContainer:document.querySelector(".header-button-area")}))),l.default.createElement("div",{className:"nc-bill-search-area"},i(this.searchId,{clickSearchBtn:this.clickSearchBtn.bind(this),onAfterEvent:this.searchPanelEvent.bind(this)})),l.default.createElement("div",{className:"nc-bill-table-area"},s(this.tableId,{dataSource:f,pkname:m,tableModelConfirm:this.tableModelConfirm,showIndex:!0,onRowClick:this.onRowClick.bind(this),showCheck:!0,handlePageInfoChange:this.pageInfoClick.bind(this),onRowDoubleClick:this.doubleClick.bind(this),onSelected:this.onSelected.bind(this),onSelectedAll:this.onSelected.bind(this)})))}}]),t}(i.Component),o=function(){var e=this;this.initTemplate=function(t){var a=t.createUIDom({pagecode:h},(function(a){if(a){if(a.template){var n=a.template;n=e.modifierMeta(t,n),t.meta.setMeta(n),!d("searchParam",f)||e.props.search.setSearchValue(g,d("searchParam",f))}if(a.button){var o=a.button;t.button.setButtons(o),t.button.setButtonDisabled({Delete:!0})}}}));console.log(a)},this.onTableButtonClick=function(t,a,n,o,r){if(console.log("id="+a),"EditLine"===a&&(t.table.selectAllRows(b,!1),t.pushTo("/card",{status:"edit",id:o.pk_planstrategygroup.value})),"Del"===a){var s=o.pk_planstrategygroup.value;(0,c.promptBox)({color:"warning",content:e.state.json["110140PST0032"],beSureBtnClick:function(){(0,c.ajax)({url:"/nccloud/mmbd/psg/delete.do",data:{param:[{id:o.pk_planstrategygroup.value,ts:o.ts.value}]},success:function(a){1==a.data.sucessNum?((0,c.toast)({color:"success",content:e.state.json["110140PST0033"]}),(0,t.table.deleteCacheId)(b,s),t.table.deleteTableRowsByIndex(b,r)):(0,c.toast)({color:"danger",content:a.data.errorMessages[0]})}})}})}},this.doubleClick=function(t,a,n,o){var r=e.props.search.getAllSearchData(g);c.cacheTools.set("searchParams",r),e.props.table.selectAllRows(b,!1),e.props.pushTo("/card",{status:"browse",id:t.pk_planstrategygroup.value})},this.onSelected=function(t,a,n,o,r){e.props.table.getCheckedRows(b).length>0?e.props.button.setButtonDisabled({Delete:!1}):e.props.button.setButtonDisabled({Delete:!0})},this.deleteAction=function(t){var a=e.props.table.getCheckedRows(b),n=[];a.length>0?a.forEach((function(e){n.push({id:e.data.values[m].value,ts:e.data.values.ts.value})})):e.selectedRowRecord&&n.push({id:e.selectedRowRecord[m].value,ts:e.selectedRowRecord.ts.value}),(0,c.ajax)({url:"/nccloud/mmbd/psg/delete.do",data:{param:n},success:function(t){(0,u.showBatchOprMessage)(null,t.data,e.state.pubjson["10140PUBMESSAGE-000028"]),e.refreshAction(e.props)}})},this.refreshAction=function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.getData({},e.state.isShowOff,!1,(function(){a&&(0,c.toast)({title:e.state.json["110140PST0042"],color:"success"})})),t.button.setButtonDisabled("Delete",!0)},this.pageInfoClick=function(t,a,n){var o=t.table.getTablePageInfo(e.tableId),s=t.search.getAllSearchData(g),i=e.props.search.getQueryInfo("psgquery"),l=e.props.meta.getMeta()[g].oid,u=r({},i,{showDisableDataFlag:e.state.checkValue,querycondition:s,pageCode:h,queryAreaCode:g,oid:l,querytype:"simple",pageInfo:o,pagepks:n});(0,c.ajax)({url:"/nccloud/mmbd/psg/query.do",data:u,success:function(e){var a=e.success,n=e.data;a&&(n?t.table.setAllTableData(b,n[b]):t.table.setAllTableData(b,{rows:[]}))}})},this.clickSearchBtn=function(t,a){e.searchVal=a,c.cacheTools.set("searchParams",a),e.getData(a,e.state.isShowOff,!0)},this.searchPanelEvent=function(t,a){"pk_org"==t&&setTimeout((function(){e.props.meta.getMeta()[g].items.find((function(e){return"pk_planstrategygroup_b.pk_planstrategy"==e.attrcode})).queryCondition=function(){if(e.props.search.getSearchValByField(g,"pk_org").value)return{pk_org:e.props.search.getSearchValByField(g,"pk_org").value.firstvalue}}}),0)}},n);y=(0,c.createPage)({initTemplate:[]})(y),t.default=y},2:function(e,a){e.exports=t},3:function(e,t){e.exports=a},7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showWarningDialog=t.showBatchOprMessage=void 0;var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(1);var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lang=null,this.inlt=null,console.log("LangContainer初始化"),(0,o.getMultiLang)({moduleId:"10140MMPUBMSG",domainName:"uapbd",callback:this.init.bind(this),needInlt:!0})}return n(e,[{key:"init",value:function(e,t,a){t&&(this.lang=e,this.inlt=a)}},{key:"getLangByResId",value:function(e,t){return t?this.inlt.get(e,t)||e:this.lang&&this.lang[e]||e}}]),e}());function s(e,t,a,n,r,s,i,l,c){(0,o.toast)({duration:a,color:n,title:e,content:t,groupOperation:r,TextArr:s,groupOperationMsg:i,onExpand:l,onClose:c})}function i(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];(0,o.promptBox)({color:n,title:e,content:t,noFooter:a.noFooter,noCancelBtn:a.noCancelBtn,beSureBtnName:a.beSureBtnName,cancelBtnName:a.cancelBtnName,beSureBtnClick:a.beSureBtnClick,cancelBtnClick:a.cancelBtnClick,closeBtnClick:a.closeBtnClick,closeByClickBackDrop:a.closeByClickBackDrop})}t.showBatchOprMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.getLangByResId("10140PUBMESSAGE-000003"),t=arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=t.failedNum?t.failedNum:0,l=t.sucessNum;if(0==i)!function(e,t,a){s(e,t,a)}(r.getLangByResId("10140PUBMESSAGE-000018",{0:n}),r.getLangByResId("10140PUBMESSAGE-000022",{0:t.sucessNum}));else if(0==l){e=r.getLangByResId("10140PUBMESSAGE-000019",{0:n});var c=r.getLangByResId("10140PUBMESSAGE-000020",{0:t.failedNum,1:t.failedNum});(0,o.toast)({duration:"infinity",color:"danger",title:e,content:c,groupOperation:!0,TextArr:[r.getLangByResId("10140PUBMESSAGE-000000"),r.getLangByResId("10140PUBMESSAGE-000001"),r.getLangByResId("10140PUBMESSAGE-000002")],groupOperationMsg:t.errorMessages,onExpand:a.onExpand,onClose:a.onClose})}else{e=r.getLangByResId("10140PUBMESSAGE-000019",{0:n});var u=r.getLangByResId("10140PUBMESSAGE-000021",{0:Number(t.sucessNum)+Number(t.failedNum),1:t.sucessNum,2:t.failedNum});(0,o.toast)({duration:"infinity",color:"danger",title:e,content:u,groupOperation:!0,TextArr:[r.getLangByResId("10140PUBMESSAGE-000000"),r.getLangByResId("10140PUBMESSAGE-000001"),r.getLangByResId("10140PUBMESSAGE-000002")],groupOperationMsg:t.errorMessages,onExpand:a.onExpand,onClose:a.onClose})}},t.showWarningDialog=function(e,t){i(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},"warning")}}})}));
//# sourceMappingURL=index.ce6dfbc2.js.map