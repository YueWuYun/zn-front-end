/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-5-11 14:50:39"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uapbd/mmbase/pstgroup/card/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uapbd/mmbase/pstgroup/card/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,a){return function(e){var t={};function a(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(r,o,function(t){return e[t]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=182)}({1:function(t,a){t.exports=e},182:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=a(2),l=u(i),d=(u(a(3)),a(1));function u(e){return e&&e.__esModule?e:{default:e}}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=d.base.NCAffix,m=(d.base.NCPopconfirm,d.base.NCFormControl,d.base.NCBackBtn,d.high.PrintOutput,d.cardCache.addCache),f=d.cardCache.getCacheById,b=d.cardCache.updateCache,g=d.cardCache.getCurrentLastId,h=d.cardCache.getNextId,v=d.cardCache.deleteCacheById,I="mmbd.psinfo.psg.data",y="psgcardh",k="psgcardb",T="10140PSG_card",S="search",_="/nccloud/mmbd/psg/addsave.do",w="pk_planstrategygroup";function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=e.getUrlParam("status"),r=[],o=[];"edit"==a||"add"==a?(o=["Edit","Add","back","Delete","Refresh","Enable","Disable","Print","Output"],r=["Save","Cancel","AddLine","DelLine"],"add"==a?r.push("SaveAdd"):o.push("SaveAdd"),e.button.setButtonVisible(o,!1),e.button.setButtonVisible(r,!0),e.cardPagination.setCardPaginationVisible("cardPaginationBtn",!1)):(o=["Save","Cancel","AddLine","DelLine","SaveAdd"],r=["Add","Edit","Delete","back","Refresh","Print","Output"],2==t?(r.push("Disable"),o.push("Enable")):(r.push("Enable"),o.push("Disable")),e.button.setButtonVisible(o,!1),e.button.setButtonVisible(r,!0),e.cardPagination.setCardPaginationVisible("cardPaginationBtn",!0)),e.form.setFormStatus(y,a),e.cardTable.setStatus(k,"edit"==a||"add"==a?"edit":"browse"),window.onbeforeunload="add"!=a&&"edit"!=a?null:function(){return""},"add"==a?(e.form.setFormItemsDisabled(y,{creator:!0,creationtime:!0,modifier:!0,modifiedtime:!0}),e.form.getFormItemsValue(y,"pk_org")&&e.form.getFormItemsValue(y,"pk_org").value?(e.form.setFormItemsDisabled(y,{vpsgcode:!1,vpsgname:!1,vnote:!1}),e.button.setButtonDisabled(["AddLine"],!1)):(e.form.setFormItemsDisabled(y,{vpsgcode:!0,vpsgname:!0,vnote:!0}),e.button.setButtonDisabled(["AddLine"],!0))):"edit"==a&&e.form.setFormItemsDisabled(y,{pk_org:!0,creator:!0,creationtime:!0,modifier:!0,modifiedtime:!0})}var B=(r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.call(a),a.formId=y,a.searchId=S,a.tableId=k,a.old_pk_org="",a.state={pk_org:"",title_code:"",totalcount:0,applycount:0,backVisible:!0,json:{}},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"modifierMeta",value:function(e,t){var a=this,r=e.getUrlParam("status");t[y].status=r,t[k].status=r,t[k].items.map((function(e){"pk_planstrategy"==e.attrcode&&(e.isDataPowerEnable=!1,e.isMultiSelectedEnabled=!0)})),t[y].items.map((function(e){"pk_org"==e.attrcode&&(e.isDataPowerEnable=!1,e.queryCondition=function(){return{GridRefActionExt:"nccloud.web.mmbd.refer.pub.AppPermissionOrgRefFilter"}})})),t["psgcardb&childform2"].items.map((function(e){"pk_planstrategy"==e.attrcode&&(e.isDataPowerEnable=!1,e.isMultiSelectedEnabled=!0)})),"edit"==r&&(e.form.setFormItemsDisabled(y,{pk_org:!1}),t[k].items.map((function(t){"pk_planstrategy"==t.attrcode&&(t.isDataPowerEnable=!1,t.queryCondition=function(){return{pk_org:e.form.getFormItemsValue(y,"pk_org").value}},t.isMultiSelectedEnabled=!0)})),t["psgcardb&childform2"].items.map((function(t){"pk_planstrategy"==t.attrcode&&(t.isDataPowerEnable=!1,t.queryCondition=function(){return{pk_org:e.form.getFormItemsValue(y,"pk_org").value}},t.isMultiSelectedEnabled=!0)})));var o={itemtype:"customer",attrcode:"opr",label:this.state.json?this.state.json["110140PST0030"]:"110140PST0030",visible:!0,className:"table-opr",width:200,fixed:"right",render:function(t,r,o){var n="browse"===a.props.cardTable.getStatus(k)?["Ext"]:["Del"];return e.button.createOprationButton(n,{area:"card-inner",buttonLimit:1,onButtonClick:function(e,n){a.onTableButtonClick.bind(a)(e,n,t,r,o)}})}};return t[k].items.push(o),t}},{key:"componentDidMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"10140MMPUBMSG",domainName:"uapbd",callback:function(t,a,r){a&&e.setState({pubjson:n({},t)})}}),this.props.MultiInit.getMultiLang({moduleId:"10140PSG",domainName:"uapbd",callback:function(t){e.setState({json:t},(function(){e.initTemplate(e.props)}))}}),C(this.props),this.updateCardTableBtnStatus();var t=this.props.getUrlParam("status");if("add"!=t){var a=this.props.getUrlParam("id");a&&"undefined"!=a&&this.getdata(a)}else this.setDefaultValue();"add"!=t&&"edit"!=t||this.setState({backVisible:!1})}},{key:"componentWillUnmount",value:function(){null}},{key:"cancelSureEvent",value:function(){var e=this;if("add"===this.props.getUrlParam("status")){var t=g(I);this.getDataForCache(t,(function(){e.props.pushTo("/card",{status:"browse",id:e.props.getUrlParam("id")}),e.props.form.setFormStatus(e.formId,"browse"),e.props.cardTable.setStatus(e.tableId,"browse")}))}"edit"===this.props.getUrlParam("status")&&(this.props.form.cancel(this.formId),this.props.cardTable.resetTableData(this.tableId),this.props.pushTo("/card",{status:"browse",id:this.props.getUrlParam("id")}),C(this.props)),this.setState({backVisible:!0})}},{key:"sureChangeOrg",value:function(){this.props.form.setFormItemsValue(y,{vpsgcode:{value:"",display:""},vpsgname:{value:"",display:""}}),this.props.cardTable.setTableData(k,{rows:[]}),this.props.form.getFormItemsValue(y,"pk_org").value?(this.props.form.setFormItemsDisabled(y,{vpsgcode:!1,vpsgname:!1,vnote:!1}),this.props.button.setButtonDisabled(["AddLine"],!1)):(this.props.form.setFormItemsDisabled(y,{vpsgcode:!0,vpsgname:!0,vnote:!0}),this.props.button.setButtonDisabled(["AddLine"],!0));var e=this.props.meta.getMeta();e[k].items.map((function(e){"pk_planstrategy"==e.attrcode&&(e.queryCondition=function(){return{pk_org:value.value}})})),e["psgcardb&childform2"].items.map((function(e){"pk_planstrategy"==e.attrcode&&(e.queryCondition=function(){return{pk_org:value.value}})}))}},{key:"cancelChangeOrg",value:function(){var e=this.old_pk_org,t=e.display,a=e.value;this.props.form.setFormItemsValue(y,{pk_org:{display:t,value:a}})}},{key:"afterEvent",value:function(e,t,a,r,o){"pk_org"==a&&r.value!=o.value&&"pk_org"==a&&(o&&o.value?(e.modal.show("sureChangeOrg"),this.old_pk_org=o):(e.form.setFormItemsDisabled(y,{vpsgcode:!1,vpsgname:!1,vnote:!1}),e.button.setButtonDisabled(["AddLine"],!1)))}},{key:"onCardTableAfterEvent",value:function(e,t,a,r,o,n,s){var i=this,l=[this.state.json["110140PST0045"],this.state.json["110140PST0046"]];if("pk_planstrategy"==a){var d=0;if(!r||0==r.length)return e.cardTable.setValByKeyAndIndex(this.tableId,n,"pk_planstrategy",{value:"",display:""}),e.cardTable.setValByKeyAndIndex(this.tableId,n,"pk_planstrategy.name",{value:"",display:""}),void e.cardTable.setValByKeyAndIndex(this.tableId,n,"fplanpurpose",{value:"",display:""});o.map((function(t){if(t.newvalue.value!=t.oldvalue.value){0!=d&&(e.cardTable.addRow(k),e.cardTable.getAllRows(i.tableId).map((function(t){t.values.pk_group={value:window.parent.GETBUSINESSINFO().groupId,display:window.parent.GETBUSINESSINFO().groupName},t.values.pk_org=e.form.getFormItemsValue(i.formId,"pk_org")})));var a={};if(a.value=r[d].refpk,a.display=r[d].refcode,e.cardTable.setValByKeyAndIndex(i.tableId,n+d,"pk_planstrategy",a),e.cardTable.setValByKeyAndIndex(i.tableId,n+d,"pk_planstrategy.name",{value:r[d].refname,display:r[d].refname}),t.newvalue.value){var o=r.find((function(e){return e.refpk==t.newvalue.value}));e.cardTable.setValByKeyAndIndex(i.tableId,n+d,"fplanpurpose",{value:o.values.fplanpurpose.value,display:l[o.values.fplanpurpose.value]})}else e.cardTable.setValByKeyAndIndex(i.tableId,n+d,"fplanpurpose",{});d++}else d++}))}}},{key:"isEmpty",value:function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return!(null!=e&&!a.find((function(t){return t==e})))}},{key:"setReferValueSimple",value:function(e,t){for(var a in t.rows[0])this.isEmpty(t.rows[0][a].value)||(e.rows[0][a]={value:t.rows[0][a].value,display:t.rows[0][a].display});return e}},{key:"getDataForCache",value:function(e,t){if(e){var a=f(e,I);a?(this.props.form.setAllFormValue(p({},y,a.head[y])),a.body&&a.body[k]?this.props.cardTable.setTableData(k,a.body[k]):this.props.cardTable.setTableData(k,{rows:[]}),this.props.setUrlParam(e)):(this.getdata(e),this.props.setUrlParam(e)),t&&"function"==typeof t&&t.call(this),C(this.props)}else this.props.pushTo("/list",{})}},{key:"updateCardTableBtnStatus",value:function(){this.props.cardTable.getCheckedRows(this.tableId).length>0?this.props.button.setButtonDisabled(["DelLine"],!1):this.props.button.setButtonDisabled(["DelLine"],!0)}},{key:"render",value:function(){var e=this,t=this.props,a=t.cardTable,r=t.form,o=t.button,n=t.modal,s=t.cardPagination.createCardPagination,i=this.props.BillHeadInfo.createBillHeadInfo,d=r.createForm,u=a.createCardTable,p=o.createButtonApp,m=n.createModal;this.props.getUrlParam("status");return l.default.createElement("div",{className:"nc-bill-card"},l.default.createElement("div",{className:"nc-bill-top-area"},l.default.createElement(c,null,l.default.createElement("div",{className:"nc-bill-header-area"},l.default.createElement("div",{className:"header-title-search-area"},l.default.createElement("span",null,i({title:this.state.json["110140PST0022"],backBtnClick:function(){e.buttonClick.call(e,e.props,"Back")}}))),l.default.createElement("div",{className:"header-button-area"},p({area:"header-action",onButtonClick:this.buttonClick.bind(this)}),s({handlePageInfoChange:this.pageInfoClick.bind(this),dataSource:I})))),l.default.createElement("div",{className:"nc-bill-form-area"},d(this.formId,{onAfterEvent:this.afterEvent.bind(this)}))),l.default.createElement("div",{className:"nc-bill-bottom-area"},l.default.createElement("div",{className:"nc-bill-table-area"},u(this.tableId,{tableHead:this.getTableHead.bind(this),modelSave:this.modelSave.bind(this),onBeforeEvent:this.onCardTableBeforeEvent.bind(this),onAfterEvent:this.onCardTableAfterEvent.bind(this),showIndex:!0,showCheck:!0,onSelected:this.updateCardTableBtnStatus.bind(this),onSelectedAll:this.updateCardTableBtnStatus.bind(this)}))),m("sureChangeOrg",{color:"warning",size:"sm",title:this.state.json?this.state.json["110140PST0036"]:"110140PST0036",content:this.state.json?this.state.json["110140PST0043"]:"110140PST0043",beSureBtnClick:this.sureChangeOrg.bind(this),cancelBtnClick:this.cancelChangeOrg.bind(this)}))}}]),t}(i.Component),o=function(){var e=this;this.initTemplate=function(t){t.createUIDom({pagecode:T},(function(a){if(a){if(a.template){var r=a.template;e.modifierMeta(t,r),t.meta.setMeta(r)}if(a.button){var o=a.button;t.button.setButtons(o)}a.context.pk_org&&(e.props.form.setFormItemsValue(y,{pk_org:{value:a.context.pk_org,display:a.context.org_Name}}),e.setState({pk_org:{value:a.context.pk_org,display:a.context.org_Name}}),e.props.button.setButtonDisabled(["AddLine"],!1)),C(t)}}))},this.info=function(){return window.parent.GETBUSINESSINFO()},this.onTableButtonClick=function(e,t,a,r,o){"Ext"===t&&e.cardTable.toggleRowView(k,r),"Del"===t&&e.cardTable.delRowsByIndex(k,o)},this.setDefaultValue=function(){e.props.form.setFormItemsValue(e.formId,{pk_group:{value:window.parent.GETBUSINESSINFO().groupId,display:window.parent.GETBUSINESSINFO().groupName}})},this.buttonClick=function(t,a){switch(a){case"Add":t.pushTo("/card",{status:"add"}),t.form.EmptyAllFormValue(e.formId),t.cardTable.setTableData(e.tableId,{rows:[]}),t.form.setFormItemsDisabled(y,{pk_org:!1,creator:!0,creationtime:!0,modifier:!0,modifiedtime:!0}),e.state.pk_org&&e.props.form.setFormItemsValue(y,{pk_org:n({},e.state.pk_org)}),C(e.props),e.setDefaultValue(),e.setState({backVisible:!1});break;case"Edit":t.form.setFormItemsDisabled(y,{pk_org:!0,creator:!0,creationtime:!0,modifier:!0,modifiedtime:!0}),t.pushTo("/card",{status:"edit",id:t.getUrlParam("id")}),C(e.props),e.setState({backVisible:!1});break;case"Delete":(0,d.promptBox)({color:"warning",title:e.state.json["10140TAXRE-000004"],content:e.state.json["110140PST0032"],noFooter:!1,noCancelBtn:!1,beSureBtnName:e.state.pubjson["10140PUBMESSAGE-000029"],cancelBtnName:e.state.pubjson["10140PUBMESSAGE-000007"],beSureBtnClick:e.delConfirm.bind(e)});break;case"Back":t.pushTo("/list",{});break;case"Save":e.saveClick();break;case"Cancel":(0,d.promptBox)({color:"warning",title:e.state.json["110140PST0000"],content:e.state.json["110140PST0038"],noFooter:!1,noCancelBtn:!1,beSureBtnName:e.state.json["10140TAXRE-000006"],cancelBtnName:e.state.json["10140TAXRE-000007"],beSureBtnClick:e.cancelSureEvent.bind(e)});break;case"AddLine":if(!e.props.form.getFormItemsValue(e.formId,"pk_org")||!e.props.form.getFormItemsValue(e.formId,"pk_org").value)return void(0,d.toast)({color:"warning",content:e.state.json["110140PST0029"]});t.cardTable.addRow(e.tableId),t.cardTable.getAllRows(e.tableId).map((function(a){a.values.pk_group={value:window.parent.GETBUSINESSINFO().groupId,display:window.parent.GETBUSINESSINFO().groupName},a.values.pk_org=t.form.getFormItemsValue(e.formId,"pk_org")})),C(e.props);break;case"DelLine":var r=t.cardTable.getCheckedRows(e.tableId),o=[];r.forEach((function(e){o.push(e.index)})),t.cardTable.delRowsByIndex(e.tableId,o);break;case"Refresh":e.getdata(e.props.form.getFormItemsValue(e.formId,"pk_planstrategygroup").value,(function(){(0,d.toast)({title:e.state.json["110140PST0042"],color:"success"})}));break;case"SaveAdd":e.saveClick(!0)}},this.pageInfoClick=function(t,a){e.getDataForCache(a)},this.getdata=function(t,a){var r={pk:t};(0,d.ajax)({url:"/nccloud/mmbd/psg/querycard.do",data:r,success:function(t){t.data.head&&(e.props.form.setAllFormValue(p({},e.formId,t.data.head[e.formId])),C(e.props)),t.data.body?e.props.cardTable.setTableData(e.tableId,t.data.body[e.tableId]):e.props.cardTable.setTableData(e.tableId,{rows:[]}),a&&"function"==typeof a&&a.call(e)}})},this.onCardTableBeforeEvent=function(t,a,r,o,n,s,i,l){return"pk_planstrategy"==r&&t.meta.getMeta()[e.tableId].items.map((function(a){a.queryCondition=function(){return{pk_org:t.form.getFormItemsValue(e.formId,"pk_org").value}}})),!0},this.saveClick=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e.props.form.isCheckNow(y,"warning")){e.props.cardTable.filterEmptyRows(k,["pk_planstrategy.name"],"include");var a=!0,r=e.props.cardTable.getAllRows(e.tableId);if(r.forEach((function(e){3!=e.status&&(a=!1)})),a)(0,d.toast)({color:"warning",title:e.state.json["110140PST0044"]?e.state.json["110140PST0044"]:"110140PST0044"});else{var o=e.props.createMasterChildData(T,e.formId,e.tableId);delete o.head[y].rows[0].values.pk_taxregions;var n=_;"edit"===e.props.getUrlParam("status")&&(n="/nccloud/mmbd/psg/update.do"),(0,d.ajax)({url:n,data:o,success:function(a){var r=null;if(a.success){a.data&&!t?(a.data.head&&(e.props.form.setAllFormValue(p({},e.formId,a.data.head[e.formId])),C(e.props)),a.data.body?e.props.cardTable.setTableData(e.tableId,a.data.body[e.tableId]):e.props.cardTable.setTableData(e.tableId,{rows:[]})):r=a.data.head[e.formId].rows[0].values[w].value,n==_?m(r,a.data,e.formId,I):b(w,a.data.head[y].rows[0].values[w].value,a.data,y,I);var o=e.props.form.getFormItemsValue(y,"pk_org");t?(e.props.form.EmptyAllFormValue(e.formId),e.props.table.setAllTableData(e.tableId,{rows:[]}),e.props.form.setFormItemsDisabled(y,{pk_org:!1,creator:!0,creationtime:!0,modifier:!0,modifiedtime:!0}),C(e.props),e.setDefaultValue(),e.props.form.setFormItemsValue(y,{pk_org:o}),e.props.form.setFormItemsDisabled(y,{vpsgcode:!1,vpsgname:!1,vnote:!1}),e.props.button.setButtonDisabled(["AddLine"],!1)):(e.props.pushTo("/card",{status:"browse",id:r}),C(e.props),e.setState({backVisible:!0})),(0,d.toast)({content:e.state.json["110140PST0037"],color:"success"})}}})}}},this.delConfirm=function(){(0,d.ajax)({url:"/nccloud/mmbd/psg/delete.do",data:{param:[{id:e.props.form.getFormItemsValue(e.formId,"pk_planstrategygroup").value,ts:e.props.form.getFormItemsValue(e.formId,"ts").value}]},success:function(t){if(1==t.data.sucessNum){var a=e.props.form.getFormItemsValue(e.formId,"pk_planstrategygroup").value,r=h(a,I);v(w,a,I),e.getDataForCache(r,(function(){(0,d.toast)({color:"success",title:e.state.json["110140PST0033"]})}))}else(0,d.toast)({color:"danger",content:t.data.errorMessages[0]})}})},this.modelSave=function(t){t.cardTable.closeModel(e.tableId),e.saveClick()},this.getButtonNames=function(e){return"edit"===e||"add"===e||"save"===e?"main-button":"secondary - button"},this.getTableHead=function(){var t=e.props.button.createButtonApp;e.props.button.getButtons(),e.props.getUrlParam("status");return l.default.createElement("div",{className:"shoulder-definition-area"},l.default.createElement("div",{className:"definition-icons",style:{padding:"0px"}},t({area:"body-action",onButtonClick:e.buttonClick.bind(e)}),e.props.cardTable.createBrowseIcons(e.tableId,{iconArr:["close","open","max","setCol"],maxDestAreaId:"nc-bill-card"})))}},r);B=(0,d.createPage)({initTemplate:[]})(B),t.default=B},2:function(e,a){e.exports=t},3:function(e,t){e.exports=a}})}));
//# sourceMappingURL=index.ce6dfbc2.js.map