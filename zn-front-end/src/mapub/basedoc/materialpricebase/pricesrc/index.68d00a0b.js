/*! @ncctag {"project":"","branch":"","provider":"","date":"2020-5-12 11:46:26"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react"],t):"object"==typeof exports?exports["mapub/basedoc/materialpricebase/pricesrc/index"]=t(require("nc-lightapp-front"),require("react")):e["mapub/basedoc/materialpricebase/pricesrc/index"]=t(e["nc-lightapp-front"],e.React)}(window,(function(e,t){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="../../../../",n(n.s=187)}({1:function(t,n){t.exports=e},187:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(4),i=(o=r)&&o.__esModule?o:{default:o},l=n(1),s=n(188),c=n(195);var u=l.base.NCModal,d=l.base.NCButton,p=(l.base.NCDiv,l.base.NCTooltip),f=l.base.NCHotKeys,b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.getdealTableData=function(){(0,l.ajax)({url:"/nccloud/mapub/materialpricebase/priceSrcInitData.do",data:{vpricesourcenum:n.Info.vpricesourcenum,pageId:n.pageId},success:function(e){e.data?n.props.editTable.setTableData(n.tableId,e.data[n.tableId]):n.props.editTable.setTableData(n.tableId,{rows:[]}),n.props.editTable.addRow(n.tableId,void 0,!0,[]),n.toggleShow()}})},n.toggleShow=function(){for(var e=[],t=[],o=0;o<n.Info.allButtonsKey.length;o++){s.buttonVisible.call(n,n.props,n.Info.allButtonsKey[o])?e.push(n.Info.allButtonsKey[o]):t.push(n.Info.allButtonsKey[o])}n.props.button.setButtonDisabled(e,!1),n.props.button.setButtonDisabled(t,!0)},n.onRowClick=function(e,t,o,a,r){n.toggleShow()},n.close=function(e){n.Info.vpricesourcenum=null,n.Info.isAddLine=!1,n.props.isPriceSrcModalShow(!1)},n.confirm=function(){var e=n.props.editTable.getAllRows(n.tableId),t={model:{areacode:n.tableId,rows:e},pageid:n.pageId};(0,l.ajax)({url:"/nccloud/mapub/materialpricebase/priceSrcconfirm.do",data:{grid:t},success:function(t){var o="",a="";e.forEach((function(e,t){if("3"!=e.status){var n=e.values.vpricesource;if(n.value){o+=n.display,a+=n.value;var r=e.values.pk_org;r.value&&(o=o+"["+r.display+"]",a=a+"["+r.value+"]"),o+=",",a+=","}}})),o.length>0&&(o=o.substring(0,o.length-1)),a.length>0&&(a=a.substring(0,a.length-1)),n.props.PriceSrcRender(o,a),n.close()}})},n.tableId=c.tableId,n.pageId=c.pageId,n.PriceSourceEnum=c.PriceSourceEnum,n.Info={allButtonsKey:[],vpricesourcenum:null,isAddLine:!1},n.state={json:{}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){var e=this;(0,l.getMultiLang)({moduleId:[c.multiLangCode],domainName:c.module,currentLocale:"simpchn",callback:function(t){e.setState({json:t},(function(){s.initTemplate.call(e,e.props)}))}})}},{key:"componentWillReceiveProps",value:function(e){e.show&&!this.exiting&&(e.vpricesourcenum!=this.Info.vpricesourcenum||e.isAddLine!=this.Info.isAddLine?(this.Info.vpricesourcenum=e.vpricesourcenum,this.Info.isAddLine=e.isAddLine,this.getdealTableData()):this.toggleShow())}},{key:"render",value:function(){var e=this,t=this.props,n=(t.table,t.button),o=t.show,a=t.isPriceSrcModalShow,r=t.title,l=this.props.editTable.createEditTable,b=n.createButtonApp;return i.default.createElement(u,{show:o&&!this.exiting,size:"lg",onHide:this.close,backdrop:"static",fieldid:"pricesrc",onExit:function(){e.exiting=!0},onExited:function(){setTimeout((function(){e.exiting=!1,a&&a(!1)}),0)},ref:function(t){return e.NCModal=t}},i.default.createElement(f,{keyMap:{sureBtnHandler:f.USUAL_KEYS.NC_MODAL_CONFIRM,cancelBtnHandler:f.USUAL_KEYS.NC_MODAL_CALCEL},handlers:{sureBtnHandler:function(){e.NCModal&&e.NCModal.isTopModal()&&e.confirm.bind(e)()},cancelBtnHandler:function(){e.NCModal&&e.NCModal.isTopModal()&&e.close.bind(e)()}},className:"simpleModal-hotkeys-wrapper",focused:!0,attach:document.body,display:"inline-block"}),i.default.createElement(u.Header,{closeButton:!0},i.default.createElement(u.Title,{fieldid:r},r," ")),i.default.createElement(u.Body,null,i.default.createElement("div",{className:"nc-bill-list"},i.default.createElement("div",{className:"nc-bill-header-area"},i.default.createElement("div",{className:"header-button-area"},b({area:"list_head_area",buttonLimit:3,onButtonClick:s.buttonClick.bind(this),popContainer:document.querySelector(".header-button-area")}))),i.default.createElement("div",{className:"nc-bill-table-area"},l(c.tableId,{onSelected:this.onRowClick.bind(this),onSelectedAll:this.onRowClick.bind(this),onBeforeEvent:s.bodyBeforeEvent.bind(this),onAfterEvent:s.bodyafterEvent.bind(this),showCheck:!0,showIndex:!0})))),i.default.createElement(u.Footer,null,i.default.createElement(p,{placement:"top",inverse:!0,overlay:this.state.json["38100110-000010"]+"  ("+f.USUAL_KEYS.NC_MODAL_CONFIRM+")",trigger:["focus","hover"],className:"model-helper-overlay"},i.default.createElement(d,{onClick:this.confirm,colors:"primary",fieldid:"confirm"},this.state.json["38100110-000010"],"(",i.default.createElement("span",{className:"text-decoration-underline"},"Y"),")")),i.default.createElement(p,{placement:"top",inverse:!0,overlay:this.state.json["38100110-000008"]+"  ("+f.USUAL_KEYS.NC_MODAL_CALCEL+")",trigger:["focus","hover"],className:"model-helper-overlay"},i.default.createElement(d,{onClick:this.close,fieldid:"cancel"},this.state.json["38100110-000008"],"(",i.default.createElement("span",{className:"text-decoration-underline"},"N"),")"))))}}]),t}(r.Component);b=(0,l.createPage)({})(b),t.default=b},188:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bodyafterEvent=t.bodyBeforeEvent=t.buttonVisible=t.initTemplate=t.buttonClick=void 0;var o=s(n(189)),a=s(n(190)),r=s(n(192)),i=s(n(193)),l=s(n(194));function s(e){return e&&e.__esModule?e:{default:e}}t.buttonClick=o.default,t.initTemplate=a.default,t.buttonVisible=r.default,t.bodyBeforeEvent=i.default,t.bodyafterEvent=l.default},189:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){switch(t){case"AddLine":this.props.editTable.addRow(this.tableId,void 0,!0,[]);break;case"DelLine":var n=e.editTable.getCheckedRows(this.tableId);if(0==n.length)return void(0,o.toast)({color:"warning",content:this.state.json["38100110-000006"]});var a=[];n.forEach((function(e){a.push(e.index)})),a.length>0&&e.editTable.deleteTableRowsByIndex(this.tableId,a),this.toggleShow();break;case"InsertLine":var r=e.editTable.getCheckedRows(this.tableId);0==r.length&&(0,o.toast)({color:"warning",content:this.state.json["38100110-000019"]}),1!=r.length&&(0,o.toast)({color:"warning",content:this.state.json["38100110-000018"]}),this.props.editTable.addRow(this.tableId,r[0].index+1,!0,[]);break;case"UpMove":for(var i=e.editTable.getCheckedRows(this.tableId),l=-1,s=0;s<i.length;s++){var c=i[s].index;0==c?l=c:(l=c-l>1?c-1:c,e.editTable.moveRow(this.tableId,c,l))}break;case"DownMove":for(var u=e.editTable.getCheckedRows(this.tableId),d=e.editTable.getAllRows(this.tableId),p=d.length,f=u.length-1;f>-1;f--){(g=u[f].index)==d.length?p=g-1:(p=p-g>1?g+1:g,e.editTable.moveRow(this.tableId,g,p))}break;case"MoveBottom":var b=e.editTable.getCheckedRows(this.tableId),h=e.editTable.getAllRows(this.tableId),v=h.length-1;for(f=b.length-1;f>-1;f--){var g;if((g=b[f].index)==h.length)v=g-1;else for(var m=g;m<v;m++)e.editTable.moveRow(this.tableId,m,m+1);v--}break;case"MoveTop":for(var y=e.editTable.getCheckedRows(this.tableId),I=0,_=0;_<y.length;_++){var C=y[_].index;if(0==C)I=C;else for(var w=C;w>I;w--)e.editTable.moveRow(this.tableId,w,w-1);I++}}};var o=n(1);o.base.Message},190:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=this;e.createUIDom({pagecode:n.pageId,appcode:e.getSearchParam("c")},(function(t){if(t){if(t.template){var o=t.template;o[n.tableId].status="edit",e.meta.setMeta(o)}if(t.button){var r=t.button;(0,a.getButtonsKey)(r,n.Info.allButtonsKey),e.button.setButtons(r)}}}))};n(1);var o,a=n(46),r=n(191);(o=r)&&o.__esModule},191:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,r){var i=this;delete a.key;var l={model:{areacode:this.tableId,rows:[{status:"0",values:a}]},pageid:this.pageId},s=this.state.pk_org.refpk,c=this.state.cperiod.refname;switch(t){case"BillDetail_inner":this.Info.selectGrid=l,this.isDetailModalShow();break;case"CancelVoucher_inner":(0,o.ajax)({url:"/nccloud/cm/pc/cancelVoucher.do",data:{pk_org:s,cperiod:c,grid:l},success:function(e){e.success&&((0,o.toast)({color:"success",content:i.state.json["38302016-000006"]}),i.getTableData())}});break;case"CreateVoucher_inner":(0,o.ajax)({url:"/nccloud/cm/pc/genvoucher.do",data:{pk_org:s,cperiod:c,grid:l},success:function(e){e.success&&((0,o.toast)({color:"success",content:i.state.json["38302016-000005"]}),i.getTableData())}})}};var o=n(1)},192:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=!0,o=this.props.editTable.getCheckedRows(this.tableId);switch(t){case"AddLine":break;case"DelLine":0==o.length&&(n=!1);break;case"InsertLine":1!=o.length&&(n=!1);break;case"UpMove":case"DownMove":case"MoveBottom":case"MoveTop":0==o.length&&(n=!1)}return n}},193:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,a,r){var i=this,l=!0,s={isDataPowerEnable:"Y",AppCode:"",GridRefActionExt:"",TreeRefActionExt:"",itemKey:"",pk_org:"",vpricesource:""},c=e.meta.getMeta();return c[t].items.map((function(t){var o=t.attrcode;if(o==n.attrcode)switch(o){case"pk_org":var a=r.values.vpricesource.value;a!=i.PriceSourceEnum.MANUAL&&a!=i.PriceSourceEnum.STDCOST||(l=!1);var c=null;a==i.PriceSourceEnum.PINGJUNCAIGOURUKU||a==i.PriceSourceEnum.FORWARD?(t.refName=i.state.json["38100110-000021"],c="COSTREGION0000000000"):(a==i.PriceSourceEnum.PLAN||i.PriceSourceEnum.REFERENCE,t.refName=i.state.json["38100110-000020"],c="FINANCEORGTYPE000000,COSTREGION0000000000"),t.queryCondition=function(t){return s.AppCode=e.getSearchParam("c"),s.vpricesource=a,s.itemKey=o,s.orgTypeIds=c,s}}})),e.meta.setMeta(c),l};n(1)},194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,a,r,i){if(a[0].newvalue.value==a[0].oldvalue.value)return;if(t==this.tableId){"vpricesource"==n&&this.props.editTable.setValByKeyAndIndex(this.tableId,r,"pk_org",{value:null,display:null,scale:null});var l=e.editTable.getAllRows(this.tableId),s=0;l.forEach((function(e){"3"!=e.status&&s++})),s==r+1&&this.props.editTable.addRow(this.tableId,void 0,!0,[])}};n(1)},195:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.tableId="list",t.pageId="38100110_pricesrc",t.appcode="38100110",t.multiLangCode="38100110";t.module="mapub";t.PriceSourceEnum={MANUAL:1,PLAN:2,REFERENCE:3,PINGJUNCAIGOURUKU:13,FORWARD:6,STDCOST:9}},4:function(e,n){e.exports=t},46:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=["Add","AddGroup"],a=["Add","ImportData","Refresh","AddGroup"],r=function(e,t,n,r){var i=!0,l=e.props.getUrlParam("status");if(l||(l="browse"),!t||(!t.pk_org||!t.pk_org.value)&&"browse"==l)return"list"==r?-1!=a.indexOf(n):-1!=o.indexOf(n);switch(n){case"Add":case"Edit":case"Copy":case"Delete":case"Refresh":"browse"!=l&&(i=!1);break;case"Save":case"Cancel":"browse"==l&&(i=!1);break;case"ImportData":case"ExportData":case"TakePrice":case"AttachManage":"browse"!=l&&(i=!1);break;case"AddLine":case"DelLine":case"CopyLine":"browse"==l&&(i=!1);break;case"PasteToEndLine":case"CancelLine":i=!1}return i},i=function(e,t){for(var n=[],o=[],a=0;a<t.Info.allButtonsKey.length;a++){r(t,e,t.Info.allButtonsKey[a],"list")?n.push(t.Info.allButtonsKey[a]):o.push(t.Info.allButtonsKey[a])}t.props.button.setButtonDisabled(n,!1),t.props.button.setButtonDisabled(o,!0)};t.getButtonsKey=function e(t,n){for(var o=0;o<t.length;o++)"list_inner_area"!=t[o].area&&"card_inner_area"!=t[o].area&&(0==t[o].children.length?n.push(t[o].key):(n.push(t[o].key),e(t[o].children,n)));return n},t.getInnerButtonkey=function(e){for(var t=[],n=0;n<e.length;n++)"list_inner_area"!=e[n].area&&"card_inner_area"!=e[n].area||t.push(e[n].key);return t},t.initCardBodyEditControl=function(e,t){t?(e.button.setButtonDisabled(["AddLine"],!1),e.button.setButtonDisabled(["CopyLine","DelLine"],!0)):e.button.setButtonDisabled(["AddLine","CopyLine","DelLine"],!0)},t.cardBodyControl=function(e,t){e.button.setButtonVisible(["PasteToEndLine","CancelLine"],!t),e.button.setButtonVisible(["CopyLine","DelLine","AddLine"],t)},t.cardBodyAndInnerButtonVisible=function(e,t,n){var o=e.props.cardTable.getStatus(e.tableId);return n&&"browse"==o?["Close_inner"]:"browse"==o?["Open_inner"]:"edit"==o?1==t?["OpenEdit_inner","Copy_inner","Insert_inner","Delete_inner"]:0==t?["Paste_inner"]:[]:[]},t.onSelectedCardBodyEditControl=function(e){var t=e.props.getUrlParam("status");if(t||(t="browse"),"browse"==t);else{var n=e.props.createMasterChildData(e.pageId,e.formId,e.tableId).head[e.formId].rows[0].values;if(n.pk_org?n.pk_org.value:null)e.props.cardTable.getCheckedRows(e.tableId).length>0?e.props.button.setButtonDisabled(["CopyLine","DelLine"],!1):e.props.button.setButtonDisabled(["CopyLine","DelLine"],!0);else e.props.button.setButtonDisabled(["AddLine","CopyLine","DelLine"],!0)}},t.buttonVisible=r,t.onListButtonControl=function(e){var t=e.props.table.getCheckedRows(e.tableId);1==t.length?i(t[0].data.values,e):t.length>1?e.props.button.setButtonDisabled(e.Info.allButtonsKey,!1):i(null,e)}}})}));
//# sourceMappingURL=index.68d00a0b.js.map