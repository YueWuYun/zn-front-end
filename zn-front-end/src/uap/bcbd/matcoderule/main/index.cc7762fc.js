/*! @ncctag {"date":"2020-5-11 23:33:34"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uap/bcbd/matcoderule/main/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uap/bcbd/matcoderule/main/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,a){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=287)}({1:function(t,a){t.exports=e},2:function(e,a){e.exports=t},218:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.headerButtonClick=t.beforeEvent=t.afterEvent=t.initTemplate=void 0;var n=i(a(219)),o=i(a(220)),r=i(a(221)),l=i(a(222));function i(e){return e&&e.__esModule?e:{default:e}}t.initTemplate=n.default,t.afterEvent=o.default,t.beforeEvent=l.default,t.headerButtonClick=r.default},219:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.createUIDom({pagecode:"1057060201",appcode:"1057MBCRD"},(function(t){if(t){if(t.button){var a=t.button;e.button.setButtons(a)}if(t.template){var n=t.template;e.meta.setMeta(n)}}}))}},220:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,a,n,o,r,l){"pk_matbasclass"==a&&n&&(n.refpk?(e.editTable.setValByKeyAndIndex(t,r,"pk_matbasclass",{value:n.refpk,display:n.refcode},!1),e.editTable.setValByKeyAndIndex(t,r,"pk_matbasclass.name",{value:n.refname,display:n.refname},!1)):(e.editTable.setValByKeyAndIndex(t,r,"pk_matbasclass",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,r,"pk_matbasclass.name",{value:"",display:""},!1)),e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid.name",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid.version",{value:"",display:""},!1));"cmaterialvid"==a&&n&&(e.editTable.setValByKeyAndIndex(t,r,"pk_matbasclass",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,r,"pk_matbasclass.name",{value:"",display:""},!1),n.refpk?(e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid",{value:n.refpk,display:n.refcode},!1),e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid.name",{value:n.refname,display:n.refname},!1)):(e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid.name",{value:"",display:""},!1)),n.values&&n.values.version?e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid.version",{value:n.values.version.value,display:n.values.version.value},!1):e.editTable.setValByKeyAndIndex(t,r,"cmaterialvid.version",{value:"",display:""},!1))};a(1)},221:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var a=this,l=void 0;switch(t){case"add":var i=a.props.editTable.getAllRows().length;"browse"==a.pagestatus?(a.pagestatus="add",a.initButtonStatus(!1,a),a.props.editTable.addRow("material",i,!1,{pk_group:a.state.loginfo.pk_group,creationtime:a.state.loginfo.createTime,creator:a.state.loginfo.user})):a.props.editTable.addRow("material",i,!1,{pk_group:a.state.loginfo.pk_group,creationtime:a.state.loginfo.createTime,creator:a.state.loginfo.user});break;case"edit":a.pagestatus="edit",a.initButtonStatus(!1,a),a.props.editTable.setStatus("material","edit");break;case"del":if("browse"!=a.pagestatus){var s=a.props.editTable.getCheckedRows("material");if(!s||s.length<=0)return void(0,n.toast)({color:"warning",content:a.state.json["dictcodeorg-000002"]});var d=[];s.map((function(e){return d.push(e.index),d})),a.props.editTable.deleteTableRowsByIndex("material",d)}else{var u=a.props.editTable.getCheckedRows("material");if(!u||u.length<=0)return void(0,n.toast)({color:"warning",content:a.state.json["dictcodeorg-000003"]});e.ncmodal.show("ncmodal",{title:React.createElement("span",{className:"nc-theme-common-font-c"},a.state.json["dictcodeorg-000004"]),beSureBtnClick:function(){for(var e=[],t=[],o=0;o<u.length;o++){var r=u[o];e.push(r.index),t.push(r.data)}l={material:{rows:t}},(0,n.ajax)({url:"/nccloud/bcbd/meterial/del.do",data:l,success:function(t){t.success&&t.data&&(t.data.status?(a.props.editTable.deleteTableRowsByIndex("material",e),a.initButtonStatus(!0,a),(0,n.toast)({color:"success"})):(0,n.toast)({color:"danger",content:t.data.message}))}})}})}break;case"setDefault":l={material:{rows:[a.props.editTable.getCheckedRows("material")[0].data]}},o(a,{pk_org:"",material:l},"/nccloud/bcbd/meterial/setdeFault.do",!0);break;case"save":if(!a.props.editTable.checkRequired("material",a.props.editTable.getAllRows("material")))return;a.props.editTable.filterEmptyRows("material",["isdefault"]);var c=a.props.editTable.getChangedRows("material");if(!c||c.length<=0)return a.initButtonStatus(!0,a),void(0,n.toast)({color:"success"});for(var p=[],f=[],b=[],m=0;m<c.length;m++){var v=c[m];"2"==v.status?p.push({values:v.values}):"3"==v.status?b.push({values:v.values}):"1"==v.status&&f.push({values:v.values})}var y={addrows:p&&p.length>0?{material:{rows:p}}:"",editrows:f&&f.length>0?{material:{rows:f}}:"",delrows:b&&b.length>0?{material:{rows:b}}:"",nodeType:"GROUP_NODE",pk_org:""};o(a,y,"/nccloud/bcbd/meterial/save.do",!0);break;case"cancel":e.ncmodal.show("ncmodal",{title:React.createElement("span",{className:"nc-theme-common-font-c"},a.state.json["dictcodeorg-000005"]),beSureBtnClick:function(){a.showMaterialData("GROUP_NODE"),a.initButtonStatus(!0,a)}});break;case"printor":var h=r(a);if(!h||h.length<=0)return;(0,n.print)("pdf","/nccloud/bcbd/meterial/print.do",{funcode:"1057MBCRD",appcode:"1057MBCRD",nodekey:"metercoderule",oids:h});break;case"preview":var g=r(a);if(!g||g.length<=0)return;(0,n.print)("pdf","/nccloud/bcbd/meterial/print.do",{funcode:"1057MBCRD",appcode:"1057MBCRD",nodekey:"metercoderule",oids:g});break;case"exportor":var k=r(a);if(!k||k.length<=0)return;var B={funcode:"1057MBCRD",appcode:"1057MBCRD",nodekey:"metercoderule",oids:k,outputType:"output"};(0,n.output)({url:"/nccloud/bcbd/meterial/print.do",data:B,callback:function(){}});break;case"freshen":a.showMaterialData(a.state.nodeType)}};var n=a(1);function o(e,t,a,o){(0,n.ajax)({url:a,data:t,success:function(t){t.success&&t.data&&(t.data.status?(o&&(e.showMaterialData("GROUP_NODE"),e.initButtonStatus(!0,e)),(0,n.toast)({color:"success"})):(0,n.toast)({color:"danger",content:t.data.message}))}})}function r(e){var t=[],a=e.props.editTable.getAllRows("material");return!a||a.length<=0?((0,n.toast)({color:"danger",content:e.state.json["dictcodeorg-000007"]}),t):(a.map((function(e){return t.push(e.values.pk_matruledist.value),t})),t)}},222:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,a,n,o,r){var l=!0;if("pk_matbasclass"==a.attrcode)return!r.values.cmaterialvid.value||(this.props.ncmodal.show("ncmodal",{title:React.createElement("span",{className:"nc-theme-common-font-c"},this.state.json["dictcodeorg-000000"]),beSureBtnClick:function(){e.editTable.setValByKeyAndIndex(t,n,"cmaterialvid",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,n,"cmaterialvid.name",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,n,"cmaterialvid.version",{value:"",display:""},!1),l=!0},cancelBtnClick:function(){l=!1}}),l);if("cmaterialvid"==a.attrcode)return!r.values.pk_matbasclass.value||(this.props.ncmodal.show("ncmodal",{title:React.createElement("span",{className:"nc-theme-common-font-c"},this.state.json["dictcodeorg-000001"]),beSureBtnClick:function(){e.editTable.setValByKeyAndIndex(t,n,"pk_matbasclass",{value:"",display:""},!1),e.editTable.setValByKeyAndIndex(t,n,"pk_matbasclass.name",{value:"",display:""},!1),l=!0},cancelBtnClick:function(){l=!1}}),l);if("matbarcoderule_v"==a.attrcode){this.props.renderItem("table",t,"matbarcoderule_v",null);var i=this.props.meta.getMeta();i[t].items.find((function(e){return"matbarcoderule_v"==e.attrcode})).queryCondition=function(){return{GridRefActionExt:"nccloud.web.bcbd.code.sqlbuilder.CodeRuleMatSqlBuilder"}},this.props.meta.setMeta(i)}return!0};a(1)},287:function(e,t,a){"use strict";var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(2),r=d(o),l=d(a(3)),i=a(1),s=a(218);function d(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={nodeType:"GROUP_NODE",json:{},loginfo:{}},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"componentWillMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"1057-1057mbcrd",domainName:"uap",callback:function(t,a,n){a?e.setState({json:t,inlt:n}):console.log("未加载到多语资源")}})}},{key:"componentDidMount",value:function(){this.showMaterialData("GROUP_NODE"),this.initButtonStatus(!0,this),this.getLoginfo(),this.pagestatus="browse"}},{key:"getLoginfo",value:function(){var e=this;(0,i.ajax)({url:"/nccloud/bcbd/login/loginfo.do",loading:!1,success:function(t){e.setState({loginfo:t.data})}})}},{key:"initButtonStatus",value:function(e,t){e&&(t.pagestatus="browse",t.props.editTable.setStatus("material","browse"),t.props.button.setButtonDisabled({setDefault:!0})),t.props.button.setButtonVisible(["edit","setDefault","print","freshen"],e),t.props.button.setButtonVisible(["save","cancel"],!e)}},{key:"showMaterialData",value:function(e){var t=this;(0,i.ajax)({url:"/nccloud/bcbd/meterial/queryAll.do",data:{nodeType:e,pk_org:"",pageid:"1057060201"},success:function(e){e&&e.success&&e.data&&e.data.material?t.props.editTable.setTableData("material",e.data.material):t.props.editTable.setTableData("material",{rows:[]})}})}},{key:"onSelected",value:function(e,t,a,n,o){if("browse"==this.pagestatus){var r=this.props.editTable.getCheckedRows(t);!r||r.length<=0?this.props.button.setButtonDisabled({setDefault:!0}):1==r.length?o?this.props.button.setButtonDisabled({setDefault:a.values.isdefault.value}):this.onSelected(e,t,r[0].data,r[0].index,!0):this.props.button.setButtonDisabled({setDefault:!0})}}},{key:"componentDidUpdate",value:function(){var e=this.props.editTable.getStatus("material");window.onbeforeunload=e&&"browse"!=e?function(){return""}:null}},{key:"onSelectedAll",value:function(e,t,a,n){if("browse"==this.pagestatus)if(a){if(n>1)this.props.button.setButtonDisabled({setDefault:!0});else if(1==n){var o=this.props.editTable.getCheckedRows(t);this.onSelected(e,t,o[0].data,o[0].index,a)}}else this.props.button.setButtonDisabled({setDefault:!0})}},{key:"render",value:function(){var e=this.props.BillHeadInfo.createBillHeadInfo,t=i.base.NCDiv;return r.default.createElement("div",{className:"nc-single-table"},this.props.ncmodal.createModal("ncmodal"),r.default.createElement(t,{areaCode:t.config.HEADER},r.default.createElement("div",{className:"nc-singleTable-header-area"},r.default.createElement("div",{className:"header-title-search-area"},r.default.createElement("span",null,e({title:""+this.state.json["dictcodeorg-000006"],initShowBackBtn:!1}))),r.default.createElement("div",{className:"header-button-area"},this.props.button.createButtonApp({area:"page_header",onButtonClick:s.headerButtonClick.bind(this),popContainer:document.querySelector(".header-button-area")})))),r.default.createElement("div",{className:"nc-singleTable-table-area"},this.props.editTable.createEditTable("material",{showIndex:!0,showCheck:!0,adaptionHeight:!0,onAfterEvent:s.afterEvent.bind(this),onBeforeEvent:s.beforeEvent.bind(this),onSelected:this.onSelected.bind(this),onSelectedAll:this.onSelectedAll.bind(this)})))}}]),t}(o.Component);u=(0,i.createPage)({initTemplate:s.initTemplate})(u),l.default.render(r.default.createElement(u,null),document.querySelector("#app"))},3:function(e,t){e.exports=a}})}));
//# sourceMappingURL=index.cc7762fc.js.map