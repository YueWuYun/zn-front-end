/*! @ncctag {"date":"2020-5-11 23:33:34"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front")):"function"==typeof define&&define.amd?define(["nc-lightapp-front"],t):"object"==typeof exports?exports["uap/bcbd/coderule/events/index"]=t(require("nc-lightapp-front")):e["uap/bcbd/coderule/events/index"]=t(e["nc-lightapp-front"])}(window,(function(e){return function(e){var t={};function a(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(r,o,function(t){return e[t]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=174)}({1:function(t,a){t.exports=e},174:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.afterHeadEvent=t.afterEvent=t.beforeEvent=t.headerButtonClick=t.initTemplate=void 0;var r=n(a(175)),o=n(a(176)),s=n(a(177)),d=n(a(178)),l=n(a(179));function n(e){return e&&e.__esModule?e:{default:e}}t.initTemplate=o.default,t.headerButtonClick=r.default,t.beforeEvent=s.default,t.afterEvent=d.default,t.afterHeadEvent=l.default},175:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var a=this;switch(t){case"add":var p=a.props.syncTree.getSelectNode("ruletree");if("genNode"==p.id)return void a.onSelectEve(p.id,p,!0);var c=p.id,u=p.nodeData.pk_barappobj;p.nodeData.isseal||(c=p.pid),a.pagestatus="add",n("add",a),a.props.syncTree.setNodeDisable("ruletree",!0),a.props.form.EmptyAllFormValue("bcbd_header"),a.props.cardTable.setTableData("bcbd_body",{rows:[]}),a.props.form.setFormItemsValue("bcbd_header",{pk_bartype:{value:c},pk_barappobj:{value:u},pk_group:a.state.loginfo.pk_group,creationtime:a.state.loginfo.createTime,creator:a.state.loginfo.user});break;case"edit":a.pagestatus="edit",n("edit",a),a.props.syncTree.setNodeDisable("ruletree",!0);break;case"del":d(a,"/nccloud/bcbd/coderule/delete.do",a.state.json["coderule-000000"],a.props.form.getFormItemsValue("bcbd_header","pk_barcoderule").value);break;case"startUp":d(a,"/nccloud/bcbd/coderule/enable.do",a.state.json["coderule-000001"],null,"startUp");break;case"blockUp":d(a,"/nccloud/bcbd/coderule/disable.do",a.state.json["coderule-000002"],null,"blockUp");break;case"setDefault":d(a,"/nccloud/bcbd/coderule/setdefault.do",a.state.json["coderule-000003"]);break;case"cancel":a.props.ncmodal.show("ncmodal",{title:React.createElement("span",{className:"nc-theme-common-font-c"},a.state.json["coderule-000004"]),beSureBtnClick:function(){l(a),a.props.syncTree.setNodeDisable("ruletree",!1),a.props.form.setFormStatus("bcbd_header","browse"),a.props.cardTable.setStatus("bcbd_body","browse")}});break;case"save":!function(e,t){if(e.props.form.isCheckNow("bcbd_header")){if(e.props.cardTable.filterEmptyRows("bcbd_body"),e.props.cardTable.getNumberOfRows("bcbd_body")<=0)return void(0,r.toast)({color:"danger",content:e.state.json["coderule-000005"]});var a=e.props.cardTable.getAllRows("bcbd_body");if(!e.props.cardTable.checkTableRequired("bcbd_body"))return;for(var o=e.props.form.getFormItemsValue("bcbd_header","length").value,d=0,l=0;l<a.length;l++)"3"!=a[l].status&&(d=parseInt(d)+parseInt(a[l].values.length.value));if(parseInt(o)!=d)return void(0,r.toast)({color:"danger",content:e.state.json["coderule-000005"]});var n=!1;e.props.form.getFormItemsValue("bcbd_header","isgencode")&&e.props.form.getFormItemsValue("bcbd_header","isgencode").value&&(n=!0),"edit"==t&&n?e.props.ncmodal.show("ncmodal",{title:React.createElement("span",{className:"nc-theme-common-font-c"},e.state.json["coderule-000010"]),beSureBtnClick:s.bind(e,e,t,!0),cancelBtnClick:s.bind(e,e,t,!1)}):s(e,t,!1)}}(a,a.pagestatus);break;case"addrow":for(var b=a.props.form.getFormItemsValue("bcbd_header","length").value,i=a.props.cardTable.getAllRows("bcbd_body"),f=0,v=0;v<i.length;v++){var y=i[v].values.length.value;y&&"3"!=i[v].status&&(f=parseInt(f)+parseInt(y))}if(f>=parseInt(b))return void(0,r.toast)({color:"warning",content:a.state.json["coderule-000008"]});o(a,"add");break;case"delrow":var m=a.props.cardTable.getCheckedRows("bcbd_body");if(!m||m.length<=0)return void(0,r.toast)({color:"warning",content:a.state.json["coderule-000009"]});var g=[];m&&m.length>0&&m.map((function(e){return g.push(e.index),g})),a.props.cardTable.delRowsByIndex("bcbd_body",g),o(a)}};var r=a(1);function o(e,t){var a=e.props.cardTable.getAllRows("bcbd_body");if(!a||a.length<=0)t&&"add"==t&&e.props.cardTable.addRow("bcbd_body",e.props.cardTable.getNumberOfRows("bcbd_body"),{startpos:{value:"1",display:"1"},isparseretrieve:{value:!0}});else{for(var r=[],o=0;o<a.length;o++)"3"!=a[o].status&&r.push(a[o]);if(!r||r.length<=0)t&&"add"==t&&e.props.cardTable.addRow("bcbd_body",e.props.cardTable.getNumberOfRows("bcbd_body"),{startpos:{value:"1",display:"1"},isparseretrieve:{value:!0}});else{for(var s=0;s<r.length;s++)for(var d=0;d<r.length-s-1;d++){var l;if(r[d+1].values.startpos.value<r[d].values.startpos.value)l=r[d],r[d]=r[d+1],r[d+1]=l}r[0].values.startpos={value:"1",display:"1"};var n=parseInt(r[0].values.startpos.value)+parseInt(r[0].values.length.value);if(r.length>1)for(o=1;o<r.length;o++){var p;p=r[o-1].values.length.value?parseInt(r[o-1].values.startpos.value)+parseInt(r[o-1].values.length.value):parseInt(r[o-1].values.startpos.value),r[o].values.startpos={value:p,display:p},t&&"add"==t&&o==r.length-1&&(n=r[o].values.length.value?p+parseInt(r[o].values.length.value):p)}t&&"add"==t&&e.props.cardTable.addRow("bcbd_body",e.props.cardTable.getNumberOfRows("bcbd_body"),{startpos:{value:n,display:n},isparseretrieve:{value:!0}})}}}function s(e,t,a){var o={bcbd_header:{bcbd_header:e.props.form.getAllFormValue("bcbd_header")},bcbd_body:{bcbd_body:e.props.cardTable.getAllData("bcbd_body")},opt:t,isnewversion:a};(0,r.ajax)({url:"/nccloud/bcbd/coderule/save.do",data:o,success:function(o){o&&o.data&&(o.data.status?(e.props.syncTree.cancelSelectedNode("ruletree"),"add"==t||a?e.props.syncTree.addNodeSuccess("ruletree",o.data.node[0]):"edit"==t&&e.props.syncTree.editNodeSuccess("ruletree",o.data.node[0]),e.props.syncTree.setNodeSelected("ruletree",o.data.node[0].id),e.onSelectEve(o.data.node[0].id,o.data.node[0],!0),e.props.syncTree.setNodeDisable("ruletree",!1),n("browse",e),(0,r.toast)({color:"success"})):(0,r.toast)({color:"danger",content:o.data.message}))}})}function d(e,t,a,o,s){e.props.ncmodal.show("ncmodal",{title:React.createElement("span",{className:"nc-theme-common-font-c"},a),beSureBtnClick:function(){(0,r.ajax)({url:t,data:{bcbd_header:e.props.form.getAllFormValue("bcbd_header")},success:function(t){t&&t.data&&(t.data.status?(o?(e.props.syncTree.cancelSelectedNode("ruletree"),e.props.syncTree.delNodeSuceess("ruletree",o),e.props.form.EmptyAllFormValue("bcbd_header"),e.props.cardTable.setTableData("bcbd_body",{rows:[]}),e.setbtnstatus(),e.props.button.setButtonDisabled(["add"],!0)):l(e,s),(0,r.toast)({color:"success"})):(0,r.toast)({color:"danger",content:t.data.message}))}})}})}function l(e,t){var a=e.props.syncTree.getSelectNode("ruletree");if(!e.state.isShowSeal&&"blockUp"==t){var r=a.id,o=a.pid;e.props.syncTree.cancelSelectedNode("ruletree"),e.props.syncTree.delNodeSuceess("ruletree",r),a=e.props.syncTree.getSyncTreeValue("ruletree",o)}e.onSelectEve(a.id,a,!0)}function n(e,t){t.props.form.setFormStatus("bcbd_header",e),t.props.cardTable.setStatus("bcbd_body",e),"browse"==e?(t.props.button.setButtonsVisible(["add","edit","del","startUp","blockUp","setDefault"],!0),t.props.button.setButtonsVisible(["save","cancel"],!1)):(t.props.button.setButtonVisible(["add","edit","del","startUp","blockUp","setDefault"],!1),t.props.button.setButtonVisible(["save","cancel"],!0),t.props.button.setButtonDisabled(["addrow","delrow"],!1))}},176:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.createUIDom({pagecode:"1057050101",appcode:"10570BCRG"},(function(t){if(t){if(t.button){var a=t.button;e.button.setButtons(a)}if(t.template){var r=t.template;e.meta.setMeta(r)}}}))};a(1)},177:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,a,r,d,l){var n=void 0;if("pk_appobjattr"==a){var p=this.props.meta.getMeta(),c=e.form.getFormItemsValue("bcbd_header","pk_barappobj").value;this.props.renderItem("table","bcbd_body","pk_appobjattr",null),p[t].items.find((function(e){return"pk_appobjattr"==e.attrcode})).queryCondition=function(){return{pk_barappobj:c,GridRefActionExt:"nccloud.web.bcbd.code.sqlbuilder.BarAppObjectItemRefTableSqlBuilder"}},this.props.meta.setMeta(p)}else{if("accessstrategy"==a)return s(n={attrcode:a,nodeType:this.state.nodeType,accessstrategy:r.value,pk_appobjattr:l.values.pk_appobjattr.value})&&o(this,a,t,n);if("formate"==a)return s(n={attrcode:a,nodeType:this.state.nodeType,pk_appobjattr:l.values.pk_appobjattr.value,accessstrategy:l.values.accessstrategy.value})&&o(this,a,t,n);if("appobjattrvalue"==a)return s(n={attrcode:a,nodeType:this.state.nodeType,pk_appobjattr:l.values.pk_appobjattr.value,accessstrategy:l.values.accessstrategy.value})&&o(this,a,t,n)}return!0};var r=a(1);function o(e,t,a,o){var s=e.props.meta.getMeta(),d=!1;return(0,r.ajax)({url:"/nccloud/bcbd/coderule/changeitems.do",data:o,async:!1,success:function(r){if(r&&r.success&&r.data){if(d=r.data.isEdit,!r.data.type)return;switch(t){case"accessstrategy":e.props.renderItem("table","bcbd_body","accessstrategy",null),s[a].items.find((function(e){return"accessstrategy"==e.attrcode})).itemtype=r.data.type,s[a].items.find((function(e){return"accessstrategy"==e.attrcode})).options=r.data.options,e.props.meta.setMeta(s);break;case"formate":e.props.renderItem("table","bcbd_body","formate",null),s[a].items.find((function(e){return"formate"==e.attrcode})).itemtype=r.data.type,e.props.meta.setMeta(s);break;case"appobjattrvalue":if(e.props.renderItem("table","bcbd_body","appobjattrvalue",null),s[a].items.find((function(e){return"appobjattrvalue"==e.attrcode})).itemtype=r.data.type,"refer"==r.data.type){if(r.data.refpath&&(s[a].items.find((function(e){return"appobjattrvalue"==e.attrcode})).refcode=r.data.refpath),!r.data.wherepart)break;s[a].items.find((function(e){return"appobjattrvalue"==e.attrcode})).queryCondition=function(){return{wherepart:r.data.wherepart,GridRefActionExt:"nccloud.web.bcbd.code.sqlbuilder.BarCodeDictTableRefSqlBuilder"}}}e.props.meta.setMeta(s);break;default:d=!1}}}}),d}function s(e){return!!e&&!!e.pk_appobjattr}},178:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,a,o,s,d,l){var n=this,p=void 0,c=void 0;if("pk_appobjattr"==a){if(o&&o.refpk&&(p=o.refpk),!p)return;n.setDefaultOptions(),c={attrcode:a,nodeType:n.state.nodeType,pk_appobjattr:p,accessstrategy:l.values.accessstrategy.value}}else if("accessstrategy"==a){if(!l.values||!l.values.pk_appobjattr.value)return;c={attrcode:a,accessstrategy:o,nodeType:n.state.nodeType,pk_appobjattr:l.values.pk_appobjattr.value}}else if("appobjattrvalue"==a)c={attrcode:a,accessstrategy:l.values.accessstrategy.value,appobjattrvalue:o,nodeType:n.state.nodeType,pk_appobjattr:l.values.pk_appobjattr.value},"2"==l.values.accessstrategy.value?n.props.cardTable.setValByKeysAndIndex("bcbd_body",d,{pk_bardict:{value:o.refpk,display:o.refname}}):n.props.cardTable.setValByKeysAndIndex("bcbd_body",d,{pk_bardict:{value:"",display:""}});else{if("length"!=a)return;if(d==n.props.cardTable.getNumberOfRows("bcbd_body")-1)return;var u=n.props.cardTable.getValByKeyAndIndex("bcbd_body",d,"length").value,b=n.props.cardTable.getValByKeyAndIndex("bcbd_body",d,"startpos").value;b||(b=0==d?1:parseInt(n.props.cardTable.getValByKeyAndIndex("bcbd_body",d-1,"startpos").value)+parseInt(n.props.cardTable.getValByKeyAndIndex("bcbd_body",d-1,"length").value?n.props.cardTable.getValByKeyAndIndex("bcbd_body",d-1,"length").value:0));for(var i=parseInt(u||0)+parseInt(b),f=n.props.cardTable.getNumberOfRows("bcbd_body"),v=d+1;v<f;v++){n.props.cardTable.setValByKeysAndIndex("bcbd_body",v,{startpos:{value:i,display:i}});var y=n.props.cardTable.getValByKeyAndIndex("bcbd_body",v,"length");y&&y.value&&y.value>0&&(i=parseInt(i)+parseInt(y.value))}}if(!c)return;(0,r.ajax)({url:"/nccloud/bcbd/coderule/changepkappobjattr.do",data:c,async:!1,success:function(e){if(e&&e.success&&e.data)if(e.data.status)switch(a){case"pk_appobjattr":if(e.data.accessstrategy){n.state.options.find((function(t){return t.value==e.data.accessstrategy}));for(var o=void 0,s=0;s<n.state.options.length;s++)n.state.options[s].value==e.data.accessstrategy&&(o=n.state.options[s]);n.props.cardTable.setValByKeyAndIndex(t,d,"accessstrategy",o)}else n.props.cardTable.setValByKeyAndIndex(t,d,"accessstrategy",n.state.options[0]);e.data.appobjattrvalue?n.props.cardTable.setValByKeyAndIndex(t,d,"appobjattrvalue",{value:e.data.appobjattrvalue,display:e.data.appobjattrvalue}):n.props.cardTable.setValByKeyAndIndex(t,d,"appobjattrvalue",{value:"",display:""}),e.data.formate?n.props.cardTable.setValByKeyAndIndex(t,d,"formate",{value:e.data.formate,display:e.data.formate}):n.props.cardTable.setValByKeyAndIndex(t,d,"formate",{value:"",display:""});break;case"accessstrategy":e.data.appobjattrvalue?n.props.cardTable.setValByKeyAndIndex(t,d,"appobjattrvalue",{value:e.data.appobjattrvalue,display:e.data.appobjattrvalue}):n.props.cardTable.setValByKeyAndIndex(t,d,"appobjattrvalue",{value:"",display:""}),e.data.formate?n.props.cardTable.setValByKeyAndIndex(t,d,"formate",{value:e.data.formate,display:e.data.formate}):n.props.cardTable.setValByKeyAndIndex(t,d,"formate",{value:"",display:""});break;case"appobjattrvalue":e.data.formate?n.props.cardTable.setValByKeyAndIndex(t,d,"formate",{value:e.data.formate,display:e.data.formate}):n.props.cardTable.setValByKeyAndIndex(t,d,"formate",{value:"",display:""})}else(0,r.toast)({color:"danger",content:e.data.message})}})};var r=a(1)},179:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,a,r,o){if("fillcode"==a){var s=r&&r.value?r.value.trim():null;if(!s||s.length>1)return void this.props.form.setFormItemsValue(t,{fillcode:{value:"",display:""}});if(/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/.test(s)||/.*[\u4e00-\u9fa5]+.*$/.test(s))return void this.props.form.setFormItemsValue(t,{fillcode:{value:"",display:""}})}}}})}));
//# sourceMappingURL=index.cc7762fc.js.map