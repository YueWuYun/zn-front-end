/*! @ncctag {"date":"2020-5-11 23:39:24"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uap/rbac/roleGroup/main/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uap/rbac/roleGroup/main/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,o){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="../../../../",o(o.s=658)}({1:function(t,o){t.exports=e},2:function(e,o){e.exports=t},3:function(e,t){e.exports=o},449:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beforeEvent=t.headerButtonClick=t.initTemplate=void 0;var r=o(450),n=o(453);t.initTemplate=n.initTemplate,t.headerButtonClick=r.headerButtonClick,t.beforeEvent=r.beforeEvent},450:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beforeEvent=t.headerButtonClick=void 0;var r=a(o(451)),n=a(o(452));function a(e){return e&&e.__esModule?e:{default:e}}t.headerButtonClick=r.default,t.beforeEvent=n.default},451:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o,n=e,a=e.syncTree.getSelectNode("tree1"),u="",c="",i=this;switch(t){case"add":this.pageType="add",o=i,(0,r.ajax)({url:"/nccloud/rbac/get/getLoginInfo.do",data:{state:"rolegroup"},async:!1,success:function(e){e.success&&e.data&&o.props.form.setAllFormValue({rolegroup:e.data.rolegroup})}}),null!=a&&(u=a.refpk,setTimeout((function(){if("adminRootPK"==u||"busiRootPK"==u||"rolegroup"==u?u="":c=a.refname,""!==c){var t=c.split(" ");c=t[1]}e.form.setFormItemsValue("rolegroup",{parent_code:{value:u,display:c},group_type:{value:a.nodeData.group_type}})}),1),e.form.setFormItemsDisabled("rolegroup",{group_type:!0})),e.button.setButtonVisible({add:!1,edit:!1,del:!1,save:!0,cancel:!0}),e.form.setFormStatus("rolegroup","edit"),e.syncTree.setNodeDisable("tree1",!0);break;case"save":if(e.form.isCheckNow("rolegroup")){var l=e.form.getAllFormValue("rolegroup"),s="/nccloud/rabc/roleGroup/save.do";"edit"===this.pageType&&(s="/nccloud/rabc/roleGroup/update.do"),(0,r.ajax)({loading:!0,url:s,data:{data:l},success:function(e){e.success&&(n.syncTree.setNodeDisable("tree1",!1),n.form.setFormStatus("rolegroup","browse"),"edit"==i.pageType?function(e,t){var o={pid:e.pid,refcode:e.refcode,refname:e.refname,refpk:e.refpk,values:e.values,nodeData:e.nodeData};t.syncTree.editNodeSuccess("tree1",o)}(e.data[0],n):"add"==i.pageType&&p(e.data[0],n),i.getFormData(e.data[0].refpk),i.props.syncTree.setNodeSelected("tree1",e.data[0].refpk),n.button.setButtonVisible({add:!0,edit:!0,del:!0,save:!1,cancel:!1}),(0,r.toast)({color:"success"}))},error:function(e){(0,r.toast)({content:e.message,color:"danger"})}})}break;case"edit":this.pageType="edit",null!=a&&("adminRootPK"==(u=a.pid)||"busiRootPK"==u?(u="",c=""):c=i.props.syncTree.getSyncTreeValue("tree1",a.pid).refname,this.props.form.setFormItemsValue("rolegroup",{parent_code:{value:u,display:c}}),e.form.setFormItemsDisabled("rolegroup",{group_type:!0}),e.button.setButtonVisible({add:!1,edit:!1,del:!1,save:!0,cancel:!0}),e.syncTree.setNodeDisable("tree1",!0),e.form.setFormStatus("rolegroup","edit"));break;case"del":var d=i.props.syncTree.getSelectNode("tree1");d&&d.refpk?n.ncmodal.show("ncmodal",{size:"sm",title:this.state.json["0002"],beSureBtnClick:function(){(0,r.ajax)({loading:!0,url:"/nccloud/rabc/roleGroup/delete.do",data:d.refpk,success:function(e){e.success&&(i.props.syncTree.delNodeSuceess("tree1",d.refpk),i.props.syncTree.cancelSelectedNode("tree1"),i.props.form.EmptyAllFormValue("rolegroup"),i.props.button.setButtonsVisible({edit:!1,del:!1}),(0,r.toast)({color:"success"}))},error:function(e){(0,r.toast)({content:e.message,color:"danger"})}})}}):(0,r.toast)({content:this.state.json["0004"],color:"danger"});break;case"cancel":n.ncmodal.show("ncmodal",{size:"sm",title:this.state.json["0003"],beSureBtnClick:function(){n.form.setFormStatus("rolegroup","browse"),n.syncTree.setNodeDisable("tree1",!1),a?"adminRootPK"==a.refpk||"busiRootPK"==a.refpk?(i.onSelectEve(null,null,!0),i.props.button.setButtonVisible({add:!0,edit:!1,del:!1,save:!1,cancel:!1})):(i.getFormData(a.refpk),n.button.setButtonVisible({add:!0,edit:!0,del:!0,save:!1,cancel:!1})):(n.form.EmptyAllFormValue("rolegroup"),n.button.setButtonVisible({add:!0,edit:!1,del:!1,save:!1,cancel:!1}))}})}var p=function(e,t){var o={pid:e.pid,refcode:e.refcode,refname:e.refname,refpk:e.refpk,values:e.values,nodeData:e.nodeData};t.syncTree.addNodeSuccess("tree1",o)}};var r=o(1)},452:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,r,n){if("parent_code"!=o)return!0;var a=n.group_type.value,u=e.meta.getMeta();return u[t].items.map((function(e,o){u[t].items.find((function(e){return"parent_code"==e.attrcode})).isMultiSelectedEnabled=!1,u[t].items.find((function(e){return"parent_code"==e.attrcode})).queryCondition=function(){return{parent_code:n.pk_role_group.value,group_type:a}}})),e.meta.setMeta(u),!0};o(1)},453:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initTemplate=void 0;var r,n=o(454),a=(r=n)&&r.__esModule?r:{default:r};t.initTemplate=a.default},454:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.MultiInit.getMultiLang({moduleId:"rbac-roletemplet",domainName:"uap",callback:function(t,o,r){o?e.createUIDom({pagecode:n},(function(o){if(o){if(o.template){var r=o.template;!function(e,t,o){t.rolegroup.items.map((function(e,r){t.rolegroup.items.find((function(e){return"pk_org"==e.attrcode})).queryCondition=function(){return{TreeRefActionExt:"nccloud.web.rbac.authres.sqlbuilder.AuthResOrgPermSqlBuilder"}},t.rolegroup.items.find((function(e){return"parent_code"==e.attrcode})).unitProps={placeholder:o["0006"],rootNode:{refname:o["0006"],refpk:"root"},refType:"tree",refName:o["0006"],refCode:"uapbd.org.BusinessUnitAndGroupTreeRef",queryTreeUrl:"/nccloud/uapbd/ref/BusinessUnitAndGroupTreeRef.do",treeConfig:{name:[o["0007"],o["0008"]],code:["refcode","refname"]},isMultiSelectedEnabled:!1},t.rolegroup.items.find((function(e){return"parent_code"==e.attrcode})).isShowUnit=!0}))}(0,r,t),e.meta.setMeta(r)}if(o.button){var n=o.button;e.button.setButtons(n)}}})):console.log("未加载到多语资源")}})};var r=o(1),n="1012030101";r.base.NCButton,r.base.NCPopconfirm,r.base.NCIcon},658:function(e,t,o){"use strict";var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=o(2),a=l(n),u=l(o(3)),c=o(1),i=o(449);function l(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.getData=function(){var e=o;(0,c.ajax)({url:"/nccloud/rabc/tree/roleGroup.do",data:{pageid:"rolegroup"},loading:!1,success:function(t){t.success&&t.data?(t.data[0].attrcode="adminRoot",t.data[1].attrcode="busiRoot",e.props.syncTree.setSyncTreeData("tree1",t.data)):e.props.syncTree.setSyncTreeData("tree1",[])},error:function(t){e.props.syncTree.setSyncTreeData("tree1",[]),(0,c.toast)({content:t.message,color:"danger"})}})},o.formId="rolegroup",o.state={logInfo:{},json:{}},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"1012-10120rolegroup",domainName:"uap",callback:function(t,o,r){o?e.setState({json:t,inlt:r}):console.log("未加载到多语资源")}})}},{key:"componentDidMount",value:function(){this.props.button.setButtonVisible({add:!0,edit:!1,del:!1,save:!1,cancel:!1}),this.getLoginData(),this.getData()}},{key:"getLoginData",value:function(){var e=this;(0,c.ajax)({url:"/nccloud/rbac/get/getLoginInfo.do",data:{},success:function(t){t.success&&t.data&&e.setState({logInfo:t.data})}})}},{key:"onSelectEve",value:function(e,t,o){var r=this.props.syncTree.getSelectNode("tree1");if(!r||null==r){var n=this.props.syncTree.getSyncTreeValue("tree1");if(!(n&&n.length>0))return;r=this.props.syncTree.getSyncTreeValue("tree1")[0],o=!0}if(o){var a=r.refpk,u=r.pid;if("adminRootPK"==a||"busiRootPK"==a){this.props.button.setButtonVisible({add:!0,edit:!1,del:!1,save:!1,cancel:!1});var c=r.nodeData.formData;"adminRootPK"!=u&&"busiRootPK"!=u||(c.rolegroup.rows[0].values.parent_code={value:""}),this.props.form.setAllFormValue({rolegroup:c.rolegroup})}else r&&null!=r&&this.getFormData(a)}}},{key:"getFormData",value:function(e){var t=this;e&&null!=e?(0,c.ajax)({url:"/nccloud/rabc/card/roleGroup.do",data:e,loading:!1,success:function(e){e.success&&(t.props.form.setAllFormValue({rolegroup:e.data.rolegroup}),t.props.button.setButtonVisible({add:!0,edit:!0,del:!0,save:!1,cancel:!1}))},error:function(e){(0,c.toast)({content:e.message,color:"danger"})}}):t.props.form.EmptyAllFormValue("rolegroup")}},{key:"render",value:function(){var e=this.props,t=e.form,o=e.syncTree,r=(e.ncmodal,e.button),n=e.DragWidthCom,u=e.BillHeadInfo,l=o.createSyncTree,s=t.createForm,d=(r.createButtonApp,c.base.NCDiv),p=u.createBillHeadInfo;return a.default.createElement("div",null,a.default.createElement(d,{areaCode:d.config.HEADER},a.default.createElement("div",{className:"header"},p({title:this.state.json["0001"],initShowBackBtn:!1}),a.default.createElement("div",{className:"btn-group"},this.props.button.createButtonApp({area:"main",onButtonClick:i.headerButtonClick.bind(this),popContainer:document.querySelector(".btn-group")})))),a.default.createElement("div",{className:"tree-card"},a.default.createElement(n,{leftDom:a.default.createElement("div",{className:"tree-area"},l({treeId:"tree1",showLine:!0,needSearch:!0,needEdit:!1,searchType:"filtration",selectedForInit:!0,onSelectEve:this.onSelectEve.bind(this)})),rightDom:a.default.createElement("div",{className:"card-area"},s("rolegroup",{onBeforeEvent:i.beforeEvent.bind(this)})),defLeftWid:"20%"})),this.props.ncmodal.createModal("ncmodal"))}}]),t}(n.Component),d=(0,c.createPage)({initTemplate:i.initTemplate})(s);u.default.render(a.default.createElement(d,null),document.querySelector("#app"))}})}));
//# sourceMappingURL=index.3a8d23ea.js.map