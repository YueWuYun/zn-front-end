/*! @ncctag {"date":"2020-5-11 23:39:24"} */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react","react-dom"],t):"object"==typeof exports?exports["uap/rbac/keyfunc/main/index"]=t(require("nc-lightapp-front"),require("react"),require("react-dom")):e["uap/rbac/keyfunc/main/index"]=t(e["nc-lightapp-front"],e.React,e.ReactDOM)}(window,(function(e,t,n){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="../../../../",n(n.s=607)}({1:function(t,n){t.exports=e},2:function(e,n){e.exports=t},3:function(e,t){e.exports=n},502:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(t){var o=this,r=e.search.getQueryInfo("searchArea");this.setState({searchValue:t}),(0,a.ajax)({url:"/nccloud/riaam/keyfunc/qrykeyfunc.do",data:r,success:function(t){var r=t.success,c=t.data;r&&(c&&c.keyfunc&&c.keyfunc.rows.length>0?(e.editTable.setTableData("keyfunc",c.keyfunc),o.setState({originTableData:(0,a.deepClone)(c.keyfunc)}),"refresh"===n?(0,a.toast)({color:"success",content:o.state.json["10120KFUN-000008"]}):(0,a.toast)({color:"success",content:o.state.inlt&&o.state.inlt.get("10120KFUN-000007",{total:c.keyfunc.rows.length})})):(e.editTable.setTableData("keyfunc",{rows:[]}),o.setState({originTableData:{rows:[]}}),e.button.setButtonDisabled({edit:!0}),(0,a.toast)({content:"refresh"===n?o.state.json["10120KFUN-000008"]:o.state.json["10120KFUN-000003"],color:"refresh"===n?"success":"warning"})))}})}};var a=n(1)},607:function(e,t,n){"use strict";var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),r=s(o),c=s(n(3)),i=n(1),u=n(608);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.initData=function(){var e=n;(0,i.ajax)({url:"/nccloud/riaam/keyfunc/querydata.do",success:function(t){var n=t.success,a=t.data;n&&(a&&a.keyfunc&&a.keyfunc.keyfunc&&0!=a.keyfunc.keyfunc.rows.length?(e.props.editTable.setTableData("keyfunc",a.keyfunc.keyfunc),e.setState({originTableData:(0,i.deepClone)(a.keyfunc.keyfunc)})):(e.props.button.setButtonDisabled({edit:!0}),e.props.editTable.setTableData("keyfunc",{rows:[]})))},error:function(e){(0,i.toast)({color:"danger",content:e.message})}})},n.state={isEditStatus:!1,originTableData:{rows:[]},searchValue:{},json:{},inlt:null},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillMount",value:function(){var e=this;this.props.MultiInit.getMultiLang({moduleId:"keyfunconfig",domainName:"uap",callback:function(t,n,a){n?e.setState({json:t,inlt:a}):console.log("未加载到多语资源")}})}},{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this.props,t=e.search,n=e.editTable,a=e.BillHeadInfo,o=e.button,c=t.NCCreateSearch,s=n.createEditTable,l=this.state.isEditStatus,f=i.base.NCDiv,d=a.createBillHeadInfo;return r.default.createElement("div",{className:"nc-single-table"},r.default.createElement(f,{areaCode:f.config.HEADER},r.default.createElement("div",{className:"nc-singleTable-header-area"},r.default.createElement("div",{className:"header-title-search-area"},d({title:this.state.json["10120KFUN-000005"],initShowBackBtn:!1})),r.default.createElement("div",{className:"header-button-area"},o.createButtonApp({area:"head_area",buttonLimit:6,onButtonClick:u.buttonClick.bind(this),popContainer:document.querySelector(".header-button-area")})))),r.default.createElement("div",{className:"nc-singleTable-search-area",style:{display:l?"none":"block"}},c("searchArea",{clickSearchBtn:u.searchBtnClick.bind(this),showAdvBtn:!0})),r.default.createElement("div",{className:"nc-singleTable-table-area"},s("keyfunc",{showIndex:!0,showCheck:!0,adaptionHeight:!0,selectedChange:u.selectedChangeFn.bind(this),onAfterEvent:u.afterEvent.bind(this),onBeforeEvent:u.beforeEvent.bind(this)})))}}]),t}(o.Component);l=(0,i.createPage)({initTemplate:u.initTemplate})(l),c.default.render(r.default.createElement(l,null),document.querySelector("#app"))},608:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.selectedChangeFn=t.beforeEvent=t.buttonClick=t.searchBtnClick=t.afterEvent=t.initTemplate=void 0;var a=s(n(609)),o=s(n(610)),r=s(n(502)),c=s(n(611)),i=s(n(612)),u=s(n(613));function s(e){return e&&e.__esModule?e:{default:e}}t.initTemplate=a.default,t.afterEvent=o.default,t.searchBtnClick=r.default,t.buttonClick=c.default,t.beforeEvent=i.default,t.selectedChangeFn=u.default},609:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){e.MultiInit.getMultiLang({moduleId:"keyfunconfig",domainName:"uap",callback:function(t,n,o){n&&e.createUIDom({pagecode:"10120KFUN_page"},(function(n){if(n){if(n.button){var o=n.button;e.button.setButtons(o),function(e){e.setButtonVisible({save:!1,cancel:!1}),e.setButtonDisabled({del:!0,print:!0,output:!0})}(e.button),e.button.setPopContent("oprDelete",t["10120KFUN-000001"])}if(n.template){var r=n.template;!function(e,t,n){t.searchArea.items.map((function(e){"appcode"===e.attrcode&&(e.onlyLeafCanSelect=!0,e.isMultiSelectedEnabled=!0,e.refcode="uap/refer/riart/appRegestTreeRefer/index"),"appbutton"===e.attrcode&&(e.refcode="uap/refer/riart/btnRef/index")})),t.keyfunc.items.map((function(e){"appcode"===e.attrcode&&(e.onlyLeafCanSelect=!0,e.refcode="uap/refer/riart/appRegestTreeRefer/index"),"appbutton"===e.attrcode&&(e.refcode="uap/refer/riart/btnRef/index")})),t.keyfunc.items.push({attrcode:"opr",label:n["10120KFUN-000009"],itemtype:"customer",width:150,fixed:"right",className:"table-opr",visible:!0,render:function(t,n,o){return e.button.createOprationButton(["oprDelete"],{area:"opr_area",buttonLimit:2,onButtonClick:function(e,t){return function(e,t,n,o,r){if("oprDelete"===t){var c={areaType:"table",areacode:null,rows:[o]};(0,a.ajax)({data:{table:{tableData:c}},url:"/nccloud/riaam/keyfunc/delete.do",success:function(t){var n=t.success;n&&(e.editTable.deleteTableRowsByIndex("keyfunc",r,!0),(0,a.toast)({color:"success"}))},error:function(e){(0,a.toast)({content:e.message,color:"danger"})}})}}(e,t,0,n,o)}})}})}(e,r,t),e.meta.setMeta(r)}}}))}})};var a=n(1)},610:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,o,r,c){if("keyfunc"==t)switch(n){case"appcode":if(a.refpk)e.meta.getMeta()[t].items.map((function(e){"appbutton"===e.attrcode&&(e.queryCondition={appid:a.refpk})}));else e.editTable.setValByKeyAndIndex(t,r,"appbutton",{display:null,value:null});break;case"appbutton":e.editTable.setValByKeyAndIndex(t,r,n,{display:a.refname,value:a.refpk})}}},611:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=this,a=e.editTable.getCheckedRows("keyfunc"),r=[];switch(t){case"add":var s=e.editTable.getNumberOfRows("keyfunc");e.editTable.addRow("keyfunc",s,!0),u.call(this,!0);break;case"edit":u.call(this,!0);break;case"del":var d=e.editTable.getCheckedRows("keyfunc"),p=this;if(d&&d.length>0){var b=[];d.map((function(e){b.push(e.data)}));var y={areaType:"table",areacode:null,rows:b},h=i.call(this,d);(0,o.promptBox)({color:"warning",title:this.state.json["10120KFUN-000000"],content:this.state.json["10120KFUN-000001"],beSureBtnClick:function(){(0,o.ajax)({data:{table:{tableData:y}},url:"/nccloud/riaam/keyfunc/delete.do",success:function(t){var n=t.success;n&&(e.editTable.deleteTableRowsByIndex("keyfunc",h,!0),p.setState({originTableData:e.editTable.getAllRows("keyfunc")}),(0,o.toast)({color:"success"}))},error:function(e){(0,o.toast)({content:e.message,color:"danger"})}})}})}break;case"save":f.call(this);break;case"cancel":(0,o.promptBox)({color:"warning",title:this.state.json["10120KFUN-000010"],content:this.state.json["10120KFUN-000011"],beSureBtnClick:function(){u.call(n,!1),l.call(n)}});break;case"output":if(a&&a.length>0){a.map((function(e){r.push(e.data.values.pk_ncckeyfunc.value)}));var k={funcode:"10120KFUN",appcode:"10120KFUN",nodekey:"keyfunc_print",oids:r,outputType:"output"};(0,o.output)({url:"/nccloud/riaam/keyfunc/kfunprint.do",data:k})}else(0,o.toast)({content:this.state.json["10120KFUN-000006"],color:"warning"});break;case"print":a&&a.length>0?(a.map((function(e){r.push(e.data.values.pk_ncckeyfunc.value)})),(0,o.print)("pdf","/nccloud/riaam/keyfunc/kfunprint.do",{funcode:"10120KFUN",appcode:"10120KFUN",nodekey:"keyfunc_print",oids:r},!0)):(0,o.toast)({content:this.state.json["10120KFUN-000002"],color:"warning"});break;case"refresh":c.default.call(this,this.props,this.state.searchValue,"refresh")}};var a,o=n(1),r=n(502),c=(a=r)&&a.__esModule?a:{default:a};function i(e){var t=[];return e.map((function(e){t.push(e.index)})),t}function u(e){this.setState({isEditStatus:e});var t={};["edit","del","save","cancel","print","refresh"].map((function(n){t[n]=!e})),t.save=e,t.cancel=e,this.props.button.setButtonVisible(t),s.call(this,e)}function s(e){this.props.editTable.setStatus("keyfunc",e?"edit":"browse")}function l(){var e=this.state.originTableData;Object.keys(e).length||this.setState({originTableData:{rows:[]}}),e.rows?(!function(e){if(e)for(var t=0;t<e.length;t++)"2"===e[t].status&&e.splice(t--,1)}(e.rows),this.props.editTable.setTableData("keyfunc",e),this.setState({originTableData:e})):this.props.editTable.setTableData("keyfunc",{rows:[]})}function f(){var e=this;this.props.editTable.filterEmptyRows("keyfunc",["creator","creationtime","modifier","modifiedtime"]);var t=this.props.editTable.getAllData("keyfunc");this.props.editTable.checkRequired("keyfunc",t.rows)&&(0,o.ajax)({data:{table:{tableData:t}},url:"/nccloud/riaam/keyfunc/save.do",success:function(t){var n=t.success,a=t.data;if(n){var r=a&&a.keyfunc?a.keyfunc:{rows:[]};e.props.editTable.setTableData("keyfunc",r),e.props.button.setButtonDisabled(["edit"],!1),e.setState({originTableData:(0,o.deepClone)(r)})}u.call(e,!1),(0,o.toast)({color:"success"})},error:function(e){(0,o.toast)({content:e.message,color:"danger"})}})}},612:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,o,r){return!("keyfunc"==t&&"appbutton"===n.attrcode&&!e.editTable.getValByKeyAndIndex(t,a,"appcode").value)}},613:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){console.log(n,a),0===n?e.button.setButtonDisabled({del:!0,print:!0,output:!0}):e.button.setButtonDisabled({del:!1,print:!1,output:!1})}}})}));
//# sourceMappingURL=index.3a8d23ea.js.map